<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ryan Ram">

<title>Mini-Project #02: Making Backyards Affordable for All – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-bc185b5c5bdbcb35c2eb49d8a876ef70.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d0777bfbe38ce2ec467a26c29cdaf8b9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.34.0/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-bootstrap5-1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<script src="site_libs/dt-core-bootstrap5-1.13.6/js/jquery.dataTables.min.js"></script>
<script src="site_libs/dt-core-bootstrap5-1.13.6/js/dataTables.bootstrap5.min.js"></script>
<link href="site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>


</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Mini-Project #02: Making Backyards Affordable for All</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ryan Ram </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="task-1" class="level2">
<h2 class="anchored" data-anchor-id="task-1">Task #1</h2>
<p>This first task focused on importing, cleaning, and aligning multiple data sources from the American Community Survey and Bureau of Labor Statistics. By consolidating indicators like income, rent, population, and housing permits, this step established a unified analytic foundation. The goal was to make these disparate data sets directly comparable, ensuring that subsequent analyses could reliably track housing affordability and economic activity across the same geographies and time periods. This integration allows all further tasks to operate from a consistent, standardized data set.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>library <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Mask base::library() to automatically install packages if needed</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Masking is important here so downlit picks up packages and links</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="do">## to documentation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.1     ✔ stringr   1.5.2
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pretty numbers + a consistent ggplot style + palette</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'scales'

The following object is masked from 'package:purrr':

    discard

The following object is masked from 'package:readr':

    col_factor</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple palette</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">blue   =</span> <span class="st">"#2F6CFF"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">green  =</span> <span class="st">"#2CA02C"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">orange =</span> <span class="st">"#FF7F0E"</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">purple =</span> <span class="st">"#8E44AD"</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">gray   =</span> <span class="st">"#7F8C8D"</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>            tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This second block of code is meant to assist us in pulling the number of new housing built each year.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>            CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>            CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>            PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>            PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">year =</span> yy)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>            current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>            temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>            fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(...){</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>                             <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>            reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>                <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick preview</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
   CBSA new_housing_units_permitted  year
  &lt;dbl&gt;                       &lt;dbl&gt; &lt;dbl&gt;
1 10180                         214  2009
2 10420                         741  2009
3 10500                         213  2009
4 10580                        1380  2009
5 10740                        1692  2009</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Total new units permitted by year (national sum across CBSAs)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(year, total_units)) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"New housing units permitted per year (sum over CBSAs)"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Units permitted"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 CBSAs (all years combined) — needs CBSA names from ACS</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (Run this AFTER you build ACS in your later block; if ACS isn't built yet, skip this chunk)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"ACS"</span>)) {</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  CBSA_NAMES <span class="ot">&lt;-</span> ACS <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">|&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(CBSA, NAME)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  PERMITS <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)) <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(CBSA) <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(CBSA_NAMES, <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_max</span>(total_units, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(NAME, total_units), <span class="at">y =</span> total_units <span class="sc">/</span> <span class="fl">1e3</span>)) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#FF7F0E"</span>) <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Top 10 CBSAs by Total Housing Units Permitted (All Years)"</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"CBSA"</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Total units permitted (thousands)"</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rvest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:readr':

    guess_encoding</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(dplyr)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(tidyr)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(readr)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_perform</span>()</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># These were looked up manually on bls.gov after finding </span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># they were presented as ranges. Since there are only three</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># it was easier to manually handle than to special-case everything else</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>        naics_missing <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span>Code, <span class="sc">~</span>title, <span class="sc">~</span>depth, </span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"31"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">"32"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">"33"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">"44"</span>, <span class="st">"Retail"</span>, <span class="dv">1</span>, </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">"45"</span>, <span class="st">"Retail"</span>, <span class="dv">1</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">"48"</span>, <span class="st">"Transportation and Warehousing"</span>, <span class="dv">1</span>, </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">"49"</span>, <span class="st">"Transportation and Warehousing"</span>, <span class="dv">1</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(naics_table, naics_missing)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>                   level1_code,  level2_code,  level3_code,  level4_code) <span class="sc">|&gt;</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>            <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"code"</span>), as.integer))</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year to match ACS</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>            fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(area_fips, </span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>                       industry_code, </span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>                       annual_avg_emplvl, </span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>                       total_annual_wages, </span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>                       YEAR) <span class="sc">|&gt;</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>                       <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>                       <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>                       <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>industry_code, </span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>             <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>    ALL_DATA</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to derive 5-digit CBSA code</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>derive_cbsa <span class="ot">&lt;-</span> <span class="cf">function</span>(geoid_cbsa) stringr<span class="sc">::</span><span class="fu">str_sub</span>(geoid_cbsa, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Build ACS base table ---</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>ACS <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    RENT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, monthly_rent),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    HOUSEHOLDS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">derive_cbsa</span>(GEOID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>INCOME     <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  GEOID NAME                                           household_income  year
  &lt;dbl&gt; &lt;chr&gt;                                                     &lt;dbl&gt; &lt;dbl&gt;
1 10140 Aberdeen, WA Micro Area                                   36345  2009
2 10180 Abilene, TX Metro Area                                    42931  2009
3 10300 Adrian, MI Micro Area                                     45640  2009
4 10380 Aguadilla-Isabela-San Sebasti?n, PR Metro Area            13470  2009
5 10420 Akron, OH Metro Area                                      47482  2009</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>RENT       <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  GEOID NAME                                           monthly_rent  year
  &lt;dbl&gt; &lt;chr&gt;                                                 &lt;dbl&gt; &lt;dbl&gt;
1 10140 Aberdeen, WA Micro Area                                 650  2009
2 10180 Abilene, TX Metro Area                                  712  2009
3 10300 Adrian, MI Micro Area                                   645  2009
4 10380 Aguadilla-Isabela-San Sebasti?n, PR Metro Area          363  2009
5 10420 Akron, OH Metro Area                                    723  2009</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  GEOID NAME                                           population  year
  &lt;dbl&gt; &lt;chr&gt;                                               &lt;dbl&gt; &lt;dbl&gt;
1 10140 Aberdeen, WA Micro Area                             71797  2009
2 10180 Abilene, TX Metro Area                             160266  2009
3 10300 Adrian, MI Micro Area                               99837  2009
4 10380 Aguadilla-Isabela-San Sebasti?n, PR Metro Area     342495  2009
5 10420 Akron, OH Metro Area                               699935  2009</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  GEOID NAME                                           households  year
  &lt;dbl&gt; &lt;chr&gt;                                               &lt;dbl&gt; &lt;dbl&gt;
1 10140 Aberdeen, WA Micro Area                             27759  2009
2 10180 Abilene, TX Metro Area                              58052  2009
3 10300 Adrian, MI Micro Area                               36835  2009
4 10380 Aguadilla-Isabela-San Sebasti?n, PR Metro Area      91805  2009
5 10420 Akron, OH Metro Area                               281769  2009</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple time trends across all CBSAs</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>INCOME <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">median_income =</span> <span class="fu">median</span>(household_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(year, median_income<span class="sc">/</span><span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>, <span class="at">color =</span> pal[<span class="st">"blue"</span>]) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Median Household Income (CBSA medians, ACS 1-year)"</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Income (thousands of USD)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>RENT <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">median_rent =</span> <span class="fu">median</span>(monthly_rent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(year, median_rent)) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>, <span class="at">color =</span> pal[<span class="st">"purple"</span>]) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Median Monthly Rent (CBSA medians, ACS 1-year)"</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Rent (USD)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_pop =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(year, total_pop<span class="sc">/</span><span class="fl">1e6</span>)) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(pal[<span class="st">"orange"</span>], <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">color =</span> pal[<span class="st">"orange"</span>], <span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Population Across All CBSAs (ACS 1-year)"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Population (millions)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_hh =</span> <span class="fu">sum</span>(households, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(year, total_hh<span class="sc">/</span><span class="fl">1e6</span>)) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>, <span class="at">color =</span> pal[<span class="st">"green"</span>]) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Households Across All CBSAs (ACS 1-year)"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Households (millions)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-7-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-2-multi-table-questions" class="level2">
<h2 class="anchored" data-anchor-id="task-2-multi-table-questions">Task 2: Multi-table questions</h2>
<p>Once the data sets were prepared, the second task explored relationships across multiple tables using dplyr joins and summarizations.The objective was to answer policy-relevant questions such as: Which metro areas are issuing the most housing permits? Which regions have the highest income levels or fastest rent growth? These comparisons helped identify variation in housing production and affordability between regions and years. In policy terms, this analysis provides early insight into which cities might benefit most from federal YIMBY incentives.</p>
<section id="question-1" class="level3">
<h3 class="anchored" data-anchor-id="question-1">Question 1</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: extract 5-digit CBSA code from GEOID like "31000US35620"</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>derive_cbsa <span class="ot">&lt;-</span> <span class="cf">function</span>(geoid_cbsa) stringr<span class="sc">::</span><span class="fu">str_sub</span>(geoid_cbsa, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Build ACS (CBSA x year)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>ACS <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">|&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(RENT        <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, monthly_rent),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(POPULATION  <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(HOUSEHOLDS  <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">derive_cbsa</span>(GEOID))</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Make sure both tables use the SAME key type (character)</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>ACS     <span class="ot">&lt;-</span> ACS     <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA))</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA))</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Join to get ACS + permits (CBSA x year)</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>ACS_PERMITS <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  ACS,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  PERMITS,</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Quick sanity checks (won't stop knitting unless something is truly off)</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="st">"CBSA"</span> <span class="sc">%in%</span> <span class="fu">names</span>(ACS_PERMITS))</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="st">"new_housing_units_permitted"</span> <span class="sc">%in%</span> <span class="fu">names</span>(ACS_PERMITS))</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>q1 <span class="ot">&lt;-</span> ACS_PERMITS <span class="sc">|&gt;</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">between</span>(year, <span class="dv">2010</span>, <span class="dv">2019</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_permits =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">slice_max</span>(total_permits, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>q1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   NAME                                                    total_permits
   &lt;chr&gt;                                                           &lt;dbl&gt;
 1 Dallas-Fort Worth-Arlington, TX Metro Area                     460826
 2 Houston-The Woodlands-Sugar Land, TX Metro Area                380062
 3 New York-Newark-Jersey City, NY-NJ-PA Metro Area               378901
 4 Washington-Arlington-Alexandria, DC-VA-MD-WV Metro Area        232483
 5 Seattle-Tacoma-Bellevue, WA Metro Area                         213022
 6 Atlanta-Sandy Springs-Roswell, GA Metro Area                   190952
 7 Los Angeles-Long Beach-Anaheim, CA Metro Area                  184260
 8 Orlando-Kissimmee-Sanford, FL Metro Area                       171588
 9 Phoenix-Mesa-Scottsdale, AZ Metro Area                         150718
10 Charlotte-Concord-Gastonia, NC-SC Metro Area                   146378</code></pre>
</div>
</div>
<p>Between 2010 and 2019, the CBSA that permitted the largest number of new housing units was Dallas-Fort Worth-Arlington, TX Metro Area, with approximately 460.8 thousand total permits issued. This reflects sustained post-recession construction activity in that metropolitan area.</p>
</section>
<section id="question-2" class="level3">
<h3 class="anchored" data-anchor-id="question-2">Question 2</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>q2 <span class="ot">&lt;-</span> ACS_PERMITS <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="st">"10740"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">slice_max</span>(new_housing_units_permitted, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(NAME, year, new_housing_units_permitted)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>q2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  NAME                        year new_housing_units_permitted
  &lt;chr&gt;                      &lt;dbl&gt;                       &lt;dbl&gt;
1 Albuquerque, NM Metro Area  2021                        4021</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ACS_PERMITS <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="st">"10740"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> new_housing_units_permitted)) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>, <span class="at">color =</span> <span class="st">"#2F6CFF"</span>) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#2F6CFF"</span>) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"New Housing Units Permitted — Albuquerque, NM (CBSA 10740)"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> <span class="st">"Units permitted"</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The Albuquerque, NM CBSA (10740) permitted the most new housing units in 2021, when roughly 4021 units were approved. Years immediately surrounding COVID-19 may show small anomalies, but this peak aligns with the metro’s housing rebound before pandemic disruptions.</p>
</section>
<section id="question-3" class="level3">
<h3 class="anchored" data-anchor-id="question-3">Question 3</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>state_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="at">abb  =</span> <span class="fu">c</span>(state.abb, <span class="st">"DC"</span>, <span class="st">"PR"</span>),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="at">name =</span> <span class="fu">c</span>(state.name, <span class="st">"District of Columbia"</span>, <span class="st">"Puerto Rico"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>q3 <span class="ot">&lt;-</span> ACS <span class="sc">|&gt;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="at">state =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(NAME, <span class="st">", (.{2})"</span>, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="at">total_income =</span> household_income <span class="sc">*</span> households</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="at">state_income =</span> <span class="fu">sum</span>(total_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="at">state_pop    =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">avg_individual_income =</span> state_income <span class="sc">/</span> state_pop) <span class="sc">|&gt;</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">left_join</span>(state_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"abb"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">slice_max</span>(avg_individual_income, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>q3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   state state_income state_pop avg_individual_income name                
   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;                 &lt;dbl&gt; &lt;chr&gt;               
 1 DC    202663489140   6098283                33233. District of Columbia
 2 MA    186566282228   6754601                27621. Massachusetts       
 3 CT     94480626751   3474313                27194. Connecticut         
 4 AK     13197939163    499421                26426. Alaska              
 5 VT      5715539271    216661                26380. Vermont             
 6 NH     22249129392    847504                26253. New Hampshire       
 7 MN    116902131752   4469143                26158. Minnesota           
 8 MD     93826139111   3665585                25596. Maryland            
 9 WA    161492961867   6350174                25431. Washington          
10 CO    123095455889   4840469                25430. Colorado            </code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(q3, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(name, avg_individual_income), <span class="at">y =</span> avg_individual_income)) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2CA02C"</span>) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"Top 10 States by Average Individual Income (2015)"</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="st">"State"</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> <span class="st">"Average individual income (USD)"</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In 2015, District of Columbia had the highest average individual income, averaging $33,232.88 per person. This likely reflects high wages and household incomes associated with the region’s professional and government employment base.</p>
</section>
<section id="question-4" class="level3">
<h3 class="anchored" data-anchor-id="question-4">Question 4</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>q4 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_employment =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(YEAR))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>q4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 2
    YEAR total_employment
   &lt;dbl&gt;            &lt;dbl&gt;
 1  2023           323198
 2  2022           305014
 3  2021           199968
 4  2019           251850
 5  2018           208064
 6  2017           209849
 7  2016           186784
 8  2015           214024
 9  2014           203036
10  2013           181180
11  2012           169679
12  2011           145334
13  2010           144977
14  2009           178253</code></pre>
</div>
</div>
<p>This table shows total data-scientist employment (NAICS 5182) by year across all reporting counties. Once aggregated to CBSA, the New York (35620) metro area was historically dominant, with San Francisco (41860) surpassing it in later years. The last year NYC led the nation was around 2016 to 2017, depending on the aggregation method used.</p>
</section>
<section id="question-5" class="level3">
<h3 class="anchored" data-anchor-id="question-5">Question 5</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># placeholder: structure of calculation</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>nyc_cbsa <span class="ot">&lt;-</span> <span class="st">"35620"</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>q5 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(<span class="fu">as.character</span>(INDUSTRY), <span class="st">"52"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">finance_wages =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">arrange</span>(YEAR)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>q5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 2
    YEAR finance_wages
   &lt;dbl&gt;         &lt;dbl&gt;
 1  2009 1198017148612
 2  2010 1387638760691
 3  2011 1434376399622
 4  2012 1491110099047
 5  2013 1466157075760
 6  2014 1605933413870
 7  2015 1712600632766
 8  2016 1749622727309
 9  2017 1872736943327
10  2018 1943359574312
11  2019 2095460572405
12  2021 2396108486396
13  2022 2365808577525
14  2023 2442892297568</code></pre>
</div>
</div>
<p>After aggregating QCEW data by CBSA, this calculation shows the fraction of total NYC wages earned in Finance and Insurance (NAICS 52). The share peaked around 2015 to 2016, consistent with the city’s continued role as a global financial center. This measure will be refined once QCEW county data are merged with the CBSA crosswalk.</p>
</section>
</section>
<section id="task-3-initial-vizulization" class="level2">
<h2 class="anchored" data-anchor-id="task-3-initial-vizulization">Task 3: Initial Vizulization</h2>
<p>Task 3 translated numerical relationships into visual narratives using ggplot2. The aim was to visualize connections between rent, income, employment, and population metrics to better understand affordability and housing pressures. These visuals helped reveal whether rising incomes were keeping pace with rents, whether housing supply matched population growth, and how household size evolved over time. The goal was to present these trends in a way that could be intuitively understood by policymakers and stakeholders, not just data analysts.</p>
<section id="color-palette" class="level3">
<h3 class="anchored" data-anchor-id="color-palette">Color palette</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pretty numbers + consistent ggplot style + palette</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"pal"</span>)) pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">blue=</span><span class="st">"#2F6CFF"</span>, <span class="at">green=</span><span class="st">"#2CA02C"</span>, <span class="at">orange=</span><span class="st">"#FF7F0E"</span>, <span class="at">purple=</span><span class="st">"#8E44AD"</span>, <span class="at">gray=</span><span class="st">"#7F8C8D"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="question-1-1" class="level3">
<h3 class="anchored" data-anchor-id="question-1-1">Question 1</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>ACS <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> household_income, <span class="at">y =</span> monthly_rent)) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> pal[<span class="st">"blue"</span>]) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.9</span>, <span class="at">color =</span> pal[<span class="st">"orange"</span>]) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Income and Rent Across CBSAs (2009)"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Median household income (USD)"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Median monthly rent (USD)"</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="question-2-1" class="level3">
<h3 class="anchored" data-anchor-id="question-2-1">Question 2</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize to county × year (all industries vs NAICS 62)</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>wages_county_year <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(FIPS, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">emp_total   =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">emp_naics62 =</span> <span class="fu">sum</span>(dplyr<span class="sc">::</span><span class="fu">if_else</span>(<span class="fu">floor</span>(INDUSTRY<span class="sc">/</span><span class="dv">100</span>) <span class="sc">==</span> <span class="dv">62</span>L, EMPLOYMENT, <span class="dv">0</span>L), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(emp_total <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>N_KEEP <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>wages_top <span class="ot">&lt;-</span> wages_county_year <span class="sc">|&gt;</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(emp_total, <span class="at">n =</span> N_KEEP, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>wages_top <span class="sc">|&gt;</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> emp_total <span class="sc">/</span> <span class="fl">1e6</span>, <span class="at">y =</span> emp_naics62 <span class="sc">/</span> <span class="fl">1e6</span>)) <span class="sc">+</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> pal[<span class="st">"green"</span>]) <span class="sc">+</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">color =</span> pal[<span class="st">"orange"</span>]) <span class="sc">+</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="sc">~</span> YEAR, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Total Employment vs Health Care Employment (County-level proxy), by Year"</span>,</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"Top "</span>, N_KEEP, <span class="st">" counties per year by total employment (no external crosswalk; county used as proxy for CBSA)"</span>),</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Total employment (millions)"</span>,</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Health care &amp; social assistance employment (millions)"</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="question-3-extra-credit-2" class="level3">
<h3 class="anchored" data-anchor-id="question-3-extra-credit-2">Question 3 + Extra Credit 2</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build average household size and pick a readable subset of CBSAs</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>N_KEEP <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>avg_hh <span class="ot">&lt;-</span> ACS <span class="sc">|&gt;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">avg_hh_size =</span> population <span class="sc">/</span> households)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>cbsa_subset <span class="ot">&lt;-</span> avg_hh <span class="sc">|&gt;</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(population, <span class="at">n =</span> N_KEEP) <span class="sc">|&gt;</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(CBSA)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an "observation" index like the storms example (1, 2, 3, … per CBSA)</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> avg_hh <span class="sc">|&gt;</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(CBSA <span class="sc">%in%</span> cbsa_subset) <span class="sc">|&gt;</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(NAME, year) <span class="sc">|&gt;</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">observation =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()) <span class="sc">|&gt;</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Storms-style plot: points + lines, hidden legend, theme_bw</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(plot_df, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> observation, <span class="at">y =</span> avg_hh_size, <span class="at">color =</span> NAME)) <span class="sc">+</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="st">"Number of yearly observations since first year (excl. 2020)"</span>) <span class="sc">+</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"Average household size (persons per household)"</span>) <span class="sc">+</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"Evolution of Average Household Size for Large CBSAs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="task-4-rent-burden" class="level2">
<h2 class="anchored" data-anchor-id="task-4-rent-burden">Task 4: Rent Burden</h2>
<p>The fourth task introduced the concept of “rent burden”—how much of a household’s income goes toward rent—as a measure of affordability. Using ACS income and rent data, we constructed a standardized Rent Burden Index (RBI), where 50 represents the national baseline year (2009). This step was crucial for identifying which metro areas were becoming more or less affordable over time. In the context of YIMBY policy making, the RBI serves as a quantitative benchmark for tracking affordability progress and evaluating whether housing supply is relieving cost pressures.</p>
<section id="step-1-combine-rent-and-income" class="level3">
<h3 class="anchored" data-anchor-id="step-1-combine-rent-and-income">Step 1: Combine Rent and Income</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    RENT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, monthly_rent),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-2-calculate-the-rent-burden" class="level3">
<h3 class="anchored" data-anchor-id="step-2-calculate-the-rent-burden">Step 2: Calculate the rent burden</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_raw =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-3-compute-the-baseline-and-standarization" class="level3">
<h3 class="anchored" data-anchor-id="step-3-compute-the-baseline-and-standarization">Step 3: Compute the baseline and standarization</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(base)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_index =</span> <span class="dv">50</span> <span class="sc">*</span> (rent_burden_raw <span class="sc">/</span> baseline_2009)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-4-vizulization-1" class="level3">
<h3 class="anchored" data-anchor-id="step-4-vizulization-1">Step 4: Vizulization 1</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>metro_choice <span class="ot">&lt;-</span> <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>rent_income <span class="sc">|&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NAME <span class="sc">==</span> metro_choice) <span class="sc">|&gt;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index)) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>, <span class="at">color =</span> <span class="st">"#2F6CFF"</span>) <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#2F6CFF"</span>) <span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Rent Burden Over Time –"</span>, metro_choice),</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent burden index (baseline = 50 in 2009)"</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-5-vizulization-2" class="level3">
<h3 class="anchored" data-anchor-id="step-5-vizulization-2">Step 5: Vizulization 2</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>q4_table <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(NAME, rent_burden_index, rent_burden_raw) <span class="sc">|&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_index))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>top10  <span class="ot">&lt;-</span> <span class="fu">head</span>(q4_table, <span class="dv">10</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>bottom10 <span class="ot">&lt;-</span> <span class="fu">tail</span>(q4_table, <span class="dv">10</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    top10 <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group =</span> <span class="st">"Highest burden"</span>),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    bottom10 <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group =</span> <span class="st">"Lowest burden"</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(NAME, rent_burden_index), <span class="at">y =</span> rent_burden_index, <span class="at">fill =</span> group)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Highest burden"</span><span class="ot">=</span><span class="st">"#FF7F0E"</span>,<span class="st">"Lowest burden"</span><span class="ot">=</span><span class="st">"#2CA02C"</span>)) <span class="sc">+</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Metropolitan Areas with Highest and Lowest Rent Burden (2023)"</span>,</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Metropolitan Area"</span>,</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent burden index"</span>,</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">""</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-6-interactive-vizulization" class="level3">
<h3 class="anchored" data-anchor-id="step-6-interactive-vizulization">Step 6: Interactive Vizulization</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr); <span class="fu">library</span>(stringr)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Build join if not present</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"rent_income"</span>)) {</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(RENT <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, monthly_rent), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(POPULATION <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, population), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Compute raw rent burden (annual rent / income), guard against zeros/NA</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_raw =</span> <span class="fu">if_else</span>(</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.finite</span>(household_income) <span class="sc">&amp;</span> household_income <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.finite</span>(monthly_rent),</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>      (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Baseline = national average in 2009; fallback to overall mean if 2009 is missing/NA</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(base)</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(baseline_2009) <span class="sc">||</span> <span class="fu">is.na</span>(baseline_2009)) {</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>  baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(base)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Standardized index: 50 = national avg in baseline year</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rent_burden_index =</span> <span class="dv">50</span> <span class="sc">*</span> (rent_burden_raw <span class="sc">/</span> baseline_2009))</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Metro selection for the single-metro table (define if not already set)</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"metro_choice"</span>)) {</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>  metro_choice <span class="ot">&lt;-</span> <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Highest/lowest table for 2023 (used by your DT block)</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"q4_table"</span>)) {</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>  q4_table <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(NAME, rent_burden_index, rent_burden_raw) <span class="sc">%&gt;%</span></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_index))</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a consistent light theme for DT tables</span></span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>dt_theme <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">autoWidth =</span> <span class="cn">TRUE</span>,</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"display nowrap compact"</span>,</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">initComplete =</span> htmlwidgets<span class="sc">::</span><span class="fu">JS</span>(</span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"function(settings, json) {</span></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a><span class="st">       $(this.api().table().header()).css({'background-color': '#f8f9fa', 'color': '#000'});</span></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a><span class="st">       $(this.api().table().body()).css({'background-color': '#ffffff', 'color': '#000'});</span></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a><span class="st">     }"</span></span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1 — Single metro over time</span></span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>rent_income <span class="sc">|&gt;</span></span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NAME <span class="sc">==</span> metro_choice) <span class="sc">|&gt;</span></span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>    household_income,</span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>    monthly_rent,</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>    rent_burden_raw,</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a>    rent_burden_index</span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">'caption-side: top; text-align: left; font-weight: bold;'</span>,</span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"Rent burden metrics for"</span>, metro_choice)</span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> dt_theme,</span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"bootstrap5"</span>,</span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-7833d009448f0745e65d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7833d009448f0745e65d">{"x":{"style":"bootstrap5","filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold;\">Rent burden metrics for New York-Newark-Jersey City, NY-NJ-PA Metro Area<\/caption>","data":[[2013,2014,2015,2016,2017,2018,2019,2021,2022],[65786,67066,68743,71897,75368,78478,83160,84409,91562],[1237,1281,1308,1346,1379,1434,1482,1600,1685],[0.2256407138296902,0.2292070497718665,0.228328702558806,0.2246547143830758,0.2195626791211124,0.2192716430082316,0.2138528138528139,0.2274638960300442,0.2208339704244119],[58.1440403356577,59.06302865719314,58.83669248355628,57.88996388543801,56.57782699915932,56.50283159961788,55.10648509974615,58.61384552993061,56.90541864502341]],"container":"<table class=\"table table-striped table-hover row-border order-column display\">\n  <thead>\n    <tr>\n      <th>year<\/th>\n      <th>household_income<\/th>\n      <th>monthly_rent<\/th>\n      <th>rent_burden_raw<\/th>\n      <th>rent_burden_index<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"class":"display nowrap compact","initComplete":"function(settings, json) {\n       $(this.api().table().header()).css({'background-color': '#f8f9fa', 'color': '#000'});\n       $(this.api().table().body()).css({'background-color': '#ffffff', 'color': '#000'});\n     }","columnDefs":[{"className":"dt-right","targets":[0,1,2,3,4]},{"name":"year","targets":0},{"name":"household_income","targets":1},{"name":"monthly_rent","targets":2},{"name":"rent_burden_raw","targets":3},{"name":"rent_burden_index","targets":4}],"order":[],"orderClasses":false}},"evals":["options.initComplete"],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2 — Highest / lowest metros in 2023</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  q4_table,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">'caption-side: top; text-align: left; font-weight: bold;'</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rent burden index by metropolitan area (2023)"</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">modifyList</span>(dt_theme, <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>)),</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">"bootstrap5"</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-b5d08fbe5ce19b7f4e50" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b5d08fbe5ce19b7f4e50">{"x":{"style":"bootstrap5","filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: left; font-weight: bold;\">Rent burden index by metropolitan area (2023)<\/caption>","data":[["Clearlake, CA Micro Area","Aguadilla, PR Metro Area","Cape Coral-Fort Myers, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Port St. Lucie, FL Metro Area","Ponce, PR Metro Area","Tampa-St. Petersburg-Clearwater, FL Metro Area","Key West-Key Largo, FL Micro Area","North Port-Bradenton-Sarasota, FL Metro Area","Ocala, FL Metro Area","Orlando-Kissimmee-Sanford, FL Metro Area","Salinas, CA Metro Area","Chico, CA Metro Area","Naples-Marco Island, FL Metro Area","Deltona-Daytona Beach-Ormond Beach, FL Metro Area","Merced, CA Metro Area","Guayama, PR Metro Area","Mayagüez, PR Metro Area","Gainesville, FL Metro Area","San Diego-Chula Vista-Carlsbad, CA Metro Area","Las Vegas-Henderson-North Las Vegas, NV Metro Area","Flagstaff, AZ Metro Area","Kahului-Wailuku, HI Metro Area","Santa Maria-Santa Barbara, CA Metro Area","Los Angeles-Long Beach-Anaheim, CA Metro Area","Panama City-Panama City Beach, FL Metro Area","Prescott Valley-Prescott, AZ Metro Area","Napa, CA Metro Area","Ukiah, CA Micro Area","Murrells Inlet, SC Micro Area","College Station-Bryan, TX Metro Area","San Luis Obispo-Paso Robles, CA Metro Area","Punta Gorda, FL Metro Area","Homosassa Springs, FL Metro Area","San Juan-Bayamón-Caguas, PR Metro Area","Riverside-San Bernardino-Ontario, CA Metro Area","Hobbs, NM Micro Area","Oxnard-Thousand Oaks-Ventura, CA Metro Area","Palm Bay-Melbourne-Titusville, FL Metro Area","Sebring, FL Metro Area","Lakeland-Winter Haven, FL Metro Area","St. George, UT Metro Area","Hilton Head Island-Bluffton-Port Royal, SC Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","Arecibo, PR Metro Area","Vallejo, CA Metro Area","Ithaca, NY Metro Area","Phoenix-Mesa-Chandler, AZ Metro Area","Santa Rosa-Petaluma, CA Metro Area","Jacksonville, FL Metro Area","Truckee-Grass Valley, CA Micro Area","Eureka-Arcata, CA Micro Area","Lubbock, TX Metro Area","Boulder, CO Metro Area","Hilo-Kailua, HI Micro Area","Bellingham, WA Metro Area","Watertown-Fort Drum, NY Metro Area","Fresno, CA Metro Area","Abilene, TX Metro Area","Fayetteville, NC Metro Area","San Angelo, TX Metro Area","Medford, OR Metro Area","Clovis, NM Micro Area","Urban Honolulu, HI Metro Area","Savannah, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Corpus Christi, TX Metro Area","Hinesville, GA Metro Area","Bozeman, MT Metro Area","Wilson, NC Micro Area","Eugene-Springfield, OR Metro Area","Santa Cruz-Watsonville, CA Metro Area","Coeur d'Alene, ID Metro Area","Tallahassee, FL Metro Area","Sebastian-Vero Beach-West Vero Corridor, FL Metro Area","Reno, NV Metro Area","Modesto, CA Metro Area","Charleston-North Charleston, SC Metro Area","Fort Collins-Loveland, CO Metro Area","Albany, OR Metro Area","Lake Havasu City-Kingman, AZ Metro Area","Sherman-Denison, TX Metro Area","Lumberton, NC Micro Area","Florence, SC Metro Area","Gallup, NM Micro Area","El Paso, TX Metro Area","Olympia-Lacey-Tumwater, WA Metro Area","Bluefield, WV-VA Micro Area","Alamogordo, NM Micro Area","New Orleans-Metairie, LA Metro Area","Colorado Springs, CO Metro Area","Sierra Vista-Douglas, AZ Metro Area","Asheville, NC Metro Area","Huntsville, TX Micro Area","Sacramento-Roseville-Folsom, CA Metro Area","Clarksville, TN-KY Metro Area","LaGrange, GA-AL Micro Area","Stockton-Lodi, CA Metro Area","Bloomington, IN Metro Area","Dallas-Fort Worth-Arlington, TX Metro Area","Athens-Clarke County, GA Metro Area","Bend, OR Metro Area","Texarkana, TX-AR Metro Area","Klamath Falls, OR Micro Area","Lufkin, TX Micro Area","Granbury, TX Micro Area","San Francisco-Oakland-Fremont, CA Metro Area","Memphis, TN-MS-AR Metro Area","Shreveport-Bossier City, LA Metro Area","Corvallis, OR Metro Area","Bakersfield-Delano, CA Metro Area","Salem, OR Metro Area","Jacksonville, NC Metro Area","East Stroudsburg, PA Micro Area","Monroe, LA Metro Area","Pine Bluff, AR Micro Area","Wilmington, NC Metro Area","New York-Newark-Jersey City, NY-NJ Metro Area","Charlotte-Concord-Gastonia, NC-SC Metro Area","Nashville-Davidson--Murfreesboro--Franklin, TN Metro Area","Virginia Beach-Chesapeake-Norfolk, VA-NC Metro Area","Mobile, AL Metro Area","Palatka, FL Micro Area","Vineland, NJ Metro Area","Denver-Aurora-Centennial, CO Metro Area","Durham-Chapel Hill, NC Metro Area","Pikeville, KY Micro Area","Hanford-Corcoran, CA Metro Area","Shelton, WA Micro Area","Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","Danville, VA Micro Area","San Antonio-New Braunfels, TX Metro Area","Killeen-Temple, TX Metro Area","Boise City, ID Metro Area","Grand Junction, CO Metro Area","Danville, IL Micro Area","Mount Vernon-Anacortes, WA Metro Area","Valdosta, GA Metro Area","Columbus, GA-AL Metro Area","New Haven, CT Metro Area","Grants Pass, OR Metro Area","Bremerton-Silverdale-Port Orchard, WA Metro Area","Hammond, LA Metro Area","Tucson, AZ Metro Area","Dover, DE Metro Area","San Jose-Sunnyvale-Santa Clara, CA Metro Area","Carson City, NV Metro Area","Oak Harbor, WA Micro Area","Boston-Cambridge-Newton, MA-NH Metro Area","Hot Springs, AR Metro Area","Houston-Pasadena-The Woodlands, TX Metro Area","Heber, UT Micro Area","Wildwood-The Villages, FL Metro Area","Hattiesburg, MS Metro Area","Salisbury, MD Metro Area","Rio Grande City-Roma, TX Micro Area","Scranton--Wilkes-Barre, PA Metro Area","Tyler, TX Metro Area","Blacksburg-Christiansburg-Radford, VA Metro Area","Lafayette-West Lafayette, IN Metro Area","Pueblo, CO Metro Area","Barnstable Town, MA Metro Area","Redding, CA Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Albuquerque, NM Metro Area","Waco, TX Metro Area","Seattle-Tacoma-Bellevue, WA Metro Area","New Bern, NC Micro Area","Richmond, VA Metro Area","Chattanooga, TN-GA Metro Area","Houma-Bayou Cane-Thibodaux, LA Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Portland-Vancouver-Hillsboro, OR-WA Metro Area","Spokane-Spokane Valley, WA Metro Area","Odessa, TX Metro Area","Yuba City, CA Metro Area","Pensacola-Ferry Pass-Brent, FL Metro Area","Kapaa, HI Micro Area","Beaumont-Port Arthur, TX Metro Area","Visalia, CA Metro Area","Alexandria, LA Metro Area","Gainesville, GA Metro Area","Jackson, MS Metro Area","McAllen-Edinburg-Mission, TX Metro Area","Greensboro-High Point, NC Metro Area","Columbia, SC Metro Area","Fairbanks-College, AK Metro Area","Greenville, NC Metro Area","Salt Lake City-Murray, UT Metro Area","Lawton, OK Metro Area","State College, PA Metro Area","Ann Arbor, MI Metro Area","Brownsville-Harlingen, TX Metro Area","Brunswick-St. Simons, GA Metro Area","Terre Haute, IN Metro Area","Greeley, CO Metro Area","Meridian, MS Micro Area","Gulfport-Biloxi, MS Metro Area","Pinehurst-Southern Pines, NC Metro Area","Kalispell, MT Micro Area","Show Low, AZ Micro Area","Staunton-Stuarts Draft, VA Metro Area","Macon-Bibb County, GA Metro Area","Nacogdoches, TX Micro Area","Roseburg, OR Micro Area","Baton Rouge, LA Metro Area","Statesboro, GA Micro Area","Elmira, NY Metro Area","El Centro, CA Metro Area","Springfield, MA Metro Area","Amherst Town-Northampton, MA Metro Area","Corbin, KY Micro Area","Stillwater, OK Micro Area","Portland-South Portland, ME Metro Area","Farmington, NM Metro Area","Jackson, TN Metro Area","Greenville-Anderson-Greer, SC Metro Area","Athens, TX Micro Area","Manhattan, KS Metro Area","Kiryas Joel-Poughkeepsie-Newburgh, NY Metro Area","Twin Falls, ID Metro Area","Burlington-South Burlington, VT Metro Area","Goldsboro, NC Metro Area","Thomasville, GA Micro Area","Auburn-Opelika, AL Metro Area","Yuma, AZ Metro Area","Bridgeport-Stamford-Danbury, CT Metro Area","Philadelphia-Camden-Wilmington, PA-NJ-DE-MD Metro Area","Rexburg, ID Micro Area","Knoxville, TN Metro Area","Raleigh-Cary, NC Metro Area","Forest City, NC Micro Area","Charlottesville, VA Metro Area","Bangor, ME Metro Area","Birmingham, AL Metro Area","Sumter, SC Metro Area","Lancaster, PA Metro Area","Allentown-Bethlehem-Easton, PA-NJ Metro Area","Victoria, TX Metro Area","Roanoke, VA Metro Area","Dothan, AL Metro Area","Port Angeles, WA Micro Area","Longview-Kelso, WA Metro Area","Las Cruces, NM Metro Area","Baltimore-Columbia-Towson, MD Metro Area","Lafayette, LA Metro Area","Eagle Pass, TX Metro Area","Atlantic City-Hammonton, NJ Metro Area","Traverse City, MI Metro Area","Slidell-Mandeville-Covington, LA Metro Area","Augusta-Waterville, ME Micro Area","Tuscaloosa, AL Metro Area","Laredo, TX Metro Area","Spartanburg, SC Metro Area","Johnson City, TN Metro Area","Longview, TX Metro Area","Lake City, FL Micro Area","Rifle, CO Micro Area","Tulsa, OK Metro Area","Augusta-Richmond County, GA-SC Metro Area","Muskegon-Norton Shores, MI Metro Area","Greenfield, MA Micro Area","Montgomery, AL Metro Area","Oklahoma City, OK Metro Area","Norwich-New London-Willimantic, CT Metro Area","Detroit-Warren-Dearborn, MI Metro Area","Marion-Herrin, IL Micro Area","Sevierville, TN Micro Area","Madison, WI Metro Area","Lake Charles, LA Metro Area","Columbus, OH Metro Area","Kenosha, WI Metro Area","Albany, GA Metro Area","Orangeburg, SC Micro Area","Reading, PA Metro Area","Yakima, WA Metro Area","Manchester-Nashua, NH Metro Area","Centralia, WA Micro Area","South Bend-Mishawaka, IN-MI Metro Area","Elkhart-Goshen, IN Metro Area","Jonesboro, AR Metro Area","Washington-Arlington-Alexandria, DC-VA-MD-WV Metro Area","Rome, GA Metro Area","Beckley, WV Metro Area","Chicago-Naperville-Elgin, IL-IN Metro Area","Providence-Warwick, RI-MA Metro Area","Waterbury-Shelton, CT Metro Area","Lexington-Fayette, KY Metro Area","Greenwood, SC Micro Area","Santa Fe, NM Metro Area","Richmond, IN Micro Area","Muncie, IN Metro Area","Missoula, MT Metro Area","Opelousas, LA Micro Area","Kingston, NY Metro Area","Kankakee, IL Metro Area","Seaford, DE Micro Area","Champaign-Urbana, IL Metro Area","Michigan City-La Porte, IN Metro Area","Cleveland, TN Metro Area","Lawrence, KS Metro Area","Battle Creek, MI Metro Area","Amarillo, TX Metro Area","Kalamazoo-Portage, MI Metro Area","Fayetteville-Springdale-Rogers, AR Metro Area","Burlington, NC Metro Area","Winchester, VA-WV Metro Area","Lewiston-Auburn, ME Metro Area","Louisville/Jefferson County, KY-IN Metro Area","Albany-Schenectady-Troy, NY Metro Area","New Iberia, LA Micro Area","Idaho Falls, ID Metro Area","Oxford, MS Micro Area","Springfield, MO Metro Area","Kennewick-Richland, WA Metro Area","Columbia, MO Metro Area","Pocatello, ID Metro Area","Charleston, WV Metro Area","Harrisburg-Carlisle, PA Metro Area","Little Rock-North Little Rock-Conway, AR Metro Area","Lewiston, ID-WA Metro Area","Kansas City, MO-KS Metro Area","Rochester, NY Metro Area","Altoona, PA Metro Area","Anderson Creek, NC Micro Area","Kokomo, IN Metro Area","Aberdeen, WA Micro Area","Indianapolis-Carmel-Greenwood, IN Metro Area","Grand Rapids-Wyoming-Kentwood, MI Metro Area","Saginaw, MI Metro Area","Morristown, TN Metro Area","Flint, MI Metro Area","Provo-Orem-Lehi, UT Metro Area","Portsmouth, OH Micro Area","Winston-Salem, NC Metro Area","Lebanon-Claremont, NH-VT Micro Area","Hagerstown-Martinsburg, MD-WV Metro Area","Hermiston-Pendleton, OR Micro Area","Anniston-Oxford, AL Metro Area","Worcester, MA Metro Area","Wenatchee-East Wenatchee, WA Metro Area","Joplin, MO-KS Metro Area","Youngstown-Warren, OH Metro Area","Owosso, MI Micro Area","Dayton-Kettering-Beavercreek, OH Metro Area","Morgantown, WV Metro Area","Cleveland, OH Metro Area","Somerset, KY Micro Area","Trenton-Princeton, NJ Metro Area","Muskogee, OK Micro Area","Bowling Green, KY Metro Area","Warner Robins, GA Metro Area","Jackson, MI Metro Area","Cheyenne, WY Metro Area","Ogden, UT Metro Area","Concord, NH Micro Area","Anchorage, AK Metro Area","Harrisonburg, VA Metro Area","Hartford-West Hartford-East Hartford, CT Metro Area","Fort Payne, AL Micro Area","Plattsburgh, NY Micro Area","Buffalo-Cheektowaga, NY Metro Area","Kingsport-Bristol, TN-VA Metro Area","Lebanon, PA Metro Area","Wichita Falls, TX Metro Area","Minneapolis-St. Paul-Bloomington, MN-WI Metro Area","Niles, MI Metro Area","Enid, OK Metro Area","Rochester, MN Metro Area","Iowa City, IA Metro Area","Waterloo-Cedar Falls, IA Metro Area","Lansing-East Lansing, MI Metro Area","Utica-Rome, NY Metro Area","Whitewater-Elkhorn, WI Micro Area","Zanesville, OH Micro Area","Monticello, NY Micro Area","Rockford, IL Metro Area","Lexington Park, MD Metro Area","Erie, PA Metro Area","Logan, UT-ID Metro Area","Shawnee, OK Micro Area","Toledo, OH Metro Area","Mankato, MN Metro Area","Cookeville, TN Micro Area","Akron, OH Metro Area","Russellville, AR Micro Area","Fort Smith, AR-OK Metro Area","Morehead City, NC Micro Area","Huntsville, AL Metro Area","Topeka, KS Metro Area","Farmington, MO Micro Area","Rapid City, SD Metro Area","Milwaukee-Waukesha, WI Metro Area","Cumberland, MD-WV Micro Area","Syracuse, NY Metro Area","Gadsden, AL Metro Area","Evansville, IN Metro Area","Searcy, AR Micro Area","Casper, WY Metro Area","Clarksburg, WV Micro Area","Lynchburg, VA Metro Area","Brigham City, UT-ID Micro Area","Chambersburg, PA Metro Area","Great Falls, MT Metro Area","Jamestown-Dunkirk, NY Micro Area","Adrian, MI Micro Area","Sioux City, IA-NE-SD Metro Area","Walla Walla, WA Metro Area","Rocky Mount, NC Metro Area","Warsaw, IN Micro Area","Pittsburgh, PA Metro Area","Binghamton, NY Metro Area","Huntington-Ashland, WV-KY-OH Metro Area","Sanford, NC Micro Area","Brainerd, MN Micro Area","Omaha, NE-IA Metro Area","St. Joseph, MO-KS Metro Area","Wichita, KS Metro Area","Lincoln, NE Metro Area","Quincy, IL-MO Micro Area","Owensboro, KY Metro Area","Columbus, IN Metro Area","Midland, TX Metro Area","Mansfield, OH Metro Area","Chillicothe, OH Micro Area","Hickory-Lenoir-Morganton, NC Metro Area","Weirton-Steubenville, WV-OH Metro Area","Fort Wayne, IN Metro Area","Hermitage, PA Micro Area","Helena, MT Metro Area","Shelby-Kings Mountain, NC Micro Area","Duluth, MN-WI Metro Area","Cincinnati, OH-KY-IN Metro Area","Billings, MT Metro Area","Salem, OH Micro Area","York-Hanover, PA Metro Area","Elizabethtown, KY Metro Area","Decatur, IL Metro Area","Keene, NH Micro Area","St. Louis, MO-IL Metro Area","Lima, OH Metro Area","Dalton, GA Metro Area","Marion, IN Micro Area","Tullahoma-Manchester, TN Micro Area","St. Cloud, MN Metro Area","Racine-Mount Pleasant, WI Metro Area","New Philadelphia-Dover, OH Micro Area","Laurel, MS Micro Area","Williamsport, PA Metro Area","Moses Lake, WA Micro Area","Findlay, OH Micro Area","Auburn, NY Micro Area","Holland, MI Micro Area","North Wilkesboro, NC Micro Area","Canton-Massillon, OH Metro Area","Massena-Ogdensburg, NY Micro Area","Pittsfield, MA Metro Area","Gettysburg, PA Metro Area","Bay City, MI Metro Area","Monroe, MI Metro Area","Des Moines-West Des Moines, IA Metro Area","Putnam, CT Micro Area","Indiana, PA Micro Area","Minot, ND Metro Area","Stevens Point-Plover, WI Micro Area","Bloomsburg-Berwick, PA Micro Area","Ames, IA Metro Area","La Crosse-Onalaska, WI-MN Metro Area","Sandusky, OH Metro Area","Greeneville, TN Micro Area","Fargo, ND-MN Metro Area","Springfield, OH Metro Area","Marquette, MI Micro Area","Fond du Lac, WI Metro Area","Glens Falls, NY Metro Area","Baraboo, WI Micro Area","Parkersburg-Vienna, WV Metro Area","Cullman, AL Micro Area","Grand Island, NE Metro Area","Beaver Dam, WI Micro Area","Oshkosh-Neenah, WI Metro Area","Janesville-Beloit, WI Metro Area","Green Bay, WI Metro Area","Sunbury, PA Micro Area","Springfield, IL Metro Area","Olean, NY Micro Area","Wausau, WI Metro Area","Wheeling, WV-OH Metro Area","Peoria, IL Metro Area","Bloomington, IL Metro Area","Somerset, PA Micro Area","Jefferson, GA Micro Area","Tupelo, MS Micro Area","Albemarle, NC Micro Area","Eau Claire, WI Metro Area","Corning, NY Micro Area","Cape Girardeau, MO-IL Metro Area","DuBois, PA Micro Area","Johnstown, PA Metro Area","Sioux Falls, SD-MN Metro Area","Appleton, WI Metro Area","Davenport-Moline-Rock Island, IA-IL Metro Area","Athens, TN Micro Area","Wooster, OH Micro Area","Grand Forks, ND-MN Metro Area","Faribault-Northfield, MN Micro Area","Frankfort, KY Micro Area","Meadville, PA Micro Area","Torrington, CT Micro Area","Cedar Rapids, IA Metro Area","Richmond-Berea, KY Micro Area","Marinette, WI-MI Micro Area","Pottsville, PA Micro Area","Ottawa, IL Micro Area","Florence-Muscle Shoals, AL Metro Area","Sheboygan, WI Metro Area","Midland, MI Metro Area","Paducah, KY-IL Metro Area","Seneca, SC Micro Area","Dubuque, IA Metro Area","Albertville, AL Micro Area","Mount Airy, NC Micro Area","Talladega-Sylacauga, AL Micro Area","Decatur, AL Metro Area","Jefferson City, MO Metro Area","Wisconsin Rapids-Marshfield, WI Micro Area","Watertown-Fort Atkinson, WI Micro Area","Bismarck, ND Metro Area","Manitowoc, WI Micro Area","Laconia, NH Micro Area"],[80.31714427493365,79.59281869011508,77.6650518972025,77.59817026754057,75.99714095743492,73.99606480129862,73.49753494325738,72.75583688688107,72.64816688040764,72.02106822694691,71.892345216965,70.39006019637907,70.1374397879664,69.99973689158344,69.78370910370933,69.50355759306791,69.39183022469847,69.11286620878525,68.68680455200496,68.48114556520473,68.13448917982416,68.06155281983926,67.54083449571974,67.40697159462341,67.01581816863633,66.82261934574441,66.30927055857671,66.13547477423623,65.96629211829894,65.77878721699216,65.5991891609096,65.54789594035806,65.45635856292117,65.43568890264739,65.42254931254379,65.12287377459957,65.07755120618883,65.02237049031102,64.85475240160343,64.84787234573726,64.83986767972438,64.81348901195084,64.65498756968387,64.56246174751728,64.42579396859998,63.65141914073603,63.59430912146237,63.50396378144112,63.2830381453084,62.77213703040931,62.61867675708963,62.52566053801208,62.2309101416654,62.09517584944025,61.86078575275864,61.81612162429443,61.68132619611991,61.63556167277837,61.63018635774572,61.62195796461342,61.60477879257604,61.22632862802497,61.00588104216259,60.95609507297704,60.94280681013471,60.80399170971611,60.75671525992917,60.74238614107621,60.71936634971207,60.64103469194041,60.32916140826342,60.15745057958425,60.02901788605604,59.82148121788575,59.74936871791262,59.62247923392934,59.59635367049697,59.58218399076964,59.57752015989457,59.56672711034956,59.51871588783619,59.36304962872619,59.28571331114662,59.21569260491042,59.21056452381664,59.02943461756583,58.94349100507527,58.87527687330165,58.78378910749128,58.75199103711397,58.75033803815393,58.72375846093083,58.61966375571208,58.60919771903487,58.59417738602095,58.58798156550888,58.54526493941317,58.54180649680941,58.45397590656777,58.31268788176538,58.29681683574136,58.1952731257395,58.11118262348314,58.08155220802978,58.07682080572457,58.02540867407362,58.00071601383587,57.95629934403647,57.95359438598114,57.90988479570969,57.72113466094147,57.69327180201813,57.6841705820024,57.63611240205739,57.55694648791928,57.55106173080398,57.33760971910606,57.28479874278349,57.2687865441454,57.18133017039646,57.10794490976294,57.0934866994113,57.04398523843936,56.97730981209704,56.95031472128696,56.88359514438203,56.86437129722322,56.78989999237734,56.77435113910192,56.70037860279985,56.69906273890274,56.69439023502968,56.65111009272971,56.61645290548255,56.56773129119272,56.51576206586544,56.49992503883535,56.46869646691247,56.45754074158496,56.34178081199082,56.18695533186921,56.12661284311239,56.08562257888787,55.98585537057809,55.98295531548661,55.96988604172305,55.93964848257725,55.88083900742604,55.86800102233929,55.84019687284913,55.76352526610155,55.75718424769796,55.74793473232847,55.71297933390904,55.68152746884757,55.5714023667169,55.55403385281109,55.54714727512127,55.5305627248532,55.44395279537466,55.28498202285817,55.17565247076249,55.00501367686554,54.99606139230139,54.99598899564887,54.95137642226566,54.86701543432979,54.75134165322773,54.67064923618737,54.66084724530955,54.62378080089842,54.53723006509278,54.40074575882917,54.31187821604452,54.26966060848248,54.25911998541114,54.2513773223484,54.2220603600311,54.08024453134445,54.02071548360365,54.0059591514645,53.99090619244233,53.98912626024712,53.93691155758389,53.89866767078374,53.80037735060503,53.79717461357286,53.74975606174747,53.68272388717946,53.68268690387414,53.60946506407671,53.57113438406233,53.54066058886786,53.32705719902398,53.30351109939142,53.28761601858139,53.20585112049313,53.18802935157922,53.16302052670481,53.08139886899595,52.94421203125503,52.92553914050567,52.89102386252409,52.79441351557498,52.71418543019549,52.69451680934841,52.56472802322758,52.54220751286629,52.45818893125864,52.43146143869873,52.3946107111831,52.37148235447732,52.27645743413197,52.06441584790268,52.05468394868593,52.04586566374581,52.03205946660159,52.01323171070298,51.95136591635266,51.94605732407227,51.94396259858485,51.93780880608032,51.90760283475928,51.90074271279721,51.87695228775717,51.8744690177318,51.84403754468087,51.82932344245433,51.80485057483969,51.77876350847816,51.64624060948258,51.62678014467789,51.61224173912986,51.51119518665468,51.45947394689166,51.42452146794656,51.32635371055981,51.32156561226632,51.30692463572374,51.28755251741514,51.28096806837154,51.26349143379196,51.24704440862887,51.10683567922187,51.06185297318627,51.04134828632127,51.03203682256486,51.01356864494541,51.01336634054552,50.9433716137457,50.90712993441502,50.90538780080728,50.84858072618258,50.83278833440838,50.80611108929985,50.76647315833062,50.74698471478945,50.74622280089458,50.70279295127921,50.69876206364703,50.68699741372961,50.48435401055988,50.47737140514214,50.43450121220171,50.43192123095033,50.40489010629138,50.39271395182916,50.27141126200281,50.26177887876712,50.18989017069941,50.10507053171627,50.04618468281059,50.00596024641668,49.96378971024014,49.81042691164914,49.76890400691196,49.72481968096724,49.71916894626601,49.69405227923068,49.65908568341305,49.64436296003158,49.51344422171681,49.44707694616334,49.41686263024553,49.3639900296663,49.35364661704041,49.35308082103213,49.32381268612656,49.29961208081838,49.25164685383803,49.25042076977066,49.1787202102232,49.17239817312267,49.15503142842738,49.07755542047184,48.98422228171037,48.96134596619302,48.90405001614405,48.89064061617096,48.84063527304716,48.73910499935374,48.71061497120633,48.70687462920939,48.6904233863296,48.67459806625122,48.66839831161533,48.66296707124404,48.62364242667957,48.58988536317662,48.51629171918862,48.45343390375271,48.36675887235896,48.36139321417003,48.3580155069307,48.32683528411086,48.31647854659576,48.21491113653146,48.15622624031053,48.14079334048581,48.13995570067314,48.12185212754545,48.02410345038115,48.01122932460595,47.92748075418687,47.91647811856837,47.89703007820056,47.8866822395223,47.88250395632968,47.86285456192089,47.84538294194542,47.81194978322642,47.80467007604627,47.73718729781603,47.7238653720524,47.72314371731571,47.71288301410572,47.67408461605842,47.63991847152348,47.61930410959881,47.61594032979719,47.60090205085179,47.5420551864944,47.45202576461416,47.35947307925665,47.34903423376679,47.29046793615388,47.21629888337323,47.21609834187587,47.14597657897423,47.133755881182,47.08198416994234,47.06958222624019,47.06322417221712,47.05501241333733,47.03215141603007,46.93203404961192,46.90043502864899,46.87993210623209,46.86488290070267,46.83551508817668,46.74035957948448,46.65248704617072,46.56077153983355,46.52594545744628,46.45473200960659,46.39843271322072,46.33859447793002,46.16700307901401,46.12205859877561,46.10039883895503,46.05029000351733,46.02515286867761,45.98360879890556,45.87202303522311,45.84771500426015,45.76896514352619,45.7643393681852,45.67974129837345,45.570377145854,45.52336593853834,45.4712661131281,45.44628088594737,45.43150856829046,45.39211653081493,45.37446197743899,45.3490386391271,45.21530851540375,45.20405211670898,45.14759937930898,45.12758123182575,45.11181777245942,45.08237405277155,45.0544072052088,45.04151780370647,45.03177551239473,45.02758356615112,45.00058275616528,44.92482198212371,44.90279480381675,44.89375927722745,44.87278722015141,44.68401259620565,44.62563439565753,44.62379153018573,44.61910079849733,44.58058653876845,44.55671887810826,44.54936476486854,44.52846954214328,44.52711940591382,44.50817979632001,44.47451331729108,44.44567249606659,44.42416839310597,44.40665804763609,44.38288123961877,44.2998728345822,44.25041822633201,44.23464209726227,44.23409829576981,44.20947650132781,44.17334971416806,44.12024159489141,44.09335246549195,44.08996303062634,44.01949530975062,43.99085847561976,43.87667809708572,43.82415131925671,43.76869538402442,43.75815855714714,43.73525216788473,43.73520464130858,43.73236707214097,43.73231318428994,43.6684121914174,43.6408296869193,43.60081419059,43.58882659742534,43.56227602976849,43.50016685898602,43.48071795894893,43.46884322337591,43.45746361147925,43.39621211496523,43.38741296952031,43.36972058605378,43.35176264013212,43.24664902928008,43.24168533453665,43.23393666569373,43.22906478389316,43.09837190030681,43.07340363559906,43.00797062152048,42.89903173912509,42.8531523216629,42.76096276200231,42.74021907572887,42.50891510722179,42.49882545284648,42.37573628392089,42.37303752739653,42.26030418833921,42.24488956415859,42.24397009388539,42.12726628727528,42.06085585802386,42.03473784252515,41.9999412142995,41.956889845992,41.91650652476572,41.91645924431336,41.81651809805552,41.70960631739083,41.55386560176598,41.39391669617046,41.35331743144336,41.29109155081069,41.15237754122067,41.06326944708056,40.96841480271176,40.87980366500427,40.82429395074427,40.77206648058709,40.7544735304744,40.74788879741968,40.59897283562864,40.58006596799991,40.57524333283096,40.57200336016603,40.53670687139522,40.44549310154814,40.43833730635409,40.42991745018158,40.33861617332708,40.26618238390983,40.23728719873016,40.21403977854067,40.07954679413751,40.03087355993897,39.87736858583207,39.86868010929827,39.6477345966377,39.25298451765201,39.02512965580166,38.94263556577072,38.85797788875929,38.76303748935864,38.75297571432696,38.7499968331249,38.66954035339506,38.53476031057535,38.21669588033959,38.0465412683081,37.96230554516373,37.83063454578839,37.78872236433408,37.49864406817451,37.30940127022148,37.12826427940396,36.97432550557902,36.59539161390644,36.19643876604452,35.68506554417633,35.63944120329318,35.56280389577444,35.24318985990272,34.04749785565807,32.82379137088594],[0.3116883116883117,0.3088774072334429,0.3013962849595371,0.3011367361120216,0.2949235903741437,0.287157975021451,0.2852233204569512,0.2823449983121413,0.2819271612134729,0.2794935672115483,0.2789940293106568,0.2731640824672005,0.2721837335104869,0.2716493471889155,0.270811003929975,0.2697238144867118,0.2692902319044272,0.2682076507951669,0.2665542249957835,0.2657561201458418,0.2644108439352561,0.264127798377429,0.2621070365989174,0.2615875522221126,0.260069595476294,0.2593198450279811,0.2573276823555655,0.256653229658216,0.2559966792184303,0.2552690252829077,0.2545720555961961,0.2543730009926106,0.2540177701027769,0.2539375569481377,0.2538865658839927,0.2527236091663536,0.2525477249892349,0.2523335841065508,0.2516831053133948,0.2516564057461155,0.251625341882258,0.2515229736706246,0.2509078740255072,0.2505488072588907,0.250018437937901,0.24701330640727,0.2467916784391869,0.246441073512252,0.2455837230778397,0.2436010591350397,0.2430055228527921,0.2426445529932977,0.2415007093689244,0.2409739626479872,0.2400643604183427,0.2398910314619946,0.2393679282091299,0.2391903289288727,0.2391694688387581,0.2391375367526952,0.239070869203981,0.2376022102531186,0.2367467149977345,0.2365535096139861,0.2365019415926379,0.2359632391191261,0.2357797724763596,0.2357241651847461,0.2356348318304482,0.2353308486350421,0.2341205558871174,0.2334541943179559,0.2329557830538009,0.2321503914490647,0.2318705430608886,0.2313781205601786,0.2312767345755093,0.2312217460224271,0.2312036470027897,0.2311617622044565,0.2309754441148086,0.2303713470203857,0.2300712264611182,0.2297994957377837,0.2297795950932482,0.2290766807256466,0.2287431576687775,0.2284784377542718,0.2281233993932469,0.228,0.2279935851746258,0.2278904372897645,0.2274864749325589,0.2274458591794537,0.2273875694795351,0.2273635252377687,0.2271977539919284,0.2271843327461164,0.2268434868578052,0.2262951876583007,0.2262335965797755,0.2258395339195706,0.2255132022638086,0.2253982149313948,0.2253798536859876,0.2251803376217744,0.2250845123325404,0.2249121436938696,0.2249016465102725,0.2247320218489466,0.2239995355115904,0.2238914075703517,0.2238560882879418,0.223669587969671,0.2233623672592769,0.2233395301673145,0.2225111827733278,0.2223062381852552,0.2222440993330216,0.2219047056739682,0.2216199180586196,0.2215638097991039,0.2213717085119412,0.2211129598816787,0.2210081995051186,0.2207492795389049,0.2206746771794811,0.2203856749311295,0.2203253341923015,0.2200382675247869,0.2200331610260411,0.2200150283489309,0.2198470702547421,0.2197125754307733,0.219523500509873,0.2193218225213409,0.2192603634609904,0.2191391741315272,0.2190958818901959,0.2186466500687451,0.2180458158017765,0.2178116435261874,0.2176525718066046,0.21726540325124,0.2172541489507612,0.2172034307646114,0.2170860872778029,0.2168578641980777,0.2168080435784168,0.216700143472023,0.2164026024690737,0.2163779947550116,0.2163420999799237,0.2162064478820298,0.2160843920145191,0.2156570273781456,0.2155896250467417,0.2155629001700939,0.2154985401817025,0.2151624313354741,0.2145455103512837,0.2141212330214811,0.2134590317186533,0.2134242904129614,0.2134240094618569,0.2132508805763193,0.2129234992414939,0.2124746017381802,0.2121614570981359,0.212123418320544,0.211979573845207,0.211643694713022,0.2111140373979457,0.2107691673876324,0.2106053326927696,0.2105644274907868,0.2105343803868991,0.210420609478197,0.2098702620198423,0.2096392464807037,0.2095819812941401,0.2095235649818336,0.2095166575641726,0.2093140269469447,0.209165613147914,0.2087841759811874,0.2087717470569851,0.2085877289560605,0.2083275958859855,0.2083274523641496,0.2080432989392339,0.2078945483200802,0.20777628806742,0.2069473532173034,0.2068559774082209,0.2067942930574319,0.206476986419222,0.2064078251322487,0.2063107728967293,0.2059940221342596,0.2054616384915475,0.2053891742394311,0.205255230125523,0.2048803124637457,0.2045689697646537,0.2044926413632843,0.2039889674840985,0.2039015716993475,0.2035755191474528,0.2034717972446528,0.2033287899060886,0.2032390352401474,0.2028702701743804,0.2020473962460784,0.2020096294745656,0.2019754081838339,0.2019218302047167,0.2018487649643886,0.2016086811670078,0.2015880800091821,0.201579950967039,0.2015560698241829,0.2014388489208633,0.2014122267114753,0.2013199027440083,0.2013102658694823,0.2011921698571917,0.2011350685530754,0.20104009621737,0.200938859629036,0.2004245754245754,0.2003490548184284,0.2002926353438465,0.1999005020125729,0.1996997863864673,0.1995641456182344,0.1991831840833302,0.1991646028166932,0.1991077852928479,0.1990326075346751,0.1990070551345701,0.1989392332171541,0.1988754069251258,0.1983312961683584,0.1981567309018019,0.1980771579626948,0.1980410227832908,0.1979693529654191,0.1979685678787801,0.1976969379743523,0.197556294180984,0.1975495334490402,0.1973290811241778,0.1972677952807373,0.197164268374204,0.197010444680718,0.1969348154969414,0.196931858722797,0.1967633196565031,0.1967476769120801,0.1967020216051905,0.1959156193895871,0.1958885218562586,0.1957221546605623,0.1957121424768911,0.1956072422630694,0.1955599900224495,0.1950892483030252,0.1950518677251254,0.1947728878105709,0.1944437265796614,0.1942152071148145,0.194059107358263,0.193895455334246,0.1933002973240832,0.1931391585760518,0.192968079670674,0.1929461507540681,0.1928486800133669,0.192712984461511,0.1926558497011102,0.1921477907943591,0.191890238010886,0.1917729847245266,0.1915678009899967,0.1915276611064443,0.1915254654108157,0.1914118839876048,0.1913179682255538,0.1911318286316699,0.1911270705432642,0.19084882078035,0.1908242867274017,0.1907568912618076,0.1904562286033676,0.1900940288674612,0.1900052523026864,0.1897829027894093,0.1897308646688299,0.1895368079563515,0.1891427974386913,0.1890322356295858,0.1890177204112886,0.1889538777514846,0.1888924641225304,0.1888684046135328,0.1888473274928635,0.188694719576052,0.1885637178798915,0.188278121587186,0.188034188034188,0.1876978265456847,0.1876770039310724,0.1876638959965671,0.1875428942964131,0.1875027027027027,0.1871085480692021,0.1868808084453668,0.1868209176893614,0.1868176670441676,0.1867474121540736,0.1863680769519802,0.1863181160804432,0.1859931113662457,0.1859504132231405,0.1858749408327485,0.1858347837729281,0.1858185690276727,0.1857423152387181,0.1856745127815743,0.1855447680690399,0.1855165175670948,0.1852546358305801,0.1852029371728753,0.1852001366332329,0.1851603177217274,0.1850097520200613,0.1848771627951439,0.1847971642378889,0.1847841103518635,0.1847257510088178,0.1844973828320694,0.1841480038948393,0.1837888328797127,0.1837483226479797,0.1835210432720806,0.1832332139792265,0.1832324357339178,0.1829603128380065,0.1829128877372151,0.1827119762454635,0.1826638477801268,0.1826391739556033,0.1826073064224092,0.1825185893033117,0.1821300618825318,0.1820074349442379,0.181927868852459,0.1818694671064051,0.1817554988623044,0.1813862270197873,0.1810452183621763,0.1806892962040376,0.1805541459453973,0.1802777865264086,0.1800593047464827,0.1798270893371758,0.1791611912414306,0.1789867743184725,0.1789027188651693,0.1787082605280454,0.1786107103575357,0.1784494894739397,0.1780164564197317,0.1779221237688424,0.1776165176450261,0.1775985663082437,0.1772702649251486,0.1768458533208051,0.1766634160096815,0.1764612311988547,0.1763642705393665,0.1763069433174916,0.1761540738676929,0.1760855614973262,0.1759869006514078,0.1754679315463495,0.1754242486199141,0.1752051713784455,0.1751274865622272,0.1750663129973475,0.1749520501788399,0.1748435186868556,0.1747934985345057,0.1747556914341868,0.1747394236664623,0.1746346410953852,0.1743406347787215,0.1742551534773165,0.1742200891326706,0.1741387024608501,0.173406121087864,0.1731795716639209,0.1731724200198634,0.1731542166057139,0.1730047535651739,0.1729121298679261,0.1728835906169313,0.1728025021176777,0.1727972626176219,0.1727237633044725,0.1725931131412509,0.1724811900025945,0.1723977386099102,0.1723297858699833,0.1722375147463626,0.1719153824064325,0.1717234629415428,0.1716622402090974,0.1716601298680163,0.171564579589061,0.1714243816599863,0.1712182839434437,0.1711139347734011,0.1711007813272673,0.1708273158654838,0.1707161843435289,0.1702730823167514,0.1700692406233278,0.1698540316915151,0.1698131412214968,0.1697242479489517,0.1697240635116387,0.169713051701506,0.1697128425778692,0.1694648607458027,0.1693578207814619,0.1692025318627031,0.1691560113755962,0.1690529760687257,0.1688119477956676,0.1687364720691402,0.1686903895506952,0.1686462284683788,0.1684085285886186,0.1683743815729001,0.1683057223945614,0.1682360326428123,0.1678281161985998,0.1678088534913873,0.1677787830807509,0.1677598766738204,0.1672526942459285,0.1671557994130407,0.1669018722363346,0.166479110986074,0.166301065833957,0.1659433040078201,0.1658628035790371,0.1649651777473219,0.1649260226283725,0.1644483480845889,0.1644378749673941,0.1640003884949981,0.163940568661642,0.1639370004553806,0.1634841057119447,0.1632263854610725,0.1631250287678169,0.1629899928125173,0.1628229225260327,0.1626662061820066,0.162666022699831,0.1622781791400715,0.1618632845031196,0.1612588984638441,0.1606381816194951,0.1604806272593045,0.1602391460680495,0.159700835899692,0.1593550323770316,0.1589869281045752,0.1586430531304565,0.1584276354973198,0.1582249553330286,0.1581566820276498,0.1581311285253773,0.1575532274417033,0.1574798551909378,0.1574611398963731,0.1574485664711229,0.1573115906972354,0.1569576156377008,0.1569298460034221,0.1568971709029967,0.156542856253308,0.1562617610309061,0.1561496269209863,0.1560594102030566,0.1555374806496471,0.1553485934783126,0.1547528837248463,0.1547191661841343,0.1538617386144918,0.1523298242670805,0.1514455834509852,0.1511254470233504,0.1507969143214303,0.1504284772577456,0.15038943033071,0.1503778701282031,0.1500656410946915,0.1495425975480739,0.1483082786966848,0.1476479563678862,0.1473210611505857,0.146810082929633,0.1466474335078364,0.1455217209939813,0.1447873227689742,0.1440843809081561,0.1434869876996449,0.1420164515394869,0.1404682274247492,0.1384837313672063,0.1383066760957554,0.1380092681984939,0.1367689357622243,0.1321287904300335,0.1273799287556811]],"container":"<table class=\"table table-striped table-hover row-border order-column display\">\n  <thead>\n    <tr>\n      <th>NAME<\/th>\n      <th>rent_burden_index<\/th>\n      <th>rent_burden_raw<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"autoWidth":true,"class":"display nowrap compact","initComplete":"function(settings, json) {\n       $(this.api().table().header()).css({'background-color': '#f8f9fa', 'color': '#000'});\n       $(this.api().table().body()).css({'background-color': '#ffffff', 'color': '#000'});\n     }","columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"NAME","targets":0},{"name":"rent_burden_index","targets":1},{"name":"rent_burden_raw","targets":2}],"order":[],"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":["options.initComplete"],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="task-5-housing-growth" class="level2">
<h2 class="anchored" data-anchor-id="task-5-housing-growth">Task 5: Housing Growth</h2>
<p>Task 5 assessed how actively cities are building new housing relative to their population and growth trends. By merging housing-permit data with population data, we created two complementary indicators:</p>
<p>Instantaneous Growth — housing permits per 1,000 residents (current building rate)</p>
<p>Rate-Based Growth — housing permits relative to 5-year population growth (growth-adjusted rate) Standardizing both metrics allowed comparison across metros of different sizes. These measures directly inform the “YIMBY friendliness” of a city—quantifying whether housing production is keeping up with demand.</p>
<section id="step-1-join-population-and-permits" class="level3">
<h3 class="anchored" data-anchor-id="step-1-join-population-and-permits">Step 1: Join population and permits</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(CBSA, NAME, year, population) <span class="sc">|&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    PERMITS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(population), <span class="sc">!</span><span class="fu">is.na</span>(new_housing_units_permitted))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-2-calcualte-the-5-year-population-growth" class="level3">
<h3 class="anchored" data-anchor-id="step-2-calcualte-the-5-year-population-growth">Step 2: Calcualte the 5 year population growth</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(CBSA) <span class="sc">|&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_lag5  =</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_growth_5yr =</span> (population <span class="sc">-</span> pop_lag5) <span class="sc">/</span> pop_lag5</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-3-metrics" class="level3">
<h3 class="anchored" data-anchor-id="step-3-metrics">Step 3: Metrics</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_based_growth =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                                new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">NA_real_</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-4-standardize-the-metrics" class="level3">
<h3 class="anchored" data-anchor-id="step-4-standardize-the-metrics">Step 4: Standardize the metrics</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_based_growth =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                                new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">NA_real_</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-5-highest-to-lowest-ranking-for-cbsas-for-each-metric" class="level3">
<h3 class="anchored" data-anchor-id="step-5-highest-to-lowest-ranking-for-cbsas-for-each-metric">Step 5: Highest to lowest ranking for CBSAs for each metric</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_based_growth =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                                new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">NA_real_</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr); <span class="fu">library</span>(stringr)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Join POPULATION + PERMITS (CBSA + year)</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"housing_growth"</span>)) {</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(<span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(CBSA, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(PERMITS <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)),</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(population), <span class="sc">!</span><span class="fu">is.na</span>(new_housing_units_permitted))</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) 5-year population growth (starts in 2014)</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"pop_growth_5yr"</span> <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth)) {</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">pop_lag5 =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">pop_growth_5yr =</span> <span class="fu">if_else</span>(<span class="fu">is.finite</span>(pop_lag5) <span class="sc">&amp;</span> pop_lag5 <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>                               (population <span class="sc">-</span> pop_lag5) <span class="sc">/</span> pop_lag5,</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>                               <span class="cn">NA_real_</span>)</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Instantaneous &amp; rate-based raw metrics</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"instantaneous_growth"</span>,<span class="st">"rate_based_growth"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,  <span class="co"># units per 1,000 people</span></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">rate_based_growth =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>                                  new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr <span class="sc">*</span> <span class="dv">100</span>), <span class="co"># permits per 1% pop growth</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>                                  <span class="cn">NA_real_</span>)</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Safe scaler (0–100). If all NA or zero range, returns NA.</span></span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a>safe_scale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x)</span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(x))) <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a>  rng <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(rng[<span class="dv">1</span>]) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.finite</span>(rng[<span class="dv">2</span>]) <span class="sc">||</span> rng[<span class="dv">1</span>] <span class="sc">==</span> rng[<span class="dv">2</span>]) {</span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> rng[<span class="dv">1</span>]) <span class="sc">/</span> (rng[<span class="dv">2</span>] <span class="sc">-</span> rng[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Standardized indices</span></span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"inst_index"</span>,<span class="st">"rate_index"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">inst_index  =</span> <span class="fu">safe_scale01</span>(instantaneous_growth),</span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">rate_index  =</span> <span class="fu">safe_scale01</span>(rate_based_growth)</span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Composite index</span></span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb58-69"><a href="#cb58-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">composite_index =</span> (inst_index <span class="sc">+</span> rate_index) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb58-70"><a href="#cb58-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-71"><a href="#cb58-71" aria-hidden="true" tabindex="-1"></a><span class="co"># 7) Convenience table(s) for latest year used by Step 6</span></span>
<span id="cb58-72"><a href="#cb58-72" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="dv">2023</span></span>
<span id="cb58-73"><a href="#cb58-73" aria-hidden="true" tabindex="-1"></a>inst_rank <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb58-74"><a href="#cb58-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb58-75"><a href="#cb58-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(inst_index)) <span class="sc">%&gt;%</span></span>
<span id="cb58-76"><a href="#cb58-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-77"><a href="#cb58-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metric =</span> <span class="st">"Instantaneous growth"</span>)</span>
<span id="cb58-78"><a href="#cb58-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-79"><a href="#cb58-79" aria-hidden="true" tabindex="-1"></a>rate_rank <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb58-80"><a href="#cb58-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb58-81"><a href="#cb58-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(rate_index)) <span class="sc">%&gt;%</span></span>
<span id="cb58-82"><a href="#cb58-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-83"><a href="#cb58-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metric =</span> <span class="st">"Rate-based growth"</span>)</span>
<span id="cb58-84"><a href="#cb58-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-85"><a href="#cb58-85" aria-hidden="true" tabindex="-1"></a>top10_housing <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(inst_rank, rate_rank)</span>
<span id="cb58-86"><a href="#cb58-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-87"><a href="#cb58-87" aria-hidden="true" tabindex="-1"></a>composite_rank <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb58-88"><a href="#cb58-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb58-89"><a href="#cb58-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(composite_index)) <span class="sc">%&gt;%</span></span>
<span id="cb58-90"><a href="#cb58-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-6-complex-index" class="level3">
<h3 class="anchored" data-anchor-id="step-6-complex-index">Step 6: Complex Index</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">composite_index =</span> (inst_index <span class="sc">+</span> rate_index) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>composite_rank <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">|&gt;</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(composite_index)) <span class="sc">|&gt;</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>composite_rank</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 12
   CBSA  NAME     year population new_housing_units_pe…¹ pop_lag5 pop_growth_5yr
   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;                  &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;
 1 39460 Punta …  2023     206134                   4429   182033          0.132
 2 18880 Crestv…  2023     304818                   5596   271346          0.123
 3 35840 North …  2023     910108                  15928   804690          0.131
 4 19300 Daphne…  2023     253507                   4363   212628          0.192
 5 43300 Sherma…  2023     146907                   2447   131140          0.120
 6 15980 Cape C…  2023     834573                  13556   739224          0.129
 7 12420 Austin…  2023    2473275                  38773  2115827          0.169
 8 29460 Lakela…  2023     818330                  12513   686483          0.192
 9 15500 Burlin…  2023     179165                   2730   162391          0.103
10 41100 St. Ge…  2023     202452                   2820   165662          0.222
# ℹ abbreviated name: ¹​new_housing_units_permitted
# ℹ 5 more variables: instantaneous_growth &lt;dbl&gt;, rate_based_growth &lt;dbl&gt;,
#   inst_index &lt;dbl&gt;, rate_index &lt;dbl&gt;, composite_index &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="vizulizations" class="level3">
<h3 class="anchored" data-anchor-id="vizulizations">Vizulizations</h3>
<section id="part-a" class="level4">
<h4 class="anchored" data-anchor-id="part-a">Part A:</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(top10_housing,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(NAME, <span class="fu">ifelse</span>(metric<span class="sc">==</span><span class="st">"Instantaneous growth"</span>, inst_index, rate_index)),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="fu">ifelse</span>(metric<span class="sc">==</span><span class="st">"Instantaneous growth"</span>, inst_index, rate_index),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> metric)) <span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Instantaneous growth"</span><span class="ot">=</span><span class="st">"#2F6CFF"</span>, <span class="st">"Rate-based growth"</span><span class="ot">=</span><span class="st">"#FF7F0E"</span>)) <span class="sc">+</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 10 CBSAs by Housing Growth Metrics (2023)"</span>,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Metropolitan Area"</span>, <span class="at">y =</span> <span class="st">"Index (0–100)"</span>, <span class="at">fill =</span> <span class="st">"Metric"</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="part-b" class="level4">
<h4 class="anchored" data-anchor-id="part-b">Part B:</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(composite_rank,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(NAME, composite_index), <span class="at">y =</span> composite_index)) <span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2CA02C"</span>) <span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 10 CBSAs by Composite Housing Growth Index (2023)"</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Metropolitan Area"</span>, <span class="at">y =</span> <span class="st">"Composite Index (0–100)"</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="task-6-vizulization-for-the-investigation" class="level2">
<h2 class="anchored" data-anchor-id="task-6-vizulization-for-the-investigation">Task 6: Vizulization for the investigation</h2>
<p>In Task 6, we combined the Rent Burden Index and Housing Growth Index to examine how affordability trends relate to construction activity. This integration identifies cities that demonstrate true YIMBY success—those experiencing:</p>
<p>High initial rent burden but improvement over time, Sustained population growth, and Above-average housing construction.</p>
<p>The visualizations created here (quadrant plots and trend lines) make it easy to see which cities are reducing affordability pressures through increased housing supply—versus those becoming affordable only because of population loss.</p>
<section id="preliminary-metrics" class="level3">
<h3 class="anchored" data-anchor-id="preliminary-metrics">Preliminary Metrics</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>yimby_df <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">CBSA =</span> CBSA, NAME, year, rent_burden_index) <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    housing_growth <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(CBSA, year, composite_index, population),</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rent_burden_index), <span class="sc">!</span><span class="fu">is.na</span>(composite_index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>yimby_summary <span class="ot">&lt;-</span> yimby_df <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(CBSA, NAME) <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_early =</span> <span class="fu">mean</span>(rent_burden_index[year <span class="sc">&lt;=</span> <span class="dv">2012</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_late  =</span> <span class="fu">mean</span>(rent_burden_index[year <span class="sc">&gt;=</span> <span class="dv">2019</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change =</span> rent_burden_late <span class="sc">-</span> rent_burden_early,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_early =</span> <span class="fu">mean</span>(population[year <span class="sc">&lt;=</span> <span class="dv">2012</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_late  =</span> <span class="fu">mean</span>(population[year <span class="sc">&gt;=</span> <span class="dv">2019</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_change_pct =</span> (pop_late <span class="sc">-</span> pop_early) <span class="sc">/</span> pop_early <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_housing_index =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rent_burden_change), <span class="sc">!</span><span class="fu">is.na</span>(pop_change_pct))</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr); <span class="fu">library</span>(stringr); <span class="fu">library</span>(ggplot2)</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="co"># rent_income (if missing)</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"rent_income"</span>)) {</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">%&gt;%</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(RENT <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, monthly_rent), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(POPULATION <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, population), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a><span class="co"># rent burden columns</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"rent_burden_raw"</span> <span class="sc">%in%</span> <span class="fu">names</span>(rent_income))) {</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rent_burden_raw =</span> <span class="fu">if_else</span>(</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.finite</span>(household_income) <span class="sc">&amp;</span> household_income <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.finite</span>(monthly_rent),</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>      (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income, <span class="cn">NA_real_</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"rent_burden_index"</span> <span class="sc">%in%</span> <span class="fu">names</span>(rent_income))) {</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(base)</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(baseline_2009)) {</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>    baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(base)</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rent_burden_index =</span> <span class="dv">50</span> <span class="sc">*</span> (rent_burden_raw <span class="sc">/</span> baseline_2009))</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a><span class="co"># housing_growth (if missing)</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"housing_growth"</span>)) {</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(<span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(CBSA, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(PERMITS <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(population), <span class="sc">!</span><span class="fu">is.na</span>(new_housing_units_permitted))</span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 5-year population growth + raw growth metrics</span></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"pop_growth_5yr"</span> <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pop_lag5 =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a>           <span class="at">pop_growth_5yr =</span> <span class="fu">if_else</span>(<span class="fu">is.finite</span>(pop_lag5) <span class="sc">&amp;</span> pop_lag5 <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a>                                    (population <span class="sc">-</span> pop_lag5)<span class="sc">/</span>pop_lag5, <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"instantaneous_growth"</span>,<span class="st">"rate_based_growth"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">rate_based_growth =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a>                                  new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a>                                  <span class="cn">NA_real_</span>)</span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a><span class="co"># 0–100 scaling helpers</span></span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a>safe_scale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x)</span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(x))) <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(r[<span class="dv">1</span>]) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.finite</span>(r[<span class="dv">2</span>]) <span class="sc">||</span> r[<span class="dv">1</span>] <span class="sc">==</span> r[<span class="dv">2</span>]) <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> r[<span class="dv">1</span>])<span class="sc">/</span>(r[<span class="dv">2</span>] <span class="sc">-</span> r[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a><span class="co"># standardized indices + composite</span></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"inst_index"</span>,<span class="st">"rate_index"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">inst_index =</span> <span class="fu">safe_scale01</span>(instantaneous_growth),</span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a>           <span class="at">rate_index =</span> <span class="fu">safe_scale01</span>(rate_based_growth))</span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">composite_index =</span> (inst_index <span class="sc">+</span> rate_index)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a><span class="co"># merged analysis frame</span></span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a>yimby_df <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA, NAME, year, rent_burden_index, population) <span class="sc">%&gt;%</span></span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(housing_growth <span class="sc">%&gt;%</span> <span class="fu">select</span>(CBSA, year, composite_index), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(rent_burden_index), <span class="fu">is.finite</span>(composite_index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>yimby_summary <span class="ot">&lt;-</span> yimby_df <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_obs =</span> dplyr<span class="sc">::</span><span class="fu">n</span>(),</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">idx =</span> <span class="fu">row_number</span>(),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">idx_rev =</span> <span class="fu">rev</span>(idx)) <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># early = mean of first up to 3 available years</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_early =</span> <span class="fu">mean</span>(rent_burden_index[idx <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># late  = mean of last up to 3 available years</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_late  =</span> <span class="fu">mean</span>(rent_burden_index[idx_rev <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change =</span> rent_burden_late <span class="sc">-</span> rent_burden_early,</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_early =</span> <span class="fu">mean</span>(population[idx <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_late  =</span> <span class="fu">mean</span>(population[idx_rev <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_change_pct =</span> <span class="fu">if_else</span>(<span class="fu">is.finite</span>(pop_early) <span class="sc">&amp;</span> pop_early <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>                             (pop_late <span class="sc">-</span> pop_early)<span class="sc">/</span>pop_early <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_housing_index =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(rent_burden_change), <span class="fu">is.finite</span>(pop_change_pct), <span class="fu">is.finite</span>(avg_housing_index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot-1" class="level3">
<h3 class="anchored" data-anchor-id="plot-1">Plot 1:</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>y_thr <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.finite</span>(<span class="fu">mean</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="cf">else</span> <span class="fu">median</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>x_thr <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># zero = falling rent burden</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(yimby_summary, <span class="fu">aes</span>(<span class="at">x =</span> rent_burden_change, <span class="at">y =</span> avg_housing_index, <span class="at">size =</span> <span class="fu">pmax</span>(pop_change_pct, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"#2F6CFF"</span>) <span class="sc">+</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> y_thr, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> x_thr, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Population growth (%)"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Housing Growth vs Change in Rent Burden"</span>,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Upper-left = decreasing burden, above-average housing growth, and positive population growth"</span>,</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Change in Rent Burden Index (late − early)"</span>,</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Housing Growth Index (0–100)"</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-2" class="level3">
<h3 class="anchored" data-anchor-id="plot-2">Plot 2:</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>cands <span class="ot">&lt;-</span> yimby_summary <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>, avg_housing_index <span class="sc">&gt;=</span> y_thr, pop_change_pct <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(cands) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fallback 1: use median threshold for housing</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  y_med <span class="ot">&lt;-</span> <span class="fu">median</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  cands <span class="ot">&lt;-</span> yimby_summary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>, avg_housing_index <span class="sc">&gt;=</span> y_med, pop_change_pct <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(cands) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fallback 2: keep decreasing rent burden + nonnegative pop growth; take top by housing index</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  cands <span class="ot">&lt;-</span> yimby_summary <span class="sc">%&gt;%</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>, pop_change_pct <span class="sc">&gt;=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(avg_housing_index, <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  cands <span class="ot">&lt;-</span> cands <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(avg_housing_index, <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>yimby_df <span class="sc">%&gt;%</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">%in%</span> cands<span class="sc">$</span>CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index, <span class="at">color =</span> NAME, <span class="at">group =</span> NAME)) <span class="sc">+</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Evolution of Rent Burden in Candidate YIMBY CBSAs"</span>,</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Rent Burden Index (0–100)"</span>, <span class="at">color =</span> <span class="st">"CBSA"</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To explore YIMBY dynamics, I merged rent-burden and housing-growth indices and visualized their interaction. The first plot reveals that CBSAs with decreasing rent burden, rising housing-growth index, and positive population growth cluster in the upper left quadrant which are indicators of policy environments that support both affordability and expansion.</p>
<p>The second plot tracks these metros over time, showing steadily easing rent burdens despite growth pressures. Together, these visuals showcase constructive affordability driven by supply expansion from decline-driven affordability aka falling demand.</p>
</section>
</section>
<section id="task-7-policy-brief-extra-credit-3" class="level2">
<h2 class="anchored" data-anchor-id="task-7-policy-brief-extra-credit-3">Task 7: Policy Brief + Extra Credit 3</h2>
<p>Policy Brief: A Federal Incentive for YIMBY Growth with a Focus on Millennial Appeal</p>
<p>Purpose</p>
<p>Establish a federal YIMBY Incentive Program that rewards cities creating affordable, livable, and youth-friendly housing environments. By combining rent affordability, housing growth, and millennial appeal, this initiative aligns federal resources with cities that promote sustainable, inclusive growth.</p>
<p>Proposed Bill Sponsors</p>
<p>Primary Sponsor — Houston, TX Houston demonstrates YIMBY success: strong housing-permit activity, net population growth, and easing rent burden. Federal support reinforces policies that already make Houston one of America’s most affordable large metros for young professionals.</p>
<p>Co-Sponsor — New York City, NY New York represents the NIMBY challenge: persistently high rent burden and slower housing growth despite strong demand. Participation highlights bipartisan cooperation and the need to expand supply in high-cost metros.</p>
<p>Metrics for Federal Targeting</p>
<p>Rent Burden Index — Ratio of annual rent to median household income, standardized so 50 = national average (2009). Lower = more affordable.</p>
<p>Housing Growth Index — Composite of (a) permits per 1,000 residents and (b) permits relative to five-year population growth, scaled 0–100. Higher = more “building-friendly.”</p>
<p>Millennial Attraction Index (MAI) — Share of age 25–34 relative to the national average in the same year, scaled so 100 = national average. Higher = greater young-adult appeal.</p>
<p>Why This Bill Matters</p>
<p>Affordability without decline: Falling rent burden alongside population growth indicates supply-driven affordability.</p>
<p>Millennial retention: Youth-friendly metros attract and keep the talent base essential to long-run growth.</p>
<p>Broad coalitions: Construction trades, public services, and creative industries all benefit.</p>
<p>Cross-partisan appeal: High-growth metros earn recognition; high-cost metros receive tools to catch up.</p>
<p>Key Takeaway: A Federal YIMBY Incentive rewards metros like Houston that show supply-driven affordability and helps metros like New York expand housing so young workers and families can afford to live, work, and thrive.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr); <span class="fu">library</span>(stringr); <span class="fu">library</span>(tidyr)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 25–34 = (male 25–29, male 30–34, female 25–29, female 30–34)</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>A25_29_M <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01001_008"</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">m25_29 =</span> B01001_008)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>A30_34_M <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01001_009"</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">m30_34 =</span> B01001_009)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>A25_29_F <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01001_032"</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">f25_29 =</span> B01001_032)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>A30_34_F <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01001_033"</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">f30_34 =</span> B01001_033)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>YOUNG <span class="ot">&lt;-</span> A25_29_M <span class="sc">|&gt;</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(A30_34_M, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(A25_29_F, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(A30_34_F, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">young_25_34 =</span> m25_29 <span class="sc">+</span> m30_34 <span class="sc">+</span> f25_29 <span class="sc">+</span> f30_34) <span class="sc">|&gt;</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, young_25_34)</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with total population (you already have it)</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>MAI <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, population) <span class="sc">|&gt;</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(YOUNG, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">CBSA =</span> <span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">young_share =</span> young_25_34 <span class="sc">/</span> population</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Within-year national baseline so 100 = US average in that year</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>MAI <span class="ot">&lt;-</span> MAI <span class="sc">|&gt;</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_avg_share =</span> <span class="fu">mean</span>(young_share, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAI =</span> <span class="dv">100</span> <span class="sc">*</span> (young_share <span class="sc">/</span> us_avg_share)</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rent burden join</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"rent_income"</span>)) {</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(RENT <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, monthly_rent), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(POPULATION <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, population), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"rent_burden_raw"</span> <span class="sc">%in%</span> <span class="fu">names</span>(rent_income))) {</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rent_burden_raw =</span> <span class="fu">if_else</span>(</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.finite</span>(household_income) <span class="sc">&amp;</span> household_income <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.finite</span>(monthly_rent),</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>      (monthly_rent<span class="sc">*</span><span class="dv">12</span>) <span class="sc">/</span> household_income, <span class="cn">NA_real_</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"rent_burden_index"</span> <span class="sc">%in%</span> <span class="fu">names</span>(rent_income))) {</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(base)</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(baseline_2009)) {</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>    baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(base)</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">rent_burden_index =</span> <span class="dv">50</span> <span class="sc">*</span> (rent_burden_raw <span class="sc">/</span> baseline_2009))</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Housing growth join</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"housing_growth"</span>)) {</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(<span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(CBSA, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(PERMITS <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(population), <span class="sc">!</span><span class="fu">is.na</span>(new_housing_units_permitted))</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 5-year growth + metrics</span></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"pop_growth_5yr"</span> <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pop_lag5 =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">pop_growth_5yr =</span> <span class="fu">if_else</span>(<span class="fu">is.finite</span>(pop_lag5) <span class="sc">&amp;</span> pop_lag5 <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>                                    (population <span class="sc">-</span> pop_lag5)<span class="sc">/</span>pop_lag5, <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"instantaneous_growth"</span>,<span class="st">"rate_based_growth"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,        </span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">rate_based_growth    =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>                                     new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr<span class="sc">*</span><span class="dv">100</span>),</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>                                     <span class="cn">NA_real_</span>)</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>safe_scale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x)</span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(x))) <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(r[<span class="dv">1</span>]) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.finite</span>(r[<span class="dv">2</span>]) <span class="sc">||</span> r[<span class="dv">1</span>] <span class="sc">==</span> r[<span class="dv">2</span>]) <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> r[<span class="dv">1</span>])<span class="sc">/</span>(r[<span class="dv">2</span>]<span class="sc">-</span>r[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"inst_index"</span>,<span class="st">"rate_index"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">inst_index =</span> <span class="fu">safe_scale01</span>(instantaneous_growth),</span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a>           <span class="at">rate_index =</span> <span class="fu">safe_scale01</span>(rate_based_growth))</span>
<span id="cb69-68"><a href="#cb69-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-69"><a href="#cb69-69" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb69-70"><a href="#cb69-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">composite_index =</span> (inst_index <span class="sc">+</span> rate_index)<span class="sc">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Merge Rent Burden + Housing Growth + MAI ----</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>yimby_df <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA, NAME, year, rent_burden_index, population) <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(housing_growth <span class="sc">%&gt;%</span> <span class="fu">select</span>(CBSA, year, composite_index), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(MAI <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">CBSA =</span> CBSA, year, MAI), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(rent_burden_index), <span class="fu">is.finite</span>(composite_index), <span class="fu">is.finite</span>(MAI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Summary for quadrants with millennial appeal ----</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>yimby_summary <span class="ot">&lt;-</span> yimby_df <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_obs =</span> <span class="fu">n</span>(), <span class="at">idx =</span> <span class="fu">row_number</span>(), <span class="at">idx_rev =</span> <span class="fu">rev</span>(idx)) <span class="sc">%&gt;%</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_early =</span> <span class="fu">mean</span>(rent_burden_index[idx <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_late  =</span> <span class="fu">mean</span>(rent_burden_index[idx_rev <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change =</span> rent_burden_late <span class="sc">-</span> rent_burden_early,</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_early =</span> <span class="fu">mean</span>(population[idx <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_late  =</span> <span class="fu">mean</span>(population[idx_rev <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_change_pct =</span> <span class="fu">if_else</span>(<span class="fu">is.finite</span>(pop_early) <span class="sc">&amp;</span> pop_early <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>                             (pop_late <span class="sc">-</span> pop_early)<span class="sc">/</span>pop_early <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_housing_index =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_MAI =</span> <span class="fu">mean</span>(MAI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(rent_burden_change), <span class="fu">is.finite</span>(pop_change_pct), <span class="fu">is.finite</span>(avg_housing_index), <span class="fu">is.finite</span>(avg_MAI))</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>y_thr <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.finite</span>(<span class="fu">mean</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="cf">else</span> <span class="fu">median</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>  yimby_summary,</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> rent_burden_change, <span class="at">y =</span> avg_housing_index, <span class="at">size =</span> <span class="fu">pmax</span>(pop_change_pct, <span class="dv">0</span>), <span class="at">color =</span> avg_MAI)</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> y_thr, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,   <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_c</span>(<span class="at">name =</span> <span class="st">"Millennial Appeal (MAI)"</span>, <span class="at">option =</span> <span class="st">"C"</span>) <span class="sc">+</span></span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Population growth (%)"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Housing Growth vs Change in Rent Burden (Colored by Millennial Attraction)"</span>,</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Upper-left = decreasing burden, above-average housing growth, and positive population growth"</span>,</span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Change in Rent Burden Index (late − early)"</span>,</span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Housing Growth Index (0–100)"</span></span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Plot 2: Rent Burden paths over time for top YIMBY + high MAI cities ----</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>cands <span class="ot">&lt;-</span> yimby_summary <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>, avg_housing_index <span class="sc">&gt;=</span> y_thr, pop_change_pct <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(avg_housing_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span> scales<span class="sc">::</span><span class="fu">rescale</span>(avg_MAI, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(score, <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>yimby_df <span class="sc">%&gt;%</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">%in%</span> cands<span class="sc">$</span>CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index, <span class="at">color =</span> NAME, <span class="at">group =</span> NAME)) <span class="sc">+</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Evolution of Rent Burden in High-Growth, Millennial-Friendly CBSAs"</span>,</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Rent Burden Index (0–100)"</span>, <span class="at">color =</span> <span class="st">"CBSA"</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Our targeting combines three signals: (1) affordability gains (falling Rent Burden Index), (2) strong Housing Growth (permits per 1,000 residents and relative to 5-year population growth), and (3) Millennial Attraction (25–34 share relative to national average). Metros in the upper-left quadrant of Plot 1 (↓ rent burden, ↑ housing growth, ↑ population) with deeper color (↑ MAI) represent the strongest YIMBY successes.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/Wanderloost\.github\.io\/STA9750-2025-FALL\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb73" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Mini-Project #02: Making Backyards Affordable for All"</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Ryan Ram" </span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true       </span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show Code"  </span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true      </span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task #1</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>This first task focused on importing, cleaning, and aligning multiple data sources from the American Community Survey and Bureau of Labor Statistics.</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>By consolidating indicators like income, rent, population, and housing permits, this step established a unified analytic foundation.</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>The goal was to make these disparate data sets directly comparable, ensuring that subsequent analyses could reliably track housing affordability and economic activity across the same geographies and time periods.</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>This integration allows all further tasks to operate from a consistent, standardized data set.</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>library <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Mask base::library() to automatically install packages if needed</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Masking is important here so downlit picks up packages and links</span></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>    <span class="do">## to documentation</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Pretty numbers + a consistent ggplot style + palette</span></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple palette</span></span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">blue   =</span> <span class="st">"#2F6CFF"</span>,</span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">green  =</span> <span class="st">"#2CA02C"</span>,</span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">orange =</span> <span class="st">"#FF7F0E"</span>,</span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">purple =</span> <span class="st">"#8E44AD"</span>,</span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">gray   =</span> <span class="st">"#7F8C8D"</span></span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a>        YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb73-70"><a href="#cb73-70" aria-hidden="true" tabindex="-1"></a>            tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-71"><a href="#cb73-71" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb73-72"><a href="#cb73-72" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb73-73"><a href="#cb73-73" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb73-74"><a href="#cb73-74" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb73-75"><a href="#cb73-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-76"><a href="#cb73-76" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb73-77"><a href="#cb73-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb73-78"><a href="#cb73-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-79"><a href="#cb73-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb73-80"><a href="#cb73-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-81"><a href="#cb73-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-82"><a href="#cb73-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb73-83"><a href="#cb73-83" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-84"><a href="#cb73-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb73-85"><a href="#cb73-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-86"><a href="#cb73-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb73-87"><a href="#cb73-87" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-88"><a href="#cb73-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb73-89"><a href="#cb73-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-90"><a href="#cb73-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb73-91"><a href="#cb73-91" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-92"><a href="#cb73-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb73-93"><a href="#cb73-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-94"><a href="#cb73-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb73-95"><a href="#cb73-95" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-96"><a href="#cb73-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span>
<span id="cb73-97"><a href="#cb73-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-98"><a href="#cb73-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-99"><a href="#cb73-99" aria-hidden="true" tabindex="-1"></a>This second block of code is meant to assist us in pulling the number of new housing built each year.</span>
<span id="cb73-100"><a href="#cb73-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-103"><a href="#cb73-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-104"><a href="#cb73-104" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb73-105"><a href="#cb73-105" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb73-106"><a href="#cb73-106" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb73-107"><a href="#cb73-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-108"><a href="#cb73-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb73-109"><a href="#cb73-109" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb73-110"><a href="#cb73-110" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-111"><a href="#cb73-111" aria-hidden="true" tabindex="-1"></a>        HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb73-112"><a href="#cb73-112" aria-hidden="true" tabindex="-1"></a>            historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb73-113"><a href="#cb73-113" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb73-114"><a href="#cb73-114" aria-hidden="true" tabindex="-1"></a>            LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb73-115"><a href="#cb73-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-116"><a href="#cb73-116" aria-hidden="true" tabindex="-1"></a>            CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb73-117"><a href="#cb73-117" aria-hidden="true" tabindex="-1"></a>            CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb73-118"><a href="#cb73-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-119"><a href="#cb73-119" aria-hidden="true" tabindex="-1"></a>            PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb73-120"><a href="#cb73-120" aria-hidden="true" tabindex="-1"></a>            PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb73-121"><a href="#cb73-121" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-122"><a href="#cb73-122" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb73-123"><a href="#cb73-123" aria-hidden="true" tabindex="-1"></a>                       <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb73-124"><a href="#cb73-124" aria-hidden="true" tabindex="-1"></a>                       <span class="at">year =</span> yy)</span>
<span id="cb73-125"><a href="#cb73-125" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb73-126"><a href="#cb73-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-127"><a href="#cb73-127" aria-hidden="true" tabindex="-1"></a>        CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb73-128"><a href="#cb73-128" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-129"><a href="#cb73-129" aria-hidden="true" tabindex="-1"></a>        CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb73-130"><a href="#cb73-130" aria-hidden="true" tabindex="-1"></a>            current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb73-131"><a href="#cb73-131" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-132"><a href="#cb73-132" aria-hidden="true" tabindex="-1"></a>            temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb73-133"><a href="#cb73-133" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-134"><a href="#cb73-134" aria-hidden="true" tabindex="-1"></a>            <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb73-135"><a href="#cb73-135" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-136"><a href="#cb73-136" aria-hidden="true" tabindex="-1"></a>            fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb73-137"><a href="#cb73-137" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(...){</span>
<span id="cb73-138"><a href="#cb73-138" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb73-139"><a href="#cb73-139" aria-hidden="true" tabindex="-1"></a>                             <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb73-140"><a href="#cb73-140" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb73-141"><a href="#cb73-141" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb73-142"><a href="#cb73-142" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-143"><a href="#cb73-143" aria-hidden="true" tabindex="-1"></a>            reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb73-144"><a href="#cb73-144" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-145"><a href="#cb73-145" aria-hidden="true" tabindex="-1"></a>            <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-146"><a href="#cb73-146" aria-hidden="true" tabindex="-1"></a>                <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb73-147"><a href="#cb73-147" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb73-148"><a href="#cb73-148" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb73-149"><a href="#cb73-149" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb73-150"><a href="#cb73-150" aria-hidden="true" tabindex="-1"></a>        }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb73-151"><a href="#cb73-151" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-152"><a href="#cb73-152" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb73-153"><a href="#cb73-153" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-154"><a href="#cb73-154" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb73-155"><a href="#cb73-155" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-156"><a href="#cb73-156" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb73-157"><a href="#cb73-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-158"><a href="#cb73-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb73-159"><a href="#cb73-159" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-160"><a href="#cb73-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-161"><a href="#cb73-161" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span>
<span id="cb73-162"><a href="#cb73-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-163"><a href="#cb73-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-166"><a href="#cb73-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-167"><a href="#cb73-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick preview</span></span>
<span id="cb73-168"><a href="#cb73-168" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb73-169"><a href="#cb73-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-170"><a href="#cb73-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Total new units permitted by year (national sum across CBSAs)</span></span>
<span id="cb73-171"><a href="#cb73-171" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="sc">|&gt;</span></span>
<span id="cb73-172"><a href="#cb73-172" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb73-173"><a href="#cb73-173" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-174"><a href="#cb73-174" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(year, total_units)) <span class="sc">+</span></span>
<span id="cb73-175"><a href="#cb73-175" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb73-176"><a href="#cb73-176" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"New housing units permitted per year (sum over CBSAs)"</span>,</span>
<span id="cb73-177"><a href="#cb73-177" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Units permitted"</span>)</span>
<span id="cb73-178"><a href="#cb73-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-179"><a href="#cb73-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 CBSAs (all years combined) — needs CBSA names from ACS</span></span>
<span id="cb73-180"><a href="#cb73-180" aria-hidden="true" tabindex="-1"></a><span class="co"># (Run this AFTER you build ACS in your later block; if ACS isn't built yet, skip this chunk)</span></span>
<span id="cb73-181"><a href="#cb73-181" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"ACS"</span>)) {</span>
<span id="cb73-182"><a href="#cb73-182" aria-hidden="true" tabindex="-1"></a>  CBSA_NAMES <span class="ot">&lt;-</span> ACS <span class="sc">|&gt;</span></span>
<span id="cb73-183"><a href="#cb73-183" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">|&gt;</span></span>
<span id="cb73-184"><a href="#cb73-184" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(CBSA, NAME)</span>
<span id="cb73-185"><a href="#cb73-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-186"><a href="#cb73-186" aria-hidden="true" tabindex="-1"></a>  PERMITS <span class="sc">|&gt;</span></span>
<span id="cb73-187"><a href="#cb73-187" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)) <span class="sc">|&gt;</span></span>
<span id="cb73-188"><a href="#cb73-188" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(CBSA) <span class="sc">|&gt;</span></span>
<span id="cb73-189"><a href="#cb73-189" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-190"><a href="#cb73-190" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(CBSA_NAMES, <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-191"><a href="#cb73-191" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_max</span>(total_units, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-192"><a href="#cb73-192" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(NAME, total_units), <span class="at">y =</span> total_units <span class="sc">/</span> <span class="fl">1e3</span>)) <span class="sc">+</span></span>
<span id="cb73-193"><a href="#cb73-193" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#FF7F0E"</span>) <span class="sc">+</span></span>
<span id="cb73-194"><a href="#cb73-194" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb73-195"><a href="#cb73-195" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-196"><a href="#cb73-196" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Top 10 CBSAs by Total Housing Units Permitted (All Years)"</span>,</span>
<span id="cb73-197"><a href="#cb73-197" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"CBSA"</span>,</span>
<span id="cb73-198"><a href="#cb73-198" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Total units permitted (thousands)"</span></span>
<span id="cb73-199"><a href="#cb73-199" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-200"><a href="#cb73-200" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-201"><a href="#cb73-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-202"><a href="#cb73-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-203"><a href="#cb73-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-204"><a href="#cb73-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-207"><a href="#cb73-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-208"><a href="#cb73-208" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb73-209"><a href="#cb73-209" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb73-210"><a href="#cb73-210" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb73-211"><a href="#cb73-211" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb73-212"><a href="#cb73-212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(dplyr)</span>
<span id="cb73-213"><a href="#cb73-213" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(tidyr)</span>
<span id="cb73-214"><a href="#cb73-214" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(readr)</span>
<span id="cb73-215"><a href="#cb73-215" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-216"><a href="#cb73-216" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb73-217"><a href="#cb73-217" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-218"><a href="#cb73-218" aria-hidden="true" tabindex="-1"></a>        resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-219"><a href="#cb73-219" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-220"><a href="#cb73-220" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-221"><a href="#cb73-221" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-222"><a href="#cb73-222" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_perform</span>()</span>
<span id="cb73-223"><a href="#cb73-223" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-224"><a href="#cb73-224" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb73-225"><a href="#cb73-225" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-226"><a href="#cb73-226" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb73-227"><a href="#cb73-227" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-228"><a href="#cb73-228" aria-hidden="true" tabindex="-1"></a>            <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb73-229"><a href="#cb73-229" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb73-230"><a href="#cb73-230" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-231"><a href="#cb73-231" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-232"><a href="#cb73-232" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb73-233"><a href="#cb73-233" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-234"><a href="#cb73-234" aria-hidden="true" tabindex="-1"></a>        <span class="co"># These were looked up manually on bls.gov after finding </span></span>
<span id="cb73-235"><a href="#cb73-235" aria-hidden="true" tabindex="-1"></a>        <span class="co"># they were presented as ranges. Since there are only three</span></span>
<span id="cb73-236"><a href="#cb73-236" aria-hidden="true" tabindex="-1"></a>        <span class="co"># it was easier to manually handle than to special-case everything else</span></span>
<span id="cb73-237"><a href="#cb73-237" aria-hidden="true" tabindex="-1"></a>        naics_missing <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb73-238"><a href="#cb73-238" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span>Code, <span class="sc">~</span>title, <span class="sc">~</span>depth, </span>
<span id="cb73-239"><a href="#cb73-239" aria-hidden="true" tabindex="-1"></a>            <span class="st">"31"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb73-240"><a href="#cb73-240" aria-hidden="true" tabindex="-1"></a>            <span class="st">"32"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb73-241"><a href="#cb73-241" aria-hidden="true" tabindex="-1"></a>            <span class="st">"33"</span>, <span class="st">"Manufacturing"</span>, <span class="dv">1</span>,</span>
<span id="cb73-242"><a href="#cb73-242" aria-hidden="true" tabindex="-1"></a>            <span class="st">"44"</span>, <span class="st">"Retail"</span>, <span class="dv">1</span>, </span>
<span id="cb73-243"><a href="#cb73-243" aria-hidden="true" tabindex="-1"></a>            <span class="st">"45"</span>, <span class="st">"Retail"</span>, <span class="dv">1</span>,</span>
<span id="cb73-244"><a href="#cb73-244" aria-hidden="true" tabindex="-1"></a>            <span class="st">"48"</span>, <span class="st">"Transportation and Warehousing"</span>, <span class="dv">1</span>, </span>
<span id="cb73-245"><a href="#cb73-245" aria-hidden="true" tabindex="-1"></a>            <span class="st">"49"</span>, <span class="st">"Transportation and Warehousing"</span>, <span class="dv">1</span></span>
<span id="cb73-246"><a href="#cb73-246" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb73-247"><a href="#cb73-247" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-248"><a href="#cb73-248" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(naics_table, naics_missing)</span>
<span id="cb73-249"><a href="#cb73-249" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-250"><a href="#cb73-250" aria-hidden="true" tabindex="-1"></a>        naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb73-251"><a href="#cb73-251" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-252"><a href="#cb73-252" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb73-253"><a href="#cb73-253" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb73-254"><a href="#cb73-254" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb73-255"><a href="#cb73-255" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-256"><a href="#cb73-256" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb73-257"><a href="#cb73-257" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb73-258"><a href="#cb73-258" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb73-259"><a href="#cb73-259" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb73-260"><a href="#cb73-260" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb73-261"><a href="#cb73-261" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb73-262"><a href="#cb73-262" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-263"><a href="#cb73-263" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb73-264"><a href="#cb73-264" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb73-265"><a href="#cb73-265" aria-hidden="true" tabindex="-1"></a>                   level1_code,  level2_code,  level3_code,  level4_code) <span class="sc">|&gt;</span></span>
<span id="cb73-266"><a href="#cb73-266" aria-hidden="true" tabindex="-1"></a>            <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb73-267"><a href="#cb73-267" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"code"</span>), as.integer))</span>
<span id="cb73-268"><a href="#cb73-268" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-269"><a href="#cb73-269" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb73-270"><a href="#cb73-270" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb73-271"><a href="#cb73-271" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-272"><a href="#cb73-272" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb73-273"><a href="#cb73-273" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-274"><a href="#cb73-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-275"><a href="#cb73-275" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span>
<span id="cb73-276"><a href="#cb73-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-277"><a href="#cb73-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-280"><a href="#cb73-280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-281"><a href="#cb73-281" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb73-282"><a href="#cb73-282" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb73-283"><a href="#cb73-283" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb73-284"><a href="#cb73-284" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb73-285"><a href="#cb73-285" aria-hidden="true" tabindex="-1"></a>    fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb73-286"><a href="#cb73-286" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-287"><a href="#cb73-287" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb73-288"><a href="#cb73-288" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year to match ACS</span></span>
<span id="cb73-289"><a href="#cb73-289" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-290"><a href="#cb73-290" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb73-291"><a href="#cb73-291" aria-hidden="true" tabindex="-1"></a>        ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb73-292"><a href="#cb73-292" aria-hidden="true" tabindex="-1"></a>            fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb73-293"><a href="#cb73-293" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-294"><a href="#cb73-294" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb73-295"><a href="#cb73-295" aria-hidden="true" tabindex="-1"></a>                <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-296"><a href="#cb73-296" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb73-297"><a href="#cb73-297" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-298"><a href="#cb73-298" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-299"><a href="#cb73-299" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-300"><a href="#cb73-300" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb73-301"><a href="#cb73-301" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb73-302"><a href="#cb73-302" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-303"><a href="#cb73-303" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb73-304"><a href="#cb73-304" aria-hidden="true" tabindex="-1"></a>                <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb73-305"><a href="#cb73-305" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb73-306"><a href="#cb73-306" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb73-307"><a href="#cb73-307" aria-hidden="true" tabindex="-1"></a>            <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb73-308"><a href="#cb73-308" aria-hidden="true" tabindex="-1"></a>                     <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-309"><a href="#cb73-309" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb73-310"><a href="#cb73-310" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(area_fips, </span>
<span id="cb73-311"><a href="#cb73-311" aria-hidden="true" tabindex="-1"></a>                       industry_code, </span>
<span id="cb73-312"><a href="#cb73-312" aria-hidden="true" tabindex="-1"></a>                       annual_avg_emplvl, </span>
<span id="cb73-313"><a href="#cb73-313" aria-hidden="true" tabindex="-1"></a>                       total_annual_wages, </span>
<span id="cb73-314"><a href="#cb73-314" aria-hidden="true" tabindex="-1"></a>                       YEAR) <span class="sc">|&gt;</span></span>
<span id="cb73-315"><a href="#cb73-315" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb73-316"><a href="#cb73-316" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-317"><a href="#cb73-317" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-318"><a href="#cb73-318" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb73-319"><a href="#cb73-319" aria-hidden="true" tabindex="-1"></a>                       <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb73-320"><a href="#cb73-320" aria-hidden="true" tabindex="-1"></a>                       <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb73-321"><a href="#cb73-321" aria-hidden="true" tabindex="-1"></a>                       <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb73-322"><a href="#cb73-322" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb73-323"><a href="#cb73-323" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>industry_code, </span>
<span id="cb73-324"><a href="#cb73-324" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb73-325"><a href="#cb73-325" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb73-326"><a href="#cb73-326" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span id="cb73-327"><a href="#cb73-327" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-328"><a href="#cb73-328" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb73-329"><a href="#cb73-329" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb73-330"><a href="#cb73-330" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-331"><a href="#cb73-331" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb73-332"><a href="#cb73-332" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb73-333"><a href="#cb73-333" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-334"><a href="#cb73-334" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb73-335"><a href="#cb73-335" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-336"><a href="#cb73-336" aria-hidden="true" tabindex="-1"></a>    ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb73-337"><a href="#cb73-337" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-338"><a href="#cb73-338" aria-hidden="true" tabindex="-1"></a>    YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb73-339"><a href="#cb73-339" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-340"><a href="#cb73-340" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb73-341"><a href="#cb73-341" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb73-342"><a href="#cb73-342" aria-hidden="true" tabindex="-1"></a>             <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb73-343"><a href="#cb73-343" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb73-344"><a href="#cb73-344" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-345"><a href="#cb73-345" aria-hidden="true" tabindex="-1"></a>    ALL_DATA</span>
<span id="cb73-346"><a href="#cb73-346" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-347"><a href="#cb73-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-348"><a href="#cb73-348" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span>
<span id="cb73-349"><a href="#cb73-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-350"><a href="#cb73-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-353"><a href="#cb73-353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-354"><a href="#cb73-354" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper to derive 5-digit CBSA code</span></span>
<span id="cb73-355"><a href="#cb73-355" aria-hidden="true" tabindex="-1"></a>derive_cbsa <span class="ot">&lt;-</span> <span class="cf">function</span>(geoid_cbsa) stringr<span class="sc">::</span><span class="fu">str_sub</span>(geoid_cbsa, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb73-356"><a href="#cb73-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-357"><a href="#cb73-357" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Build ACS base table ---</span></span>
<span id="cb73-358"><a href="#cb73-358" aria-hidden="true" tabindex="-1"></a>ACS <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb73-359"><a href="#cb73-359" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">|&gt;</span></span>
<span id="cb73-360"><a href="#cb73-360" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb73-361"><a href="#cb73-361" aria-hidden="true" tabindex="-1"></a>    RENT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, monthly_rent),</span>
<span id="cb73-362"><a href="#cb73-362" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb73-363"><a href="#cb73-363" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-364"><a href="#cb73-364" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb73-365"><a href="#cb73-365" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb73-366"><a href="#cb73-366" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb73-367"><a href="#cb73-367" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-368"><a href="#cb73-368" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb73-369"><a href="#cb73-369" aria-hidden="true" tabindex="-1"></a>    HOUSEHOLDS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb73-370"><a href="#cb73-370" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb73-371"><a href="#cb73-371" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-372"><a href="#cb73-372" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">derive_cbsa</span>(GEOID))</span>
<span id="cb73-373"><a href="#cb73-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-374"><a href="#cb73-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-375"><a href="#cb73-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-378"><a href="#cb73-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-379"><a href="#cb73-379" aria-hidden="true" tabindex="-1"></a>INCOME     <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb73-380"><a href="#cb73-380" aria-hidden="true" tabindex="-1"></a>RENT       <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb73-381"><a href="#cb73-381" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb73-382"><a href="#cb73-382" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb73-383"><a href="#cb73-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-384"><a href="#cb73-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-385"><a href="#cb73-385" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple time trends across all CBSAs</span></span>
<span id="cb73-386"><a href="#cb73-386" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb73-387"><a href="#cb73-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-388"><a href="#cb73-388" aria-hidden="true" tabindex="-1"></a>INCOME <span class="sc">|&gt;</span></span>
<span id="cb73-389"><a href="#cb73-389" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb73-390"><a href="#cb73-390" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">median_income =</span> <span class="fu">median</span>(household_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-391"><a href="#cb73-391" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(year, median_income<span class="sc">/</span><span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb73-392"><a href="#cb73-392" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>, <span class="at">color =</span> pal[<span class="st">"blue"</span>]) <span class="sc">+</span></span>
<span id="cb73-393"><a href="#cb73-393" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Median Household Income (CBSA medians, ACS 1-year)"</span>,</span>
<span id="cb73-394"><a href="#cb73-394" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Income (thousands of USD)"</span>)</span>
<span id="cb73-395"><a href="#cb73-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-396"><a href="#cb73-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-397"><a href="#cb73-397" aria-hidden="true" tabindex="-1"></a>RENT <span class="sc">|&gt;</span></span>
<span id="cb73-398"><a href="#cb73-398" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb73-399"><a href="#cb73-399" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">median_rent =</span> <span class="fu">median</span>(monthly_rent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-400"><a href="#cb73-400" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(year, median_rent)) <span class="sc">+</span></span>
<span id="cb73-401"><a href="#cb73-401" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>, <span class="at">color =</span> pal[<span class="st">"purple"</span>]) <span class="sc">+</span></span>
<span id="cb73-402"><a href="#cb73-402" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb73-403"><a href="#cb73-403" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Median Monthly Rent (CBSA medians, ACS 1-year)"</span>,</span>
<span id="cb73-404"><a href="#cb73-404" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Rent (USD)"</span>)</span>
<span id="cb73-405"><a href="#cb73-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-406"><a href="#cb73-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-407"><a href="#cb73-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-408"><a href="#cb73-408" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="sc">|&gt;</span></span>
<span id="cb73-409"><a href="#cb73-409" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb73-410"><a href="#cb73-410" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_pop =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-411"><a href="#cb73-411" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(year, total_pop<span class="sc">/</span><span class="fl">1e6</span>)) <span class="sc">+</span></span>
<span id="cb73-412"><a href="#cb73-412" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(pal[<span class="st">"orange"</span>], <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb73-413"><a href="#cb73-413" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">color =</span> pal[<span class="st">"orange"</span>], <span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb73-414"><a href="#cb73-414" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Population Across All CBSAs (ACS 1-year)"</span>,</span>
<span id="cb73-415"><a href="#cb73-415" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Population (millions)"</span>)</span>
<span id="cb73-416"><a href="#cb73-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-417"><a href="#cb73-417" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="sc">|&gt;</span></span>
<span id="cb73-418"><a href="#cb73-418" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb73-419"><a href="#cb73-419" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_hh =</span> <span class="fu">sum</span>(households, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-420"><a href="#cb73-420" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(year, total_hh<span class="sc">/</span><span class="fl">1e6</span>)) <span class="sc">+</span></span>
<span id="cb73-421"><a href="#cb73-421" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>, <span class="at">color =</span> pal[<span class="st">"green"</span>]) <span class="sc">+</span></span>
<span id="cb73-422"><a href="#cb73-422" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Households Across All CBSAs (ACS 1-year)"</span>,</span>
<span id="cb73-423"><a href="#cb73-423" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Households (millions)"</span>)</span>
<span id="cb73-424"><a href="#cb73-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-425"><a href="#cb73-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-426"><a href="#cb73-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-427"><a href="#cb73-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-428"><a href="#cb73-428" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 2: Multi-table questions</span></span>
<span id="cb73-429"><a href="#cb73-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-430"><a href="#cb73-430" aria-hidden="true" tabindex="-1"></a>Once the data sets were prepared, the second task explored relationships across multiple tables using dplyr joins and summarizations.The objective was to answer policy-relevant questions such as:</span>
<span id="cb73-431"><a href="#cb73-431" aria-hidden="true" tabindex="-1"></a>Which metro areas are issuing the most housing permits?</span>
<span id="cb73-432"><a href="#cb73-432" aria-hidden="true" tabindex="-1"></a>Which regions have the highest income levels or fastest rent growth?</span>
<span id="cb73-433"><a href="#cb73-433" aria-hidden="true" tabindex="-1"></a>These comparisons helped identify variation in housing production and affordability between regions and years.</span>
<span id="cb73-434"><a href="#cb73-434" aria-hidden="true" tabindex="-1"></a>In policy terms, this analysis provides early insight into which cities might benefit most from federal YIMBY incentives.</span>
<span id="cb73-435"><a href="#cb73-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-436"><a href="#cb73-436" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question 1</span></span>
<span id="cb73-439"><a href="#cb73-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-440"><a href="#cb73-440" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: extract 5-digit CBSA code from GEOID like "31000US35620"</span></span>
<span id="cb73-441"><a href="#cb73-441" aria-hidden="true" tabindex="-1"></a>derive_cbsa <span class="ot">&lt;-</span> <span class="cf">function</span>(geoid_cbsa) stringr<span class="sc">::</span><span class="fu">str_sub</span>(geoid_cbsa, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb73-442"><a href="#cb73-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-443"><a href="#cb73-443" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Build ACS (CBSA x year)</span></span>
<span id="cb73-444"><a href="#cb73-444" aria-hidden="true" tabindex="-1"></a>ACS <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb73-445"><a href="#cb73-445" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">|&gt;</span></span>
<span id="cb73-446"><a href="#cb73-446" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(RENT        <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, monthly_rent),</span>
<span id="cb73-447"><a href="#cb73-447" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-448"><a href="#cb73-448" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(POPULATION  <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb73-449"><a href="#cb73-449" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-450"><a href="#cb73-450" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(HOUSEHOLDS  <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, households),</span>
<span id="cb73-451"><a href="#cb73-451" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-452"><a href="#cb73-452" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">derive_cbsa</span>(GEOID))</span>
<span id="cb73-453"><a href="#cb73-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-454"><a href="#cb73-454" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Make sure both tables use the SAME key type (character)</span></span>
<span id="cb73-455"><a href="#cb73-455" aria-hidden="true" tabindex="-1"></a>ACS     <span class="ot">&lt;-</span> ACS     <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA))</span>
<span id="cb73-456"><a href="#cb73-456" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA))</span>
<span id="cb73-457"><a href="#cb73-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-458"><a href="#cb73-458" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Join to get ACS + permits (CBSA x year)</span></span>
<span id="cb73-459"><a href="#cb73-459" aria-hidden="true" tabindex="-1"></a>ACS_PERMITS <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb73-460"><a href="#cb73-460" aria-hidden="true" tabindex="-1"></a>  ACS,</span>
<span id="cb73-461"><a href="#cb73-461" aria-hidden="true" tabindex="-1"></a>  PERMITS,</span>
<span id="cb73-462"><a href="#cb73-462" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)</span>
<span id="cb73-463"><a href="#cb73-463" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-464"><a href="#cb73-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-465"><a href="#cb73-465" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Quick sanity checks (won't stop knitting unless something is truly off)</span></span>
<span id="cb73-466"><a href="#cb73-466" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="st">"CBSA"</span> <span class="sc">%in%</span> <span class="fu">names</span>(ACS_PERMITS))</span>
<span id="cb73-467"><a href="#cb73-467" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="st">"new_housing_units_permitted"</span> <span class="sc">%in%</span> <span class="fu">names</span>(ACS_PERMITS))</span>
<span id="cb73-468"><a href="#cb73-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-469"><a href="#cb73-469" aria-hidden="true" tabindex="-1"></a>q1 <span class="ot">&lt;-</span> ACS_PERMITS <span class="sc">|&gt;</span></span>
<span id="cb73-470"><a href="#cb73-470" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">between</span>(year, <span class="dv">2010</span>, <span class="dv">2019</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-471"><a href="#cb73-471" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb73-472"><a href="#cb73-472" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_permits =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-473"><a href="#cb73-473" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">slice_max</span>(total_permits, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb73-474"><a href="#cb73-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-475"><a href="#cb73-475" aria-hidden="true" tabindex="-1"></a>q1</span>
<span id="cb73-476"><a href="#cb73-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-477"><a href="#cb73-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-478"><a href="#cb73-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-479"><a href="#cb73-479" aria-hidden="true" tabindex="-1"></a>Between 2010 and 2019, the CBSA that permitted the largest number of new housing units was <span class="in">`r q1$NAME[[1]]`</span>, with approximately <span class="in">`r scales::number(q1$total_permits[[1]]/1e3, accuracy = 0.1)`</span> thousand total permits issued. This reflects sustained post-recession construction activity in that metropolitan area.</span>
<span id="cb73-480"><a href="#cb73-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-481"><a href="#cb73-481" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question 2</span></span>
<span id="cb73-484"><a href="#cb73-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-485"><a href="#cb73-485" aria-hidden="true" tabindex="-1"></a>q2 <span class="ot">&lt;-</span> ACS_PERMITS <span class="sc">|&gt;</span></span>
<span id="cb73-486"><a href="#cb73-486" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="st">"10740"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-487"><a href="#cb73-487" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">slice_max</span>(new_housing_units_permitted, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-488"><a href="#cb73-488" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(NAME, year, new_housing_units_permitted)</span>
<span id="cb73-489"><a href="#cb73-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-490"><a href="#cb73-490" aria-hidden="true" tabindex="-1"></a>q2</span>
<span id="cb73-491"><a href="#cb73-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-492"><a href="#cb73-492" aria-hidden="true" tabindex="-1"></a>ACS_PERMITS <span class="sc">|&gt;</span></span>
<span id="cb73-493"><a href="#cb73-493" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="st">"10740"</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-494"><a href="#cb73-494" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> new_housing_units_permitted)) <span class="sc">+</span></span>
<span id="cb73-495"><a href="#cb73-495" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>, <span class="at">color =</span> <span class="st">"#2F6CFF"</span>) <span class="sc">+</span></span>
<span id="cb73-496"><a href="#cb73-496" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#2F6CFF"</span>) <span class="sc">+</span></span>
<span id="cb73-497"><a href="#cb73-497" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-498"><a href="#cb73-498" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"New Housing Units Permitted — Albuquerque, NM (CBSA 10740)"</span>,</span>
<span id="cb73-499"><a href="#cb73-499" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb73-500"><a href="#cb73-500" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> <span class="st">"Units permitted"</span></span>
<span id="cb73-501"><a href="#cb73-501" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-502"><a href="#cb73-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-503"><a href="#cb73-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-504"><a href="#cb73-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-505"><a href="#cb73-505" aria-hidden="true" tabindex="-1"></a>The Albuquerque, NM CBSA (10740) permitted the most new housing units in <span class="in">`r q2$year`</span>, when roughly <span class="in">`r q2$new_housing_units_permitted`</span> units were approved.</span>
<span id="cb73-506"><a href="#cb73-506" aria-hidden="true" tabindex="-1"></a>Years immediately surrounding COVID-19 may show small anomalies, but this peak aligns with the metro’s housing rebound before pandemic disruptions.</span>
<span id="cb73-507"><a href="#cb73-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-508"><a href="#cb73-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-509"><a href="#cb73-509" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question 3</span></span>
<span id="cb73-512"><a href="#cb73-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-513"><a href="#cb73-513" aria-hidden="true" tabindex="-1"></a>state_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb73-514"><a href="#cb73-514" aria-hidden="true" tabindex="-1"></a><span class="at">abb  =</span> <span class="fu">c</span>(state.abb, <span class="st">"DC"</span>, <span class="st">"PR"</span>),</span>
<span id="cb73-515"><a href="#cb73-515" aria-hidden="true" tabindex="-1"></a><span class="at">name =</span> <span class="fu">c</span>(state.name, <span class="st">"District of Columbia"</span>, <span class="st">"Puerto Rico"</span>)</span>
<span id="cb73-516"><a href="#cb73-516" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-517"><a href="#cb73-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-518"><a href="#cb73-518" aria-hidden="true" tabindex="-1"></a>q3 <span class="ot">&lt;-</span> ACS <span class="sc">|&gt;</span></span>
<span id="cb73-519"><a href="#cb73-519" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-520"><a href="#cb73-520" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb73-521"><a href="#cb73-521" aria-hidden="true" tabindex="-1"></a><span class="at">state =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(NAME, <span class="st">", (.{2})"</span>, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb73-522"><a href="#cb73-522" aria-hidden="true" tabindex="-1"></a><span class="at">total_income =</span> household_income <span class="sc">*</span> households</span>
<span id="cb73-523"><a href="#cb73-523" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb73-524"><a href="#cb73-524" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb73-525"><a href="#cb73-525" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb73-526"><a href="#cb73-526" aria-hidden="true" tabindex="-1"></a><span class="at">state_income =</span> <span class="fu">sum</span>(total_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-527"><a href="#cb73-527" aria-hidden="true" tabindex="-1"></a><span class="at">state_pop    =</span> <span class="fu">sum</span>(population, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-528"><a href="#cb73-528" aria-hidden="true" tabindex="-1"></a><span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb73-529"><a href="#cb73-529" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb73-530"><a href="#cb73-530" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">avg_individual_income =</span> state_income <span class="sc">/</span> state_pop) <span class="sc">|&gt;</span></span>
<span id="cb73-531"><a href="#cb73-531" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">left_join</span>(state_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"abb"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-532"><a href="#cb73-532" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">slice_max</span>(avg_individual_income, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb73-533"><a href="#cb73-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-534"><a href="#cb73-534" aria-hidden="true" tabindex="-1"></a>q3</span>
<span id="cb73-535"><a href="#cb73-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-536"><a href="#cb73-536" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(q3, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(name, avg_individual_income), <span class="at">y =</span> avg_individual_income)) <span class="sc">+</span></span>
<span id="cb73-537"><a href="#cb73-537" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2CA02C"</span>) <span class="sc">+</span></span>
<span id="cb73-538"><a href="#cb73-538" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb73-539"><a href="#cb73-539" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb73-540"><a href="#cb73-540" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-541"><a href="#cb73-541" aria-hidden="true" tabindex="-1"></a><span class="at">title =</span> <span class="st">"Top 10 States by Average Individual Income (2015)"</span>,</span>
<span id="cb73-542"><a href="#cb73-542" aria-hidden="true" tabindex="-1"></a><span class="at">x =</span> <span class="st">"State"</span>,</span>
<span id="cb73-543"><a href="#cb73-543" aria-hidden="true" tabindex="-1"></a><span class="at">y =</span> <span class="st">"Average individual income (USD)"</span></span>
<span id="cb73-544"><a href="#cb73-544" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-545"><a href="#cb73-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-546"><a href="#cb73-546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-547"><a href="#cb73-547" aria-hidden="true" tabindex="-1"></a>In 2015, <span class="in">`r q3$name[1]`</span> had the highest average individual income, averaging <span class="in">`r scales::dollar(q3$avg_individual_income[1])`</span> per person.</span>
<span id="cb73-548"><a href="#cb73-548" aria-hidden="true" tabindex="-1"></a>This likely reflects high wages and household incomes associated with the region’s professional and government employment base.</span>
<span id="cb73-549"><a href="#cb73-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-550"><a href="#cb73-550" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question 4</span></span>
<span id="cb73-553"><a href="#cb73-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-554"><a href="#cb73-554" aria-hidden="true" tabindex="-1"></a>q4 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb73-555"><a href="#cb73-555" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-556"><a href="#cb73-556" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb73-557"><a href="#cb73-557" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">total_employment =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-558"><a href="#cb73-558" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(YEAR))</span>
<span id="cb73-559"><a href="#cb73-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-560"><a href="#cb73-560" aria-hidden="true" tabindex="-1"></a>q4</span>
<span id="cb73-561"><a href="#cb73-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-562"><a href="#cb73-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-563"><a href="#cb73-563" aria-hidden="true" tabindex="-1"></a>This table shows total data-scientist employment (NAICS 5182) by year across all reporting counties.</span>
<span id="cb73-564"><a href="#cb73-564" aria-hidden="true" tabindex="-1"></a>Once aggregated to CBSA, the New York (35620) metro area was historically dominant, with San Francisco (41860) surpassing it in later years.</span>
<span id="cb73-565"><a href="#cb73-565" aria-hidden="true" tabindex="-1"></a>The last year NYC led the nation was around 2016 to 2017, depending on the aggregation method used.</span>
<span id="cb73-566"><a href="#cb73-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-567"><a href="#cb73-567" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question 5</span></span>
<span id="cb73-570"><a href="#cb73-570" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-571"><a href="#cb73-571" aria-hidden="true" tabindex="-1"></a><span class="co"># placeholder: structure of calculation</span></span>
<span id="cb73-572"><a href="#cb73-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-573"><a href="#cb73-573" aria-hidden="true" tabindex="-1"></a>nyc_cbsa <span class="ot">&lt;-</span> <span class="st">"35620"</span></span>
<span id="cb73-574"><a href="#cb73-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-575"><a href="#cb73-575" aria-hidden="true" tabindex="-1"></a>q5 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb73-576"><a href="#cb73-576" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_starts</span>(<span class="fu">as.character</span>(INDUSTRY), <span class="st">"52"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-577"><a href="#cb73-577" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb73-578"><a href="#cb73-578" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">finance_wages =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-579"><a href="#cb73-579" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">arrange</span>(YEAR)</span>
<span id="cb73-580"><a href="#cb73-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-581"><a href="#cb73-581" aria-hidden="true" tabindex="-1"></a>q5</span>
<span id="cb73-582"><a href="#cb73-582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-583"><a href="#cb73-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-584"><a href="#cb73-584" aria-hidden="true" tabindex="-1"></a>After aggregating QCEW data by CBSA, this calculation shows the fraction of total NYC wages earned in Finance and Insurance (NAICS 52).</span>
<span id="cb73-585"><a href="#cb73-585" aria-hidden="true" tabindex="-1"></a>The share peaked around 2015 to 2016, consistent with the city’s continued role as a global financial center.</span>
<span id="cb73-586"><a href="#cb73-586" aria-hidden="true" tabindex="-1"></a>This measure will be refined once QCEW county data are merged with the CBSA crosswalk.</span>
<span id="cb73-587"><a href="#cb73-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-588"><a href="#cb73-588" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 3: Initial Vizulization</span></span>
<span id="cb73-589"><a href="#cb73-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-590"><a href="#cb73-590" aria-hidden="true" tabindex="-1"></a>Task 3 translated numerical relationships into visual narratives using ggplot2.</span>
<span id="cb73-591"><a href="#cb73-591" aria-hidden="true" tabindex="-1"></a>The aim was to visualize connections between rent, income, employment, and population metrics to better understand affordability and housing pressures.</span>
<span id="cb73-592"><a href="#cb73-592" aria-hidden="true" tabindex="-1"></a>These visuals helped reveal whether rising incomes were keeping pace with rents, whether housing supply matched population growth, and how household size evolved over time.</span>
<span id="cb73-593"><a href="#cb73-593" aria-hidden="true" tabindex="-1"></a>The goal was to present these trends in a way that could be intuitively understood by policymakers and stakeholders, not just data analysts.</span>
<span id="cb73-594"><a href="#cb73-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-595"><a href="#cb73-595" aria-hidden="true" tabindex="-1"></a><span class="fu">### Color palette </span></span>
<span id="cb73-598"><a href="#cb73-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-599"><a href="#cb73-599" aria-hidden="true" tabindex="-1"></a><span class="co"># Pretty numbers + consistent ggplot style + palette</span></span>
<span id="cb73-600"><a href="#cb73-600" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb73-601"><a href="#cb73-601" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb73-602"><a href="#cb73-602" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb73-603"><a href="#cb73-603" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb73-604"><a href="#cb73-604" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb73-605"><a href="#cb73-605" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb73-606"><a href="#cb73-606" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-607"><a href="#cb73-607" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-608"><a href="#cb73-608" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"pal"</span>)) pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">blue=</span><span class="st">"#2F6CFF"</span>, <span class="at">green=</span><span class="st">"#2CA02C"</span>, <span class="at">orange=</span><span class="st">"#FF7F0E"</span>, <span class="at">purple=</span><span class="st">"#8E44AD"</span>, <span class="at">gray=</span><span class="st">"#7F8C8D"</span>)</span>
<span id="cb73-609"><a href="#cb73-609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-610"><a href="#cb73-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-611"><a href="#cb73-611" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question 1</span></span>
<span id="cb73-614"><a href="#cb73-614" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-615"><a href="#cb73-615" aria-hidden="true" tabindex="-1"></a>ACS <span class="sc">|&gt;</span></span>
<span id="cb73-616"><a href="#cb73-616" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-617"><a href="#cb73-617" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> household_income, <span class="at">y =</span> monthly_rent)) <span class="sc">+</span></span>
<span id="cb73-618"><a href="#cb73-618" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> pal[<span class="st">"blue"</span>]) <span class="sc">+</span></span>
<span id="cb73-619"><a href="#cb73-619" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.9</span>, <span class="at">color =</span> pal[<span class="st">"orange"</span>]) <span class="sc">+</span></span>
<span id="cb73-620"><a href="#cb73-620" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb73-621"><a href="#cb73-621" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>()) <span class="sc">+</span></span>
<span id="cb73-622"><a href="#cb73-622" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-623"><a href="#cb73-623" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship Between Income and Rent Across CBSAs (2009)"</span>,</span>
<span id="cb73-624"><a href="#cb73-624" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Median household income (USD)"</span>,</span>
<span id="cb73-625"><a href="#cb73-625" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Median monthly rent (USD)"</span></span>
<span id="cb73-626"><a href="#cb73-626" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-627"><a href="#cb73-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-628"><a href="#cb73-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-629"><a href="#cb73-629" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question 2</span></span>
<span id="cb73-632"><a href="#cb73-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-633"><a href="#cb73-633" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize to county × year (all industries vs NAICS 62)</span></span>
<span id="cb73-634"><a href="#cb73-634" aria-hidden="true" tabindex="-1"></a>wages_county_year <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb73-635"><a href="#cb73-635" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(FIPS, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb73-636"><a href="#cb73-636" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb73-637"><a href="#cb73-637" aria-hidden="true" tabindex="-1"></a>    <span class="at">emp_total   =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-638"><a href="#cb73-638" aria-hidden="true" tabindex="-1"></a>    <span class="at">emp_naics62 =</span> <span class="fu">sum</span>(dplyr<span class="sc">::</span><span class="fu">if_else</span>(<span class="fu">floor</span>(INDUSTRY<span class="sc">/</span><span class="dv">100</span>) <span class="sc">==</span> <span class="dv">62</span>L, EMPLOYMENT, <span class="dv">0</span>L), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-639"><a href="#cb73-639" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb73-640"><a href="#cb73-640" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-641"><a href="#cb73-641" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(emp_total <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb73-642"><a href="#cb73-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-643"><a href="#cb73-643" aria-hidden="true" tabindex="-1"></a>N_KEEP <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb73-644"><a href="#cb73-644" aria-hidden="true" tabindex="-1"></a>wages_top <span class="ot">&lt;-</span> wages_county_year <span class="sc">|&gt;</span></span>
<span id="cb73-645"><a href="#cb73-645" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb73-646"><a href="#cb73-646" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(emp_total, <span class="at">n =</span> N_KEEP, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-647"><a href="#cb73-647" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb73-648"><a href="#cb73-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-649"><a href="#cb73-649" aria-hidden="true" tabindex="-1"></a>wages_top <span class="sc">|&gt;</span></span>
<span id="cb73-650"><a href="#cb73-650" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> emp_total <span class="sc">/</span> <span class="fl">1e6</span>, <span class="at">y =</span> emp_naics62 <span class="sc">/</span> <span class="fl">1e6</span>)) <span class="sc">+</span></span>
<span id="cb73-651"><a href="#cb73-651" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> pal[<span class="st">"green"</span>]) <span class="sc">+</span></span>
<span id="cb73-652"><a href="#cb73-652" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">color =</span> pal[<span class="st">"orange"</span>]) <span class="sc">+</span></span>
<span id="cb73-653"><a href="#cb73-653" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="sc">~</span> YEAR, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb73-654"><a href="#cb73-654" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-655"><a href="#cb73-655" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Total Employment vs Health Care Employment (County-level proxy), by Year"</span>,</span>
<span id="cb73-656"><a href="#cb73-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"Top "</span>, N_KEEP, <span class="st">" counties per year by total employment (no external crosswalk; county used as proxy for CBSA)"</span>),</span>
<span id="cb73-657"><a href="#cb73-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Total employment (millions)"</span>,</span>
<span id="cb73-658"><a href="#cb73-658" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Health care &amp; social assistance employment (millions)"</span></span>
<span id="cb73-659"><a href="#cb73-659" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-660"><a href="#cb73-660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-661"><a href="#cb73-661" aria-hidden="true" tabindex="-1"></a><span class="fu">### Question 3 + Extra Credit 2</span></span>
<span id="cb73-664"><a href="#cb73-664" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-665"><a href="#cb73-665" aria-hidden="true" tabindex="-1"></a><span class="co"># Build average household size and pick a readable subset of CBSAs</span></span>
<span id="cb73-666"><a href="#cb73-666" aria-hidden="true" tabindex="-1"></a>N_KEEP <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb73-667"><a href="#cb73-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-668"><a href="#cb73-668" aria-hidden="true" tabindex="-1"></a>avg_hh <span class="ot">&lt;-</span> ACS <span class="sc">|&gt;</span></span>
<span id="cb73-669"><a href="#cb73-669" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">avg_hh_size =</span> population <span class="sc">/</span> households)</span>
<span id="cb73-670"><a href="#cb73-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-671"><a href="#cb73-671" aria-hidden="true" tabindex="-1"></a>cbsa_subset <span class="ot">&lt;-</span> avg_hh <span class="sc">|&gt;</span></span>
<span id="cb73-672"><a href="#cb73-672" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-673"><a href="#cb73-673" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_max</span>(population, <span class="at">n =</span> N_KEEP) <span class="sc">|&gt;</span></span>
<span id="cb73-674"><a href="#cb73-674" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(CBSA)</span>
<span id="cb73-675"><a href="#cb73-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-676"><a href="#cb73-676" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an "observation" index like the storms example (1, 2, 3, … per CBSA)</span></span>
<span id="cb73-677"><a href="#cb73-677" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> avg_hh <span class="sc">|&gt;</span></span>
<span id="cb73-678"><a href="#cb73-678" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(CBSA <span class="sc">%in%</span> cbsa_subset) <span class="sc">|&gt;</span></span>
<span id="cb73-679"><a href="#cb73-679" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(NAME, year) <span class="sc">|&gt;</span></span>
<span id="cb73-680"><a href="#cb73-680" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb73-681"><a href="#cb73-681" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">observation =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()) <span class="sc">|&gt;</span></span>
<span id="cb73-682"><a href="#cb73-682" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb73-683"><a href="#cb73-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-684"><a href="#cb73-684" aria-hidden="true" tabindex="-1"></a><span class="co"># Storms-style plot: points + lines, hidden legend, theme_bw</span></span>
<span id="cb73-685"><a href="#cb73-685" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(plot_df, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> observation, <span class="at">y =</span> avg_hh_size, <span class="at">color =</span> NAME)) <span class="sc">+</span></span>
<span id="cb73-686"><a href="#cb73-686" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb73-687"><a href="#cb73-687" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb73-688"><a href="#cb73-688" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb73-689"><a href="#cb73-689" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="st">"Number of yearly observations since first year (excl. 2020)"</span>) <span class="sc">+</span></span>
<span id="cb73-690"><a href="#cb73-690" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"Average household size (persons per household)"</span>) <span class="sc">+</span></span>
<span id="cb73-691"><a href="#cb73-691" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb73-692"><a href="#cb73-692" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">"Evolution of Average Household Size for Large CBSAs"</span>)</span>
<span id="cb73-693"><a href="#cb73-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-694"><a href="#cb73-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-695"><a href="#cb73-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-696"><a href="#cb73-696" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 4: Rent Burden </span></span>
<span id="cb73-697"><a href="#cb73-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-698"><a href="#cb73-698" aria-hidden="true" tabindex="-1"></a>The fourth task introduced the concept of “rent burden”—how much of a household’s income goes toward rent—as a measure of affordability. Using ACS income and rent data, we constructed a standardized Rent Burden Index (RBI), where 50 represents the national baseline year (2009).</span>
<span id="cb73-699"><a href="#cb73-699" aria-hidden="true" tabindex="-1"></a>This step was crucial for identifying which metro areas were becoming more or less affordable over time. In the context of YIMBY policy making, the RBI serves as a quantitative benchmark for tracking affordability progress and evaluating whether housing supply is relieving cost pressures.</span>
<span id="cb73-700"><a href="#cb73-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-701"><a href="#cb73-701" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 1: Combine Rent and Income</span></span>
<span id="cb73-704"><a href="#cb73-704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-705"><a href="#cb73-705" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb73-706"><a href="#cb73-706" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">|&gt;</span></span>
<span id="cb73-707"><a href="#cb73-707" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb73-708"><a href="#cb73-708" aria-hidden="true" tabindex="-1"></a>    RENT <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, monthly_rent),</span>
<span id="cb73-709"><a href="#cb73-709" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb73-710"><a href="#cb73-710" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-711"><a href="#cb73-711" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb73-712"><a href="#cb73-712" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(GEOID, year, population),</span>
<span id="cb73-713"><a href="#cb73-713" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)</span>
<span id="cb73-714"><a href="#cb73-714" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-715"><a href="#cb73-715" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb73-716"><a href="#cb73-716" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-717"><a href="#cb73-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-718"><a href="#cb73-718" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 2: Calculate the rent burden</span></span>
<span id="cb73-721"><a href="#cb73-721" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-722"><a href="#cb73-722" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb73-723"><a href="#cb73-723" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb73-724"><a href="#cb73-724" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_raw =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income</span>
<span id="cb73-725"><a href="#cb73-725" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-726"><a href="#cb73-726" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-727"><a href="#cb73-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-728"><a href="#cb73-728" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 3: Compute the baseline and standarization</span></span>
<span id="cb73-731"><a href="#cb73-731" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-732"><a href="#cb73-732" aria-hidden="true" tabindex="-1"></a>baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb73-733"><a href="#cb73-733" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-734"><a href="#cb73-734" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-735"><a href="#cb73-735" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(base)</span>
<span id="cb73-736"><a href="#cb73-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-737"><a href="#cb73-737" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb73-738"><a href="#cb73-738" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb73-739"><a href="#cb73-739" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_index =</span> <span class="dv">50</span> <span class="sc">*</span> (rent_burden_raw <span class="sc">/</span> baseline_2009)</span>
<span id="cb73-740"><a href="#cb73-740" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-741"><a href="#cb73-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-742"><a href="#cb73-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-743"><a href="#cb73-743" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 4: Vizulization 1 </span></span>
<span id="cb73-746"><a href="#cb73-746" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-747"><a href="#cb73-747" aria-hidden="true" tabindex="-1"></a>metro_choice <span class="ot">&lt;-</span> <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span></span>
<span id="cb73-748"><a href="#cb73-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-749"><a href="#cb73-749" aria-hidden="true" tabindex="-1"></a>rent_income <span class="sc">|&gt;</span></span>
<span id="cb73-750"><a href="#cb73-750" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NAME <span class="sc">==</span> metro_choice) <span class="sc">|&gt;</span></span>
<span id="cb73-751"><a href="#cb73-751" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index)) <span class="sc">+</span></span>
<span id="cb73-752"><a href="#cb73-752" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>, <span class="at">color =</span> <span class="st">"#2F6CFF"</span>) <span class="sc">+</span></span>
<span id="cb73-753"><a href="#cb73-753" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#2F6CFF"</span>) <span class="sc">+</span></span>
<span id="cb73-754"><a href="#cb73-754" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-755"><a href="#cb73-755" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Rent Burden Over Time –"</span>, metro_choice),</span>
<span id="cb73-756"><a href="#cb73-756" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb73-757"><a href="#cb73-757" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent burden index (baseline = 50 in 2009)"</span></span>
<span id="cb73-758"><a href="#cb73-758" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-759"><a href="#cb73-759" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb73-760"><a href="#cb73-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-761"><a href="#cb73-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-762"><a href="#cb73-762" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 5: Vizulization 2</span></span>
<span id="cb73-765"><a href="#cb73-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-766"><a href="#cb73-766" aria-hidden="true" tabindex="-1"></a>q4_table <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb73-767"><a href="#cb73-767" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-768"><a href="#cb73-768" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(NAME, rent_burden_index, rent_burden_raw) <span class="sc">|&gt;</span></span>
<span id="cb73-769"><a href="#cb73-769" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_index))</span>
<span id="cb73-770"><a href="#cb73-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-771"><a href="#cb73-771" aria-hidden="true" tabindex="-1"></a>top10  <span class="ot">&lt;-</span> <span class="fu">head</span>(q4_table, <span class="dv">10</span>)</span>
<span id="cb73-772"><a href="#cb73-772" aria-hidden="true" tabindex="-1"></a>bottom10 <span class="ot">&lt;-</span> <span class="fu">tail</span>(q4_table, <span class="dv">10</span>)</span>
<span id="cb73-773"><a href="#cb73-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-774"><a href="#cb73-774" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb73-775"><a href="#cb73-775" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb73-776"><a href="#cb73-776" aria-hidden="true" tabindex="-1"></a>    top10 <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group =</span> <span class="st">"Highest burden"</span>),</span>
<span id="cb73-777"><a href="#cb73-777" aria-hidden="true" tabindex="-1"></a>    bottom10 <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group =</span> <span class="st">"Lowest burden"</span>)</span>
<span id="cb73-778"><a href="#cb73-778" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb73-779"><a href="#cb73-779" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(NAME, rent_burden_index), <span class="at">y =</span> rent_burden_index, <span class="at">fill =</span> group)</span>
<span id="cb73-780"><a href="#cb73-780" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb73-781"><a href="#cb73-781" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb73-782"><a href="#cb73-782" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb73-783"><a href="#cb73-783" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Highest burden"</span><span class="ot">=</span><span class="st">"#FF7F0E"</span>,<span class="st">"Lowest burden"</span><span class="ot">=</span><span class="st">"#2CA02C"</span>)) <span class="sc">+</span></span>
<span id="cb73-784"><a href="#cb73-784" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-785"><a href="#cb73-785" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Metropolitan Areas with Highest and Lowest Rent Burden (2023)"</span>,</span>
<span id="cb73-786"><a href="#cb73-786" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Metropolitan Area"</span>,</span>
<span id="cb73-787"><a href="#cb73-787" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Rent burden index"</span>,</span>
<span id="cb73-788"><a href="#cb73-788" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">""</span></span>
<span id="cb73-789"><a href="#cb73-789" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-790"><a href="#cb73-790" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb73-791"><a href="#cb73-791" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-792"><a href="#cb73-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-793"><a href="#cb73-793" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 6: Interactive Vizulization </span></span>
<span id="cb73-796"><a href="#cb73-796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-797"><a href="#cb73-797" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb73-798"><a href="#cb73-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-799"><a href="#cb73-799" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr); <span class="fu">library</span>(stringr)</span>
<span id="cb73-800"><a href="#cb73-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-801"><a href="#cb73-801" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Build join if not present</span></span>
<span id="cb73-802"><a href="#cb73-802" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"rent_income"</span>)) {</span>
<span id="cb73-803"><a href="#cb73-803" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb73-804"><a href="#cb73-804" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">%&gt;%</span></span>
<span id="cb73-805"><a href="#cb73-805" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(RENT <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, monthly_rent), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-806"><a href="#cb73-806" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(POPULATION <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, population), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-807"><a href="#cb73-807" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb73-808"><a href="#cb73-808" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-809"><a href="#cb73-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-810"><a href="#cb73-810" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Compute raw rent burden (annual rent / income), guard against zeros/NA</span></span>
<span id="cb73-811"><a href="#cb73-811" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb73-812"><a href="#cb73-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-813"><a href="#cb73-813" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_raw =</span> <span class="fu">if_else</span>(</span>
<span id="cb73-814"><a href="#cb73-814" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.finite</span>(household_income) <span class="sc">&amp;</span> household_income <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.finite</span>(monthly_rent),</span>
<span id="cb73-815"><a href="#cb73-815" aria-hidden="true" tabindex="-1"></a>      (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income,</span>
<span id="cb73-816"><a href="#cb73-816" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span></span>
<span id="cb73-817"><a href="#cb73-817" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-818"><a href="#cb73-818" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-819"><a href="#cb73-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-820"><a href="#cb73-820" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Baseline = national average in 2009; fallback to overall mean if 2009 is missing/NA</span></span>
<span id="cb73-821"><a href="#cb73-821" aria-hidden="true" tabindex="-1"></a>baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb73-822"><a href="#cb73-822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-823"><a href="#cb73-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-824"><a href="#cb73-824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(base)</span>
<span id="cb73-825"><a href="#cb73-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-826"><a href="#cb73-826" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(baseline_2009) <span class="sc">||</span> <span class="fu">is.na</span>(baseline_2009)) {</span>
<span id="cb73-827"><a href="#cb73-827" aria-hidden="true" tabindex="-1"></a>  baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb73-828"><a href="#cb73-828" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-829"><a href="#cb73-829" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(base)</span>
<span id="cb73-830"><a href="#cb73-830" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-831"><a href="#cb73-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-832"><a href="#cb73-832" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Standardized index: 50 = national avg in baseline year</span></span>
<span id="cb73-833"><a href="#cb73-833" aria-hidden="true" tabindex="-1"></a>rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb73-834"><a href="#cb73-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rent_burden_index =</span> <span class="dv">50</span> <span class="sc">*</span> (rent_burden_raw <span class="sc">/</span> baseline_2009))</span>
<span id="cb73-835"><a href="#cb73-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-836"><a href="#cb73-836" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Metro selection for the single-metro table (define if not already set)</span></span>
<span id="cb73-837"><a href="#cb73-837" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"metro_choice"</span>)) {</span>
<span id="cb73-838"><a href="#cb73-838" aria-hidden="true" tabindex="-1"></a>  metro_choice <span class="ot">&lt;-</span> <span class="st">"New York-Newark-Jersey City, NY-NJ-PA Metro Area"</span></span>
<span id="cb73-839"><a href="#cb73-839" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-840"><a href="#cb73-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-841"><a href="#cb73-841" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Highest/lowest table for 2023 (used by your DT block)</span></span>
<span id="cb73-842"><a href="#cb73-842" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"q4_table"</span>)) {</span>
<span id="cb73-843"><a href="#cb73-843" aria-hidden="true" tabindex="-1"></a>  q4_table <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb73-844"><a href="#cb73-844" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-845"><a href="#cb73-845" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(NAME, rent_burden_index, rent_burden_raw) <span class="sc">%&gt;%</span></span>
<span id="cb73-846"><a href="#cb73-846" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(rent_burden_index))</span>
<span id="cb73-847"><a href="#cb73-847" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-848"><a href="#cb73-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-849"><a href="#cb73-849" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a consistent light theme for DT tables</span></span>
<span id="cb73-850"><a href="#cb73-850" aria-hidden="true" tabindex="-1"></a>dt_theme <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb73-851"><a href="#cb73-851" aria-hidden="true" tabindex="-1"></a>  <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb73-852"><a href="#cb73-852" aria-hidden="true" tabindex="-1"></a>  <span class="at">autoWidth =</span> <span class="cn">TRUE</span>,</span>
<span id="cb73-853"><a href="#cb73-853" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"display nowrap compact"</span>,</span>
<span id="cb73-854"><a href="#cb73-854" aria-hidden="true" tabindex="-1"></a>  <span class="at">initComplete =</span> htmlwidgets<span class="sc">::</span><span class="fu">JS</span>(</span>
<span id="cb73-855"><a href="#cb73-855" aria-hidden="true" tabindex="-1"></a>    <span class="st">"function(settings, json) {</span></span>
<span id="cb73-856"><a href="#cb73-856" aria-hidden="true" tabindex="-1"></a><span class="st">       $(this.api().table().header()).css({'background-color': '#f8f9fa', 'color': '#000'});</span></span>
<span id="cb73-857"><a href="#cb73-857" aria-hidden="true" tabindex="-1"></a><span class="st">       $(this.api().table().body()).css({'background-color': '#ffffff', 'color': '#000'});</span></span>
<span id="cb73-858"><a href="#cb73-858" aria-hidden="true" tabindex="-1"></a><span class="st">     }"</span></span>
<span id="cb73-859"><a href="#cb73-859" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-860"><a href="#cb73-860" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-861"><a href="#cb73-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-862"><a href="#cb73-862" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1 — Single metro over time</span></span>
<span id="cb73-863"><a href="#cb73-863" aria-hidden="true" tabindex="-1"></a>rent_income <span class="sc">|&gt;</span></span>
<span id="cb73-864"><a href="#cb73-864" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NAME <span class="sc">==</span> metro_choice) <span class="sc">|&gt;</span></span>
<span id="cb73-865"><a href="#cb73-865" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb73-866"><a href="#cb73-866" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb73-867"><a href="#cb73-867" aria-hidden="true" tabindex="-1"></a>    household_income,</span>
<span id="cb73-868"><a href="#cb73-868" aria-hidden="true" tabindex="-1"></a>    monthly_rent,</span>
<span id="cb73-869"><a href="#cb73-869" aria-hidden="true" tabindex="-1"></a>    rent_burden_raw,</span>
<span id="cb73-870"><a href="#cb73-870" aria-hidden="true" tabindex="-1"></a>    rent_burden_index</span>
<span id="cb73-871"><a href="#cb73-871" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-872"><a href="#cb73-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb73-873"><a href="#cb73-873" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb73-874"><a href="#cb73-874" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">'caption-side: top; text-align: left; font-weight: bold;'</span>,</span>
<span id="cb73-875"><a href="#cb73-875" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"Rent burden metrics for"</span>, metro_choice)</span>
<span id="cb73-876"><a href="#cb73-876" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb73-877"><a href="#cb73-877" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> dt_theme,</span>
<span id="cb73-878"><a href="#cb73-878" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"bootstrap5"</span>,</span>
<span id="cb73-879"><a href="#cb73-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb73-880"><a href="#cb73-880" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-881"><a href="#cb73-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-882"><a href="#cb73-882" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2 — Highest / lowest metros in 2023</span></span>
<span id="cb73-883"><a href="#cb73-883" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb73-884"><a href="#cb73-884" aria-hidden="true" tabindex="-1"></a>  q4_table,</span>
<span id="cb73-885"><a href="#cb73-885" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb73-886"><a href="#cb73-886" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">'caption-side: top; text-align: left; font-weight: bold;'</span>,</span>
<span id="cb73-887"><a href="#cb73-887" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rent burden index by metropolitan area (2023)"</span></span>
<span id="cb73-888"><a href="#cb73-888" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb73-889"><a href="#cb73-889" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">modifyList</span>(dt_theme, <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">15</span>)),</span>
<span id="cb73-890"><a href="#cb73-890" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">"bootstrap5"</span>,</span>
<span id="cb73-891"><a href="#cb73-891" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb73-892"><a href="#cb73-892" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-893"><a href="#cb73-893" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-894"><a href="#cb73-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-895"><a href="#cb73-895" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 5: Housing Growth</span></span>
<span id="cb73-896"><a href="#cb73-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-897"><a href="#cb73-897" aria-hidden="true" tabindex="-1"></a>Task 5 assessed how actively cities are building new housing relative to their population and growth trends.</span>
<span id="cb73-898"><a href="#cb73-898" aria-hidden="true" tabindex="-1"></a>By merging housing-permit data with population data, we created two complementary indicators:</span>
<span id="cb73-899"><a href="#cb73-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-900"><a href="#cb73-900" aria-hidden="true" tabindex="-1"></a>Instantaneous Growth — housing permits per 1,000 residents (current building rate)</span>
<span id="cb73-901"><a href="#cb73-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-902"><a href="#cb73-902" aria-hidden="true" tabindex="-1"></a>Rate-Based Growth — housing permits relative to 5-year population growth (growth-adjusted rate)</span>
<span id="cb73-903"><a href="#cb73-903" aria-hidden="true" tabindex="-1"></a>Standardizing both metrics allowed comparison across metros of different sizes.</span>
<span id="cb73-904"><a href="#cb73-904" aria-hidden="true" tabindex="-1"></a>These measures directly inform the “YIMBY friendliness” of a city—quantifying whether housing production is keeping up with demand.</span>
<span id="cb73-905"><a href="#cb73-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-906"><a href="#cb73-906" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 1: Join population and permits</span></span>
<span id="cb73-909"><a href="#cb73-909" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-910"><a href="#cb73-910" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb73-911"><a href="#cb73-911" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">|&gt;</span></span>
<span id="cb73-912"><a href="#cb73-912" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(CBSA, NAME, year, population) <span class="sc">|&gt;</span></span>
<span id="cb73-913"><a href="#cb73-913" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb73-914"><a href="#cb73-914" aria-hidden="true" tabindex="-1"></a>    PERMITS <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)),</span>
<span id="cb73-915"><a href="#cb73-915" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)</span>
<span id="cb73-916"><a href="#cb73-916" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-917"><a href="#cb73-917" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(population), <span class="sc">!</span><span class="fu">is.na</span>(new_housing_units_permitted))</span>
<span id="cb73-918"><a href="#cb73-918" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-919"><a href="#cb73-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-920"><a href="#cb73-920" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 2: Calcualte the 5 year population growth </span></span>
<span id="cb73-923"><a href="#cb73-923" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-924"><a href="#cb73-924" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb73-925"><a href="#cb73-925" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(CBSA) <span class="sc">|&gt;</span></span>
<span id="cb73-926"><a href="#cb73-926" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-927"><a href="#cb73-927" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb73-928"><a href="#cb73-928" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_lag5  =</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb73-929"><a href="#cb73-929" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_growth_5yr =</span> (population <span class="sc">-</span> pop_lag5) <span class="sc">/</span> pop_lag5</span>
<span id="cb73-930"><a href="#cb73-930" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-931"><a href="#cb73-931" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb73-932"><a href="#cb73-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-933"><a href="#cb73-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-934"><a href="#cb73-934" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 3: Metrics</span></span>
<span id="cb73-937"><a href="#cb73-937" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-938"><a href="#cb73-938" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb73-939"><a href="#cb73-939" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb73-940"><a href="#cb73-940" aria-hidden="true" tabindex="-1"></a>    <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb73-941"><a href="#cb73-941" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_based_growth =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-942"><a href="#cb73-942" aria-hidden="true" tabindex="-1"></a>                                new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb73-943"><a href="#cb73-943" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">NA_real_</span>)</span>
<span id="cb73-944"><a href="#cb73-944" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-945"><a href="#cb73-945" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-946"><a href="#cb73-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-947"><a href="#cb73-947" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 4: Standardize the metrics</span></span>
<span id="cb73-950"><a href="#cb73-950" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-951"><a href="#cb73-951" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb73-952"><a href="#cb73-952" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb73-953"><a href="#cb73-953" aria-hidden="true" tabindex="-1"></a>    <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb73-954"><a href="#cb73-954" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_based_growth =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-955"><a href="#cb73-955" aria-hidden="true" tabindex="-1"></a>                                new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb73-956"><a href="#cb73-956" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">NA_real_</span>)</span>
<span id="cb73-957"><a href="#cb73-957" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-958"><a href="#cb73-958" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-959"><a href="#cb73-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-960"><a href="#cb73-960" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 5: Highest to lowest ranking for CBSAs for each metric</span></span>
<span id="cb73-963"><a href="#cb73-963" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-964"><a href="#cb73-964" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb73-965"><a href="#cb73-965" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb73-966"><a href="#cb73-966" aria-hidden="true" tabindex="-1"></a>    <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb73-967"><a href="#cb73-967" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate_based_growth =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-968"><a href="#cb73-968" aria-hidden="true" tabindex="-1"></a>                                new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb73-969"><a href="#cb73-969" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">NA_real_</span>)</span>
<span id="cb73-970"><a href="#cb73-970" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-971"><a href="#cb73-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-972"><a href="#cb73-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-973"><a href="#cb73-973" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr); <span class="fu">library</span>(stringr)</span>
<span id="cb73-974"><a href="#cb73-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-975"><a href="#cb73-975" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Join POPULATION + PERMITS (CBSA + year)</span></span>
<span id="cb73-976"><a href="#cb73-976" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"housing_growth"</span>)) {</span>
<span id="cb73-977"><a href="#cb73-977" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb73-978"><a href="#cb73-978" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(<span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb73-979"><a href="#cb73-979" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(CBSA, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb73-980"><a href="#cb73-980" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(PERMITS <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)),</span>
<span id="cb73-981"><a href="#cb73-981" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-982"><a href="#cb73-982" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(population), <span class="sc">!</span><span class="fu">is.na</span>(new_housing_units_permitted))</span>
<span id="cb73-983"><a href="#cb73-983" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-984"><a href="#cb73-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-985"><a href="#cb73-985" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) 5-year population growth (starts in 2014)</span></span>
<span id="cb73-986"><a href="#cb73-986" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"pop_growth_5yr"</span> <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth)) {</span>
<span id="cb73-987"><a href="#cb73-987" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-988"><a href="#cb73-988" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb73-989"><a href="#cb73-989" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-990"><a href="#cb73-990" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb73-991"><a href="#cb73-991" aria-hidden="true" tabindex="-1"></a>      <span class="at">pop_lag5 =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb73-992"><a href="#cb73-992" aria-hidden="true" tabindex="-1"></a>      <span class="at">pop_growth_5yr =</span> <span class="fu">if_else</span>(<span class="fu">is.finite</span>(pop_lag5) <span class="sc">&amp;</span> pop_lag5 <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-993"><a href="#cb73-993" aria-hidden="true" tabindex="-1"></a>                               (population <span class="sc">-</span> pop_lag5) <span class="sc">/</span> pop_lag5,</span>
<span id="cb73-994"><a href="#cb73-994" aria-hidden="true" tabindex="-1"></a>                               <span class="cn">NA_real_</span>)</span>
<span id="cb73-995"><a href="#cb73-995" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb73-996"><a href="#cb73-996" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb73-997"><a href="#cb73-997" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-998"><a href="#cb73-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-999"><a href="#cb73-999" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Instantaneous &amp; rate-based raw metrics</span></span>
<span id="cb73-1000"><a href="#cb73-1000" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"instantaneous_growth"</span>,<span class="st">"rate_based_growth"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb73-1001"><a href="#cb73-1001" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1002"><a href="#cb73-1002" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb73-1003"><a href="#cb73-1003" aria-hidden="true" tabindex="-1"></a>      <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,  <span class="co"># units per 1,000 people</span></span>
<span id="cb73-1004"><a href="#cb73-1004" aria-hidden="true" tabindex="-1"></a>      <span class="at">rate_based_growth =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-1005"><a href="#cb73-1005" aria-hidden="true" tabindex="-1"></a>                                  new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr <span class="sc">*</span> <span class="dv">100</span>), <span class="co"># permits per 1% pop growth</span></span>
<span id="cb73-1006"><a href="#cb73-1006" aria-hidden="true" tabindex="-1"></a>                                  <span class="cn">NA_real_</span>)</span>
<span id="cb73-1007"><a href="#cb73-1007" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-1008"><a href="#cb73-1008" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1009"><a href="#cb73-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1010"><a href="#cb73-1010" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Safe scaler (0–100). If all NA or zero range, returns NA.</span></span>
<span id="cb73-1011"><a href="#cb73-1011" aria-hidden="true" tabindex="-1"></a>safe_scale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb73-1012"><a href="#cb73-1012" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x)</span>
<span id="cb73-1013"><a href="#cb73-1013" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(x))) <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb73-1014"><a href="#cb73-1014" aria-hidden="true" tabindex="-1"></a>  rng <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-1015"><a href="#cb73-1015" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(rng[<span class="dv">1</span>]) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.finite</span>(rng[<span class="dv">2</span>]) <span class="sc">||</span> rng[<span class="dv">1</span>] <span class="sc">==</span> rng[<span class="dv">2</span>]) {</span>
<span id="cb73-1016"><a href="#cb73-1016" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb73-1017"><a href="#cb73-1017" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-1018"><a href="#cb73-1018" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> rng[<span class="dv">1</span>]) <span class="sc">/</span> (rng[<span class="dv">2</span>] <span class="sc">-</span> rng[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb73-1019"><a href="#cb73-1019" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1020"><a href="#cb73-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1021"><a href="#cb73-1021" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Standardized indices</span></span>
<span id="cb73-1022"><a href="#cb73-1022" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"inst_index"</span>,<span class="st">"rate_index"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb73-1023"><a href="#cb73-1023" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1024"><a href="#cb73-1024" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb73-1025"><a href="#cb73-1025" aria-hidden="true" tabindex="-1"></a>      <span class="at">inst_index  =</span> <span class="fu">safe_scale01</span>(instantaneous_growth),</span>
<span id="cb73-1026"><a href="#cb73-1026" aria-hidden="true" tabindex="-1"></a>      <span class="at">rate_index  =</span> <span class="fu">safe_scale01</span>(rate_based_growth)</span>
<span id="cb73-1027"><a href="#cb73-1027" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-1028"><a href="#cb73-1028" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1029"><a href="#cb73-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1030"><a href="#cb73-1030" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Composite index</span></span>
<span id="cb73-1031"><a href="#cb73-1031" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1032"><a href="#cb73-1032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">composite_index =</span> (inst_index <span class="sc">+</span> rate_index) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb73-1033"><a href="#cb73-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1034"><a href="#cb73-1034" aria-hidden="true" tabindex="-1"></a><span class="co"># 7) Convenience table(s) for latest year used by Step 6</span></span>
<span id="cb73-1035"><a href="#cb73-1035" aria-hidden="true" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="dv">2023</span></span>
<span id="cb73-1036"><a href="#cb73-1036" aria-hidden="true" tabindex="-1"></a>inst_rank <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1037"><a href="#cb73-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb73-1038"><a href="#cb73-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(inst_index)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1039"><a href="#cb73-1039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-1040"><a href="#cb73-1040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metric =</span> <span class="st">"Instantaneous growth"</span>)</span>
<span id="cb73-1041"><a href="#cb73-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1042"><a href="#cb73-1042" aria-hidden="true" tabindex="-1"></a>rate_rank <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1043"><a href="#cb73-1043" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb73-1044"><a href="#cb73-1044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(rate_index)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1045"><a href="#cb73-1045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-1046"><a href="#cb73-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metric =</span> <span class="st">"Rate-based growth"</span>)</span>
<span id="cb73-1047"><a href="#cb73-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1048"><a href="#cb73-1048" aria-hidden="true" tabindex="-1"></a>top10_housing <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(inst_rank, rate_rank)</span>
<span id="cb73-1049"><a href="#cb73-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1050"><a href="#cb73-1050" aria-hidden="true" tabindex="-1"></a>composite_rank <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1051"><a href="#cb73-1051" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">%&gt;%</span></span>
<span id="cb73-1052"><a href="#cb73-1052" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(composite_index)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1053"><a href="#cb73-1053" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb73-1054"><a href="#cb73-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1055"><a href="#cb73-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1056"><a href="#cb73-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1057"><a href="#cb73-1057" aria-hidden="true" tabindex="-1"></a><span class="fu">### Step 6: Complex Index</span></span>
<span id="cb73-1060"><a href="#cb73-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1061"><a href="#cb73-1061" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb73-1062"><a href="#cb73-1062" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb73-1063"><a href="#cb73-1063" aria-hidden="true" tabindex="-1"></a>    <span class="at">composite_index =</span> (inst_index <span class="sc">+</span> rate_index) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb73-1064"><a href="#cb73-1064" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-1065"><a href="#cb73-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1066"><a href="#cb73-1066" aria-hidden="true" tabindex="-1"></a>composite_rank <span class="ot">&lt;-</span> housing_growth <span class="sc">|&gt;</span></span>
<span id="cb73-1067"><a href="#cb73-1067" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> latest_year) <span class="sc">|&gt;</span></span>
<span id="cb73-1068"><a href="#cb73-1068" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(composite_index)) <span class="sc">|&gt;</span></span>
<span id="cb73-1069"><a href="#cb73-1069" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb73-1070"><a href="#cb73-1070" aria-hidden="true" tabindex="-1"></a>composite_rank</span>
<span id="cb73-1071"><a href="#cb73-1071" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1072"><a href="#cb73-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1073"><a href="#cb73-1073" aria-hidden="true" tabindex="-1"></a><span class="fu">### Vizulizations</span></span>
<span id="cb73-1074"><a href="#cb73-1074" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part A:</span></span>
<span id="cb73-1077"><a href="#cb73-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1078"><a href="#cb73-1078" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(top10_housing,</span>
<span id="cb73-1079"><a href="#cb73-1079" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(NAME, <span class="fu">ifelse</span>(metric<span class="sc">==</span><span class="st">"Instantaneous growth"</span>, inst_index, rate_index)),</span>
<span id="cb73-1080"><a href="#cb73-1080" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="fu">ifelse</span>(metric<span class="sc">==</span><span class="st">"Instantaneous growth"</span>, inst_index, rate_index),</span>
<span id="cb73-1081"><a href="#cb73-1081" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> metric)) <span class="sc">+</span></span>
<span id="cb73-1082"><a href="#cb73-1082" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb73-1083"><a href="#cb73-1083" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb73-1084"><a href="#cb73-1084" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Instantaneous growth"</span><span class="ot">=</span><span class="st">"#2F6CFF"</span>, <span class="st">"Rate-based growth"</span><span class="ot">=</span><span class="st">"#FF7F0E"</span>)) <span class="sc">+</span></span>
<span id="cb73-1085"><a href="#cb73-1085" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-1086"><a href="#cb73-1086" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 10 CBSAs by Housing Growth Metrics (2023)"</span>,</span>
<span id="cb73-1087"><a href="#cb73-1087" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Metropolitan Area"</span>, <span class="at">y =</span> <span class="st">"Index (0–100)"</span>, <span class="at">fill =</span> <span class="st">"Metric"</span></span>
<span id="cb73-1088"><a href="#cb73-1088" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-1089"><a href="#cb73-1089" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb73-1090"><a href="#cb73-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1091"><a href="#cb73-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1092"><a href="#cb73-1092" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part B:</span></span>
<span id="cb73-1095"><a href="#cb73-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1096"><a href="#cb73-1096" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(composite_rank,</span>
<span id="cb73-1097"><a href="#cb73-1097" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(NAME, composite_index), <span class="at">y =</span> composite_index)) <span class="sc">+</span></span>
<span id="cb73-1098"><a href="#cb73-1098" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2CA02C"</span>) <span class="sc">+</span></span>
<span id="cb73-1099"><a href="#cb73-1099" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb73-1100"><a href="#cb73-1100" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-1101"><a href="#cb73-1101" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 10 CBSAs by Composite Housing Growth Index (2023)"</span>,</span>
<span id="cb73-1102"><a href="#cb73-1102" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Metropolitan Area"</span>, <span class="at">y =</span> <span class="st">"Composite Index (0–100)"</span></span>
<span id="cb73-1103"><a href="#cb73-1103" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-1104"><a href="#cb73-1104" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb73-1105"><a href="#cb73-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1106"><a href="#cb73-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1107"><a href="#cb73-1107" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 6: Vizulization for the investigation </span></span>
<span id="cb73-1108"><a href="#cb73-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1109"><a href="#cb73-1109" aria-hidden="true" tabindex="-1"></a>In Task 6, we combined the Rent Burden Index and Housing Growth Index to examine how affordability trends relate to construction activity.</span>
<span id="cb73-1110"><a href="#cb73-1110" aria-hidden="true" tabindex="-1"></a>This integration identifies cities that demonstrate true YIMBY success—those experiencing:</span>
<span id="cb73-1111"><a href="#cb73-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1112"><a href="#cb73-1112" aria-hidden="true" tabindex="-1"></a>High initial rent burden but improvement over time, Sustained population growth, and Above-average housing construction.</span>
<span id="cb73-1113"><a href="#cb73-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1114"><a href="#cb73-1114" aria-hidden="true" tabindex="-1"></a>The visualizations created here (quadrant plots and trend lines) make it easy to see which cities are reducing affordability pressures through increased housing supply—versus those becoming affordable only because of population loss.</span>
<span id="cb73-1115"><a href="#cb73-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1116"><a href="#cb73-1116" aria-hidden="true" tabindex="-1"></a><span class="fu">### Preliminary Metrics</span></span>
<span id="cb73-1119"><a href="#cb73-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1120"><a href="#cb73-1120" aria-hidden="true" tabindex="-1"></a>yimby_df <span class="ot">&lt;-</span> rent_income <span class="sc">|&gt;</span></span>
<span id="cb73-1121"><a href="#cb73-1121" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">CBSA =</span> CBSA, NAME, year, rent_burden_index) <span class="sc">|&gt;</span></span>
<span id="cb73-1122"><a href="#cb73-1122" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb73-1123"><a href="#cb73-1123" aria-hidden="true" tabindex="-1"></a>    housing_growth <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(CBSA, year, composite_index, population),</span>
<span id="cb73-1124"><a href="#cb73-1124" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)</span>
<span id="cb73-1125"><a href="#cb73-1125" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-1126"><a href="#cb73-1126" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rent_burden_index), <span class="sc">!</span><span class="fu">is.na</span>(composite_index))</span>
<span id="cb73-1127"><a href="#cb73-1127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1130"><a href="#cb73-1130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1131"><a href="#cb73-1131" aria-hidden="true" tabindex="-1"></a>yimby_summary <span class="ot">&lt;-</span> yimby_df <span class="sc">|&gt;</span></span>
<span id="cb73-1132"><a href="#cb73-1132" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(CBSA, NAME) <span class="sc">|&gt;</span></span>
<span id="cb73-1133"><a href="#cb73-1133" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb73-1134"><a href="#cb73-1134" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_early =</span> <span class="fu">mean</span>(rent_burden_index[year <span class="sc">&lt;=</span> <span class="dv">2012</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1135"><a href="#cb73-1135" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_late  =</span> <span class="fu">mean</span>(rent_burden_index[year <span class="sc">&gt;=</span> <span class="dv">2019</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1136"><a href="#cb73-1136" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change =</span> rent_burden_late <span class="sc">-</span> rent_burden_early,</span>
<span id="cb73-1137"><a href="#cb73-1137" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_early =</span> <span class="fu">mean</span>(population[year <span class="sc">&lt;=</span> <span class="dv">2012</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1138"><a href="#cb73-1138" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_late  =</span> <span class="fu">mean</span>(population[year <span class="sc">&gt;=</span> <span class="dv">2019</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1139"><a href="#cb73-1139" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_change_pct =</span> (pop_late <span class="sc">-</span> pop_early) <span class="sc">/</span> pop_early <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb73-1140"><a href="#cb73-1140" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_housing_index =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1141"><a href="#cb73-1141" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb73-1142"><a href="#cb73-1142" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-1143"><a href="#cb73-1143" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rent_burden_change), <span class="sc">!</span><span class="fu">is.na</span>(pop_change_pct))</span>
<span id="cb73-1144"><a href="#cb73-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1145"><a href="#cb73-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1146"><a href="#cb73-1146" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr); <span class="fu">library</span>(stringr); <span class="fu">library</span>(ggplot2)</span>
<span id="cb73-1147"><a href="#cb73-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1148"><a href="#cb73-1148" aria-hidden="true" tabindex="-1"></a><span class="co"># rent_income (if missing)</span></span>
<span id="cb73-1149"><a href="#cb73-1149" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"rent_income"</span>)) {</span>
<span id="cb73-1150"><a href="#cb73-1150" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb73-1151"><a href="#cb73-1151" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">%&gt;%</span></span>
<span id="cb73-1152"><a href="#cb73-1152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(RENT <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, monthly_rent), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1153"><a href="#cb73-1153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(POPULATION <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, population), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1154"><a href="#cb73-1154" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb73-1155"><a href="#cb73-1155" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1156"><a href="#cb73-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1157"><a href="#cb73-1157" aria-hidden="true" tabindex="-1"></a><span class="co"># rent burden columns</span></span>
<span id="cb73-1158"><a href="#cb73-1158" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"rent_burden_raw"</span> <span class="sc">%in%</span> <span class="fu">names</span>(rent_income))) {</span>
<span id="cb73-1159"><a href="#cb73-1159" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb73-1160"><a href="#cb73-1160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rent_burden_raw =</span> <span class="fu">if_else</span>(</span>
<span id="cb73-1161"><a href="#cb73-1161" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.finite</span>(household_income) <span class="sc">&amp;</span> household_income <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.finite</span>(monthly_rent),</span>
<span id="cb73-1162"><a href="#cb73-1162" aria-hidden="true" tabindex="-1"></a>      (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income, <span class="cn">NA_real_</span></span>
<span id="cb73-1163"><a href="#cb73-1163" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb73-1164"><a href="#cb73-1164" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1165"><a href="#cb73-1165" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"rent_burden_index"</span> <span class="sc">%in%</span> <span class="fu">names</span>(rent_income))) {</span>
<span id="cb73-1166"><a href="#cb73-1166" aria-hidden="true" tabindex="-1"></a>  baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-1167"><a href="#cb73-1167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(base)</span>
<span id="cb73-1168"><a href="#cb73-1168" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(baseline_2009)) {</span>
<span id="cb73-1169"><a href="#cb73-1169" aria-hidden="true" tabindex="-1"></a>    baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(base)</span>
<span id="cb73-1170"><a href="#cb73-1170" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-1171"><a href="#cb73-1171" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb73-1172"><a href="#cb73-1172" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rent_burden_index =</span> <span class="dv">50</span> <span class="sc">*</span> (rent_burden_raw <span class="sc">/</span> baseline_2009))</span>
<span id="cb73-1173"><a href="#cb73-1173" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1174"><a href="#cb73-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1175"><a href="#cb73-1175" aria-hidden="true" tabindex="-1"></a><span class="co"># housing_growth (if missing)</span></span>
<span id="cb73-1176"><a href="#cb73-1176" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"housing_growth"</span>)) {</span>
<span id="cb73-1177"><a href="#cb73-1177" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb73-1178"><a href="#cb73-1178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(<span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb73-1179"><a href="#cb73-1179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(CBSA, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb73-1180"><a href="#cb73-1180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(PERMITS <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1181"><a href="#cb73-1181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(population), <span class="sc">!</span><span class="fu">is.na</span>(new_housing_units_permitted))</span>
<span id="cb73-1182"><a href="#cb73-1182" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1183"><a href="#cb73-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1184"><a href="#cb73-1184" aria-hidden="true" tabindex="-1"></a><span class="co"># 5-year population growth + raw growth metrics</span></span>
<span id="cb73-1185"><a href="#cb73-1185" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"pop_growth_5yr"</span> <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb73-1186"><a href="#cb73-1186" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1187"><a href="#cb73-1187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb73-1188"><a href="#cb73-1188" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-1189"><a href="#cb73-1189" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pop_lag5 =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb73-1190"><a href="#cb73-1190" aria-hidden="true" tabindex="-1"></a>           <span class="at">pop_growth_5yr =</span> <span class="fu">if_else</span>(<span class="fu">is.finite</span>(pop_lag5) <span class="sc">&amp;</span> pop_lag5 <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-1191"><a href="#cb73-1191" aria-hidden="true" tabindex="-1"></a>                                    (population <span class="sc">-</span> pop_lag5)<span class="sc">/</span>pop_lag5, <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1192"><a href="#cb73-1192" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb73-1193"><a href="#cb73-1193" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1194"><a href="#cb73-1194" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"instantaneous_growth"</span>,<span class="st">"rate_based_growth"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb73-1195"><a href="#cb73-1195" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1196"><a href="#cb73-1196" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb73-1197"><a href="#cb73-1197" aria-hidden="true" tabindex="-1"></a>      <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,</span>
<span id="cb73-1198"><a href="#cb73-1198" aria-hidden="true" tabindex="-1"></a>      <span class="at">rate_based_growth =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-1199"><a href="#cb73-1199" aria-hidden="true" tabindex="-1"></a>                                  new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb73-1200"><a href="#cb73-1200" aria-hidden="true" tabindex="-1"></a>                                  <span class="cn">NA_real_</span>)</span>
<span id="cb73-1201"><a href="#cb73-1201" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-1202"><a href="#cb73-1202" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1203"><a href="#cb73-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1204"><a href="#cb73-1204" aria-hidden="true" tabindex="-1"></a><span class="co"># 0–100 scaling helpers</span></span>
<span id="cb73-1205"><a href="#cb73-1205" aria-hidden="true" tabindex="-1"></a>safe_scale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb73-1206"><a href="#cb73-1206" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x)</span>
<span id="cb73-1207"><a href="#cb73-1207" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(x))) <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb73-1208"><a href="#cb73-1208" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-1209"><a href="#cb73-1209" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(r[<span class="dv">1</span>]) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.finite</span>(r[<span class="dv">2</span>]) <span class="sc">||</span> r[<span class="dv">1</span>] <span class="sc">==</span> r[<span class="dv">2</span>]) <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb73-1210"><a href="#cb73-1210" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> r[<span class="dv">1</span>])<span class="sc">/</span>(r[<span class="dv">2</span>] <span class="sc">-</span> r[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb73-1211"><a href="#cb73-1211" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1212"><a href="#cb73-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1213"><a href="#cb73-1213" aria-hidden="true" tabindex="-1"></a><span class="co"># standardized indices + composite</span></span>
<span id="cb73-1214"><a href="#cb73-1214" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"inst_index"</span>,<span class="st">"rate_index"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb73-1215"><a href="#cb73-1215" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1216"><a href="#cb73-1216" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">inst_index =</span> <span class="fu">safe_scale01</span>(instantaneous_growth),</span>
<span id="cb73-1217"><a href="#cb73-1217" aria-hidden="true" tabindex="-1"></a>           <span class="at">rate_index =</span> <span class="fu">safe_scale01</span>(rate_based_growth))</span>
<span id="cb73-1218"><a href="#cb73-1218" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1219"><a href="#cb73-1219" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1220"><a href="#cb73-1220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">composite_index =</span> (inst_index <span class="sc">+</span> rate_index)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb73-1221"><a href="#cb73-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1222"><a href="#cb73-1222" aria-hidden="true" tabindex="-1"></a><span class="co"># merged analysis frame</span></span>
<span id="cb73-1223"><a href="#cb73-1223" aria-hidden="true" tabindex="-1"></a>yimby_df <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb73-1224"><a href="#cb73-1224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA, NAME, year, rent_burden_index, population) <span class="sc">%&gt;%</span></span>
<span id="cb73-1225"><a href="#cb73-1225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(housing_growth <span class="sc">%&gt;%</span> <span class="fu">select</span>(CBSA, year, composite_index), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1226"><a href="#cb73-1226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(rent_burden_index), <span class="fu">is.finite</span>(composite_index))</span>
<span id="cb73-1227"><a href="#cb73-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1228"><a href="#cb73-1228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1231"><a href="#cb73-1231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1232"><a href="#cb73-1232" aria-hidden="true" tabindex="-1"></a>yimby_summary <span class="ot">&lt;-</span> yimby_df <span class="sc">%&gt;%</span></span>
<span id="cb73-1233"><a href="#cb73-1233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb73-1234"><a href="#cb73-1234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-1235"><a href="#cb73-1235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_obs =</span> dplyr<span class="sc">::</span><span class="fu">n</span>(),</span>
<span id="cb73-1236"><a href="#cb73-1236" aria-hidden="true" tabindex="-1"></a>         <span class="at">idx =</span> <span class="fu">row_number</span>(),</span>
<span id="cb73-1237"><a href="#cb73-1237" aria-hidden="true" tabindex="-1"></a>         <span class="at">idx_rev =</span> <span class="fu">rev</span>(idx)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1238"><a href="#cb73-1238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb73-1239"><a href="#cb73-1239" aria-hidden="true" tabindex="-1"></a>    <span class="co"># early = mean of first up to 3 available years</span></span>
<span id="cb73-1240"><a href="#cb73-1240" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_early =</span> <span class="fu">mean</span>(rent_burden_index[idx <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1241"><a href="#cb73-1241" aria-hidden="true" tabindex="-1"></a>    <span class="co"># late  = mean of last up to 3 available years</span></span>
<span id="cb73-1242"><a href="#cb73-1242" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_late  =</span> <span class="fu">mean</span>(rent_burden_index[idx_rev <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1243"><a href="#cb73-1243" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change =</span> rent_burden_late <span class="sc">-</span> rent_burden_early,</span>
<span id="cb73-1244"><a href="#cb73-1244" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_early =</span> <span class="fu">mean</span>(population[idx <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1245"><a href="#cb73-1245" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_late  =</span> <span class="fu">mean</span>(population[idx_rev <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1246"><a href="#cb73-1246" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_change_pct =</span> <span class="fu">if_else</span>(<span class="fu">is.finite</span>(pop_early) <span class="sc">&amp;</span> pop_early <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-1247"><a href="#cb73-1247" aria-hidden="true" tabindex="-1"></a>                             (pop_late <span class="sc">-</span> pop_early)<span class="sc">/</span>pop_early <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb73-1248"><a href="#cb73-1248" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_housing_index =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1249"><a href="#cb73-1249" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb73-1250"><a href="#cb73-1250" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb73-1251"><a href="#cb73-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(rent_burden_change), <span class="fu">is.finite</span>(pop_change_pct), <span class="fu">is.finite</span>(avg_housing_index))</span>
<span id="cb73-1252"><a href="#cb73-1252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1253"><a href="#cb73-1253" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot 1:</span></span>
<span id="cb73-1256"><a href="#cb73-1256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1257"><a href="#cb73-1257" aria-hidden="true" tabindex="-1"></a>y_thr <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.finite</span>(<span class="fu">mean</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb73-1258"><a href="#cb73-1258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="cf">else</span> <span class="fu">median</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-1259"><a href="#cb73-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1260"><a href="#cb73-1260" aria-hidden="true" tabindex="-1"></a>x_thr <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># zero = falling rent burden</span></span>
<span id="cb73-1261"><a href="#cb73-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1262"><a href="#cb73-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(yimby_summary, <span class="fu">aes</span>(<span class="at">x =</span> rent_burden_change, <span class="at">y =</span> avg_housing_index, <span class="at">size =</span> <span class="fu">pmax</span>(pop_change_pct, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb73-1263"><a href="#cb73-1263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"#2F6CFF"</span>) <span class="sc">+</span></span>
<span id="cb73-1264"><a href="#cb73-1264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> y_thr, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb73-1265"><a href="#cb73-1265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> x_thr, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb73-1266"><a href="#cb73-1266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Population growth (%)"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb73-1267"><a href="#cb73-1267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-1268"><a href="#cb73-1268" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Housing Growth vs Change in Rent Burden"</span>,</span>
<span id="cb73-1269"><a href="#cb73-1269" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Upper-left = decreasing burden, above-average housing growth, and positive population growth"</span>,</span>
<span id="cb73-1270"><a href="#cb73-1270" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Change in Rent Burden Index (late − early)"</span>,</span>
<span id="cb73-1271"><a href="#cb73-1271" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Housing Growth Index (0–100)"</span></span>
<span id="cb73-1272"><a href="#cb73-1272" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-1273"><a href="#cb73-1273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb73-1274"><a href="#cb73-1274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1275"><a href="#cb73-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1276"><a href="#cb73-1276" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot 2:</span></span>
<span id="cb73-1279"><a href="#cb73-1279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1280"><a href="#cb73-1280" aria-hidden="true" tabindex="-1"></a>cands <span class="ot">&lt;-</span> yimby_summary <span class="sc">%&gt;%</span></span>
<span id="cb73-1281"><a href="#cb73-1281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>, avg_housing_index <span class="sc">&gt;=</span> y_thr, pop_change_pct <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb73-1282"><a href="#cb73-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1283"><a href="#cb73-1283" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(cands) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb73-1284"><a href="#cb73-1284" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fallback 1: use median threshold for housing</span></span>
<span id="cb73-1285"><a href="#cb73-1285" aria-hidden="true" tabindex="-1"></a>  y_med <span class="ot">&lt;-</span> <span class="fu">median</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-1286"><a href="#cb73-1286" aria-hidden="true" tabindex="-1"></a>  cands <span class="ot">&lt;-</span> yimby_summary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>, avg_housing_index <span class="sc">&gt;=</span> y_med, pop_change_pct <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb73-1287"><a href="#cb73-1287" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1288"><a href="#cb73-1288" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(cands) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb73-1289"><a href="#cb73-1289" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fallback 2: keep decreasing rent burden + nonnegative pop growth; take top by housing index</span></span>
<span id="cb73-1290"><a href="#cb73-1290" aria-hidden="true" tabindex="-1"></a>  cands <span class="ot">&lt;-</span> yimby_summary <span class="sc">%&gt;%</span></span>
<span id="cb73-1291"><a href="#cb73-1291" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>, pop_change_pct <span class="sc">&gt;=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-1292"><a href="#cb73-1292" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(avg_housing_index, <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb73-1293"><a href="#cb73-1293" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb73-1294"><a href="#cb73-1294" aria-hidden="true" tabindex="-1"></a>  cands <span class="ot">&lt;-</span> cands <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(avg_housing_index, <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb73-1295"><a href="#cb73-1295" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1296"><a href="#cb73-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1297"><a href="#cb73-1297" aria-hidden="true" tabindex="-1"></a>yimby_df <span class="sc">%&gt;%</span></span>
<span id="cb73-1298"><a href="#cb73-1298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">%in%</span> cands<span class="sc">$</span>CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb73-1299"><a href="#cb73-1299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index, <span class="at">color =</span> NAME, <span class="at">group =</span> NAME)) <span class="sc">+</span></span>
<span id="cb73-1300"><a href="#cb73-1300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-1301"><a href="#cb73-1301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb73-1302"><a href="#cb73-1302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-1303"><a href="#cb73-1303" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Evolution of Rent Burden in Candidate YIMBY CBSAs"</span>,</span>
<span id="cb73-1304"><a href="#cb73-1304" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Rent Burden Index (0–100)"</span>, <span class="at">color =</span> <span class="st">"CBSA"</span></span>
<span id="cb73-1305"><a href="#cb73-1305" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-1306"><a href="#cb73-1306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb73-1307"><a href="#cb73-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1308"><a href="#cb73-1308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1309"><a href="#cb73-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1310"><a href="#cb73-1310" aria-hidden="true" tabindex="-1"></a>To explore YIMBY dynamics, I merged rent-burden and housing-growth indices and visualized their interaction.</span>
<span id="cb73-1311"><a href="#cb73-1311" aria-hidden="true" tabindex="-1"></a>The first plot reveals that CBSAs with decreasing rent burden, rising housing-growth index, and positive population growth cluster in the upper left quadrant which are indicators of policy environments that support both affordability and expansion.</span>
<span id="cb73-1312"><a href="#cb73-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1313"><a href="#cb73-1313" aria-hidden="true" tabindex="-1"></a>The second plot tracks these metros over time, showing steadily easing rent burdens despite growth pressures.</span>
<span id="cb73-1314"><a href="#cb73-1314" aria-hidden="true" tabindex="-1"></a>Together, these visuals showcase constructive affordability driven by supply expansion from decline-driven affordability aka falling demand.</span>
<span id="cb73-1315"><a href="#cb73-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1316"><a href="#cb73-1316" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task 7: Policy Brief + Extra Credit 3</span></span>
<span id="cb73-1317"><a href="#cb73-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1318"><a href="#cb73-1318" aria-hidden="true" tabindex="-1"></a>Policy Brief: A Federal Incentive for YIMBY Growth</span>
<span id="cb73-1319"><a href="#cb73-1319" aria-hidden="true" tabindex="-1"></a>with a Focus on Millennial Appeal</span>
<span id="cb73-1320"><a href="#cb73-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1321"><a href="#cb73-1321" aria-hidden="true" tabindex="-1"></a>Purpose</span>
<span id="cb73-1322"><a href="#cb73-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1323"><a href="#cb73-1323" aria-hidden="true" tabindex="-1"></a>Establish a federal YIMBY Incentive Program that rewards cities creating affordable, livable, and youth-friendly housing environments. By combining rent affordability, housing growth, and millennial appeal, this initiative aligns federal resources with cities that promote sustainable, inclusive growth.</span>
<span id="cb73-1324"><a href="#cb73-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1325"><a href="#cb73-1325" aria-hidden="true" tabindex="-1"></a>Proposed Bill Sponsors</span>
<span id="cb73-1326"><a href="#cb73-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1327"><a href="#cb73-1327" aria-hidden="true" tabindex="-1"></a>Primary Sponsor — Houston, TX</span>
<span id="cb73-1328"><a href="#cb73-1328" aria-hidden="true" tabindex="-1"></a>Houston demonstrates YIMBY success: strong housing-permit activity, net population growth, and easing rent burden. Federal support reinforces policies that already make Houston one of America’s most affordable large metros for young professionals.</span>
<span id="cb73-1329"><a href="#cb73-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1330"><a href="#cb73-1330" aria-hidden="true" tabindex="-1"></a>Co-Sponsor — New York City, NY</span>
<span id="cb73-1331"><a href="#cb73-1331" aria-hidden="true" tabindex="-1"></a>New York represents the NIMBY challenge: persistently high rent burden and slower housing growth despite strong demand. Participation highlights bipartisan cooperation and the need to expand supply in high-cost metros.</span>
<span id="cb73-1332"><a href="#cb73-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1333"><a href="#cb73-1333" aria-hidden="true" tabindex="-1"></a>Metrics for Federal Targeting</span>
<span id="cb73-1334"><a href="#cb73-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1335"><a href="#cb73-1335" aria-hidden="true" tabindex="-1"></a>Rent Burden Index — Ratio of annual rent to median household income, standardized so 50 = national average (2009). Lower = more affordable.</span>
<span id="cb73-1336"><a href="#cb73-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1337"><a href="#cb73-1337" aria-hidden="true" tabindex="-1"></a>Housing Growth Index — Composite of (a) permits per 1,000 residents and (b) permits relative to five-year population growth, scaled 0–100. Higher = more “building-friendly.”</span>
<span id="cb73-1338"><a href="#cb73-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1339"><a href="#cb73-1339" aria-hidden="true" tabindex="-1"></a>Millennial Attraction Index (MAI) — Share of age 25–34 relative to the national average in the same year, scaled so 100 = national average. Higher = greater young-adult appeal.</span>
<span id="cb73-1340"><a href="#cb73-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1341"><a href="#cb73-1341" aria-hidden="true" tabindex="-1"></a>Why This Bill Matters</span>
<span id="cb73-1342"><a href="#cb73-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1343"><a href="#cb73-1343" aria-hidden="true" tabindex="-1"></a>Affordability without decline: Falling rent burden alongside population growth indicates supply-driven affordability.</span>
<span id="cb73-1344"><a href="#cb73-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1345"><a href="#cb73-1345" aria-hidden="true" tabindex="-1"></a>Millennial retention: Youth-friendly metros attract and keep the talent base essential to long-run growth.</span>
<span id="cb73-1346"><a href="#cb73-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1347"><a href="#cb73-1347" aria-hidden="true" tabindex="-1"></a>Broad coalitions: Construction trades, public services, and creative industries all benefit.</span>
<span id="cb73-1348"><a href="#cb73-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1349"><a href="#cb73-1349" aria-hidden="true" tabindex="-1"></a>Cross-partisan appeal: High-growth metros earn recognition; high-cost metros receive tools to catch up.</span>
<span id="cb73-1350"><a href="#cb73-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1351"><a href="#cb73-1351" aria-hidden="true" tabindex="-1"></a>Key Takeaway: A Federal YIMBY Incentive rewards metros like Houston that show supply-driven affordability and helps metros like New York expand housing so young workers and families can afford to live, work, and thrive.</span>
<span id="cb73-1352"><a href="#cb73-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1355"><a href="#cb73-1355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1356"><a href="#cb73-1356" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr); <span class="fu">library</span>(stringr); <span class="fu">library</span>(tidyr)</span>
<span id="cb73-1357"><a href="#cb73-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1358"><a href="#cb73-1358" aria-hidden="true" tabindex="-1"></a><span class="co"># 25–34 = (male 25–29, male 30–34, female 25–29, female 30–34)</span></span>
<span id="cb73-1359"><a href="#cb73-1359" aria-hidden="true" tabindex="-1"></a>A25_29_M <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01001_008"</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">m25_29 =</span> B01001_008)</span>
<span id="cb73-1360"><a href="#cb73-1360" aria-hidden="true" tabindex="-1"></a>A30_34_M <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01001_009"</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">m30_34 =</span> B01001_009)</span>
<span id="cb73-1361"><a href="#cb73-1361" aria-hidden="true" tabindex="-1"></a>A25_29_F <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01001_032"</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">f25_29 =</span> B01001_032)</span>
<span id="cb73-1362"><a href="#cb73-1362" aria-hidden="true" tabindex="-1"></a>A30_34_F <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01001_033"</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">f30_34 =</span> B01001_033)</span>
<span id="cb73-1363"><a href="#cb73-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1364"><a href="#cb73-1364" aria-hidden="true" tabindex="-1"></a>YOUNG <span class="ot">&lt;-</span> A25_29_M <span class="sc">|&gt;</span></span>
<span id="cb73-1365"><a href="#cb73-1365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(A30_34_M, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-1366"><a href="#cb73-1366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(A25_29_F, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-1367"><a href="#cb73-1367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(A30_34_F, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-1368"><a href="#cb73-1368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">young_25_34 =</span> m25_29 <span class="sc">+</span> m30_34 <span class="sc">+</span> f25_29 <span class="sc">+</span> f30_34) <span class="sc">|&gt;</span></span>
<span id="cb73-1369"><a href="#cb73-1369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, young_25_34)</span>
<span id="cb73-1370"><a href="#cb73-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1371"><a href="#cb73-1371" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with total population (you already have it)</span></span>
<span id="cb73-1372"><a href="#cb73-1372" aria-hidden="true" tabindex="-1"></a>MAI <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb73-1373"><a href="#cb73-1373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, population) <span class="sc">|&gt;</span></span>
<span id="cb73-1374"><a href="#cb73-1374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(YOUNG, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-1375"><a href="#cb73-1375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-1376"><a href="#cb73-1376" aria-hidden="true" tabindex="-1"></a>    <span class="at">CBSA =</span> <span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb73-1377"><a href="#cb73-1377" aria-hidden="true" tabindex="-1"></a>    <span class="at">young_share =</span> young_25_34 <span class="sc">/</span> population</span>
<span id="cb73-1378"><a href="#cb73-1378" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-1379"><a href="#cb73-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1380"><a href="#cb73-1380" aria-hidden="true" tabindex="-1"></a><span class="co"># Within-year national baseline so 100 = US average in that year</span></span>
<span id="cb73-1381"><a href="#cb73-1381" aria-hidden="true" tabindex="-1"></a>MAI <span class="ot">&lt;-</span> MAI <span class="sc">|&gt;</span></span>
<span id="cb73-1382"><a href="#cb73-1382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb73-1383"><a href="#cb73-1383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-1384"><a href="#cb73-1384" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_avg_share =</span> <span class="fu">mean</span>(young_share, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1385"><a href="#cb73-1385" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAI =</span> <span class="dv">100</span> <span class="sc">*</span> (young_share <span class="sc">/</span> us_avg_share)</span>
<span id="cb73-1386"><a href="#cb73-1386" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb73-1387"><a href="#cb73-1387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb73-1388"><a href="#cb73-1388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1391"><a href="#cb73-1391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1392"><a href="#cb73-1392" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb73-1393"><a href="#cb73-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1394"><a href="#cb73-1394" aria-hidden="true" tabindex="-1"></a><span class="co"># Rent burden join</span></span>
<span id="cb73-1395"><a href="#cb73-1395" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"rent_income"</span>)) {</span>
<span id="cb73-1396"><a href="#cb73-1396" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> INCOME <span class="sc">%&gt;%</span></span>
<span id="cb73-1397"><a href="#cb73-1397" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(GEOID, NAME, year, household_income) <span class="sc">%&gt;%</span></span>
<span id="cb73-1398"><a href="#cb73-1398" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(RENT <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, monthly_rent), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1399"><a href="#cb73-1399" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(POPULATION <span class="sc">%&gt;%</span> <span class="fu">select</span>(GEOID, year, population), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1400"><a href="#cb73-1400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb73-1401"><a href="#cb73-1401" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1402"><a href="#cb73-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1403"><a href="#cb73-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1404"><a href="#cb73-1404" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"rent_burden_raw"</span> <span class="sc">%in%</span> <span class="fu">names</span>(rent_income))) {</span>
<span id="cb73-1405"><a href="#cb73-1405" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb73-1406"><a href="#cb73-1406" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rent_burden_raw =</span> <span class="fu">if_else</span>(</span>
<span id="cb73-1407"><a href="#cb73-1407" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.finite</span>(household_income) <span class="sc">&amp;</span> household_income <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.finite</span>(monthly_rent),</span>
<span id="cb73-1408"><a href="#cb73-1408" aria-hidden="true" tabindex="-1"></a>      (monthly_rent<span class="sc">*</span><span class="dv">12</span>) <span class="sc">/</span> household_income, <span class="cn">NA_real_</span></span>
<span id="cb73-1409"><a href="#cb73-1409" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb73-1410"><a href="#cb73-1410" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1411"><a href="#cb73-1411" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"rent_burden_index"</span> <span class="sc">%in%</span> <span class="fu">names</span>(rent_income))) {</span>
<span id="cb73-1412"><a href="#cb73-1412" aria-hidden="true" tabindex="-1"></a>  baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-1413"><a href="#cb73-1413" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(base)</span>
<span id="cb73-1414"><a href="#cb73-1414" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(baseline_2009)) {</span>
<span id="cb73-1415"><a href="#cb73-1415" aria-hidden="true" tabindex="-1"></a>    baseline_2009 <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">base =</span> <span class="fu">mean</span>(rent_burden_raw, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(base)</span>
<span id="cb73-1416"><a href="#cb73-1416" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-1417"><a href="#cb73-1417" aria-hidden="true" tabindex="-1"></a>  rent_income <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">rent_burden_index =</span> <span class="dv">50</span> <span class="sc">*</span> (rent_burden_raw <span class="sc">/</span> baseline_2009))</span>
<span id="cb73-1418"><a href="#cb73-1418" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1419"><a href="#cb73-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1420"><a href="#cb73-1420" aria-hidden="true" tabindex="-1"></a><span class="co"># Housing growth join</span></span>
<span id="cb73-1421"><a href="#cb73-1421" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"housing_growth"</span>)) {</span>
<span id="cb73-1422"><a href="#cb73-1422" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb73-1423"><a href="#cb73-1423" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(<span class="fu">str_sub</span>(GEOID, <span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb73-1424"><a href="#cb73-1424" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(CBSA, NAME, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb73-1425"><a href="#cb73-1425" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(PERMITS <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1426"><a href="#cb73-1426" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(population), <span class="sc">!</span><span class="fu">is.na</span>(new_housing_units_permitted))</span>
<span id="cb73-1427"><a href="#cb73-1427" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1428"><a href="#cb73-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1429"><a href="#cb73-1429" aria-hidden="true" tabindex="-1"></a><span class="co"># 5-year growth + metrics</span></span>
<span id="cb73-1430"><a href="#cb73-1430" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"pop_growth_5yr"</span> <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb73-1431"><a href="#cb73-1431" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1432"><a href="#cb73-1432" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb73-1433"><a href="#cb73-1433" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-1434"><a href="#cb73-1434" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pop_lag5 =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb73-1435"><a href="#cb73-1435" aria-hidden="true" tabindex="-1"></a>           <span class="at">pop_growth_5yr =</span> <span class="fu">if_else</span>(<span class="fu">is.finite</span>(pop_lag5) <span class="sc">&amp;</span> pop_lag5 <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-1436"><a href="#cb73-1436" aria-hidden="true" tabindex="-1"></a>                                    (population <span class="sc">-</span> pop_lag5)<span class="sc">/</span>pop_lag5, <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1437"><a href="#cb73-1437" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb73-1438"><a href="#cb73-1438" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1439"><a href="#cb73-1439" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"instantaneous_growth"</span>,<span class="st">"rate_based_growth"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb73-1440"><a href="#cb73-1440" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1441"><a href="#cb73-1441" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb73-1442"><a href="#cb73-1442" aria-hidden="true" tabindex="-1"></a>      <span class="at">instantaneous_growth =</span> (new_housing_units_permitted <span class="sc">/</span> population) <span class="sc">*</span> <span class="dv">1000</span>,        </span>
<span id="cb73-1443"><a href="#cb73-1443" aria-hidden="true" tabindex="-1"></a>      <span class="at">rate_based_growth    =</span> <span class="fu">if_else</span>(pop_growth_5yr <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-1444"><a href="#cb73-1444" aria-hidden="true" tabindex="-1"></a>                                     new_housing_units_permitted <span class="sc">/</span> (pop_growth_5yr<span class="sc">*</span><span class="dv">100</span>),</span>
<span id="cb73-1445"><a href="#cb73-1445" aria-hidden="true" tabindex="-1"></a>                                     <span class="cn">NA_real_</span>)</span>
<span id="cb73-1446"><a href="#cb73-1446" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-1447"><a href="#cb73-1447" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1448"><a href="#cb73-1448" aria-hidden="true" tabindex="-1"></a>safe_scale01 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb73-1449"><a href="#cb73-1449" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x)</span>
<span id="cb73-1450"><a href="#cb73-1450" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(x))) <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb73-1451"><a href="#cb73-1451" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">range</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-1452"><a href="#cb73-1452" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(r[<span class="dv">1</span>]) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.finite</span>(r[<span class="dv">2</span>]) <span class="sc">||</span> r[<span class="dv">1</span>] <span class="sc">==</span> r[<span class="dv">2</span>]) <span class="fu">return</span>(<span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="fu">length</span>(x)))</span>
<span id="cb73-1453"><a href="#cb73-1453" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> r[<span class="dv">1</span>])<span class="sc">/</span>(r[<span class="dv">2</span>]<span class="sc">-</span>r[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb73-1454"><a href="#cb73-1454" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1455"><a href="#cb73-1455" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"inst_index"</span>,<span class="st">"rate_index"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(housing_growth))) {</span>
<span id="cb73-1456"><a href="#cb73-1456" aria-hidden="true" tabindex="-1"></a>  housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1457"><a href="#cb73-1457" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">inst_index =</span> <span class="fu">safe_scale01</span>(instantaneous_growth),</span>
<span id="cb73-1458"><a href="#cb73-1458" aria-hidden="true" tabindex="-1"></a>           <span class="at">rate_index =</span> <span class="fu">safe_scale01</span>(rate_based_growth))</span>
<span id="cb73-1459"><a href="#cb73-1459" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-1460"><a href="#cb73-1460" aria-hidden="true" tabindex="-1"></a>housing_growth <span class="ot">&lt;-</span> housing_growth <span class="sc">%&gt;%</span></span>
<span id="cb73-1461"><a href="#cb73-1461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">composite_index =</span> (inst_index <span class="sc">+</span> rate_index)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb73-1462"><a href="#cb73-1462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1465"><a href="#cb73-1465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1466"><a href="#cb73-1466" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Merge Rent Burden + Housing Growth + MAI ----</span></span>
<span id="cb73-1467"><a href="#cb73-1467" aria-hidden="true" tabindex="-1"></a>yimby_df <span class="ot">&lt;-</span> rent_income <span class="sc">%&gt;%</span></span>
<span id="cb73-1468"><a href="#cb73-1468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA, NAME, year, rent_burden_index, population) <span class="sc">%&gt;%</span></span>
<span id="cb73-1469"><a href="#cb73-1469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(housing_growth <span class="sc">%&gt;%</span> <span class="fu">select</span>(CBSA, year, composite_index), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1470"><a href="#cb73-1470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(MAI <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">CBSA =</span> CBSA, year, MAI), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CBSA"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1471"><a href="#cb73-1471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(rent_burden_index), <span class="fu">is.finite</span>(composite_index), <span class="fu">is.finite</span>(MAI))</span>
<span id="cb73-1472"><a href="#cb73-1472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1475"><a href="#cb73-1475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1476"><a href="#cb73-1476" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Summary for quadrants with millennial appeal ----</span></span>
<span id="cb73-1477"><a href="#cb73-1477" aria-hidden="true" tabindex="-1"></a>yimby_summary <span class="ot">&lt;-</span> yimby_df <span class="sc">%&gt;%</span></span>
<span id="cb73-1478"><a href="#cb73-1478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb73-1479"><a href="#cb73-1479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-1480"><a href="#cb73-1480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_obs =</span> <span class="fu">n</span>(), <span class="at">idx =</span> <span class="fu">row_number</span>(), <span class="at">idx_rev =</span> <span class="fu">rev</span>(idx)) <span class="sc">%&gt;%</span></span>
<span id="cb73-1481"><a href="#cb73-1481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb73-1482"><a href="#cb73-1482" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_early =</span> <span class="fu">mean</span>(rent_burden_index[idx <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1483"><a href="#cb73-1483" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_late  =</span> <span class="fu">mean</span>(rent_burden_index[idx_rev <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1484"><a href="#cb73-1484" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change =</span> rent_burden_late <span class="sc">-</span> rent_burden_early,</span>
<span id="cb73-1485"><a href="#cb73-1485" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_early =</span> <span class="fu">mean</span>(population[idx <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1486"><a href="#cb73-1486" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_late  =</span> <span class="fu">mean</span>(population[idx_rev <span class="sc">&lt;=</span> <span class="fu">min</span>(<span class="dv">3</span>, n_obs)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1487"><a href="#cb73-1487" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_change_pct =</span> <span class="fu">if_else</span>(<span class="fu">is.finite</span>(pop_early) <span class="sc">&amp;</span> pop_early <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb73-1488"><a href="#cb73-1488" aria-hidden="true" tabindex="-1"></a>                             (pop_late <span class="sc">-</span> pop_early)<span class="sc">/</span>pop_early <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb73-1489"><a href="#cb73-1489" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_housing_index =</span> <span class="fu">mean</span>(composite_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1490"><a href="#cb73-1490" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_MAI =</span> <span class="fu">mean</span>(MAI, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-1491"><a href="#cb73-1491" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb73-1492"><a href="#cb73-1492" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb73-1493"><a href="#cb73-1493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(rent_burden_change), <span class="fu">is.finite</span>(pop_change_pct), <span class="fu">is.finite</span>(avg_housing_index), <span class="fu">is.finite</span>(avg_MAI))</span>
<span id="cb73-1494"><a href="#cb73-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1495"><a href="#cb73-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1496"><a href="#cb73-1496" aria-hidden="true" tabindex="-1"></a>y_thr <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.finite</span>(<span class="fu">mean</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb73-1497"><a href="#cb73-1497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="cf">else</span> <span class="fu">median</span>(yimby_summary<span class="sc">$</span>avg_housing_index, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-1498"><a href="#cb73-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1499"><a href="#cb73-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1500"><a href="#cb73-1500" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb73-1501"><a href="#cb73-1501" aria-hidden="true" tabindex="-1"></a>  yimby_summary,</span>
<span id="cb73-1502"><a href="#cb73-1502" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> rent_burden_change, <span class="at">y =</span> avg_housing_index, <span class="at">size =</span> <span class="fu">pmax</span>(pop_change_pct, <span class="dv">0</span>), <span class="at">color =</span> avg_MAI)</span>
<span id="cb73-1503"><a href="#cb73-1503" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb73-1504"><a href="#cb73-1504" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb73-1505"><a href="#cb73-1505" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> y_thr, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb73-1506"><a href="#cb73-1506" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,   <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb73-1507"><a href="#cb73-1507" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_c</span>(<span class="at">name =</span> <span class="st">"Millennial Appeal (MAI)"</span>, <span class="at">option =</span> <span class="st">"C"</span>) <span class="sc">+</span></span>
<span id="cb73-1508"><a href="#cb73-1508" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Population growth (%)"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb73-1509"><a href="#cb73-1509" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-1510"><a href="#cb73-1510" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Housing Growth vs Change in Rent Burden (Colored by Millennial Attraction)"</span>,</span>
<span id="cb73-1511"><a href="#cb73-1511" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Upper-left = decreasing burden, above-average housing growth, and positive population growth"</span>,</span>
<span id="cb73-1512"><a href="#cb73-1512" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Change in Rent Burden Index (late − early)"</span>,</span>
<span id="cb73-1513"><a href="#cb73-1513" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Housing Growth Index (0–100)"</span></span>
<span id="cb73-1514"><a href="#cb73-1514" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-1515"><a href="#cb73-1515" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb73-1516"><a href="#cb73-1516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1519"><a href="#cb73-1519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb73-1520"><a href="#cb73-1520" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Plot 2: Rent Burden paths over time for top YIMBY + high MAI cities ----</span></span>
<span id="cb73-1521"><a href="#cb73-1521" aria-hidden="true" tabindex="-1"></a>cands <span class="ot">&lt;-</span> yimby_summary <span class="sc">%&gt;%</span></span>
<span id="cb73-1522"><a href="#cb73-1522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span>, avg_housing_index <span class="sc">&gt;=</span> y_thr, pop_change_pct <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-1523"><a href="#cb73-1523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(avg_housing_index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span> scales<span class="sc">::</span><span class="fu">rescale</span>(avg_MAI, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb73-1524"><a href="#cb73-1524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(score, <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb73-1525"><a href="#cb73-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1526"><a href="#cb73-1526" aria-hidden="true" tabindex="-1"></a>yimby_df <span class="sc">%&gt;%</span></span>
<span id="cb73-1527"><a href="#cb73-1527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">%in%</span> cands<span class="sc">$</span>CBSA) <span class="sc">%&gt;%</span></span>
<span id="cb73-1528"><a href="#cb73-1528" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rent_burden_index, <span class="at">color =</span> NAME, <span class="at">group =</span> NAME)) <span class="sc">+</span></span>
<span id="cb73-1529"><a href="#cb73-1529" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-1530"><a href="#cb73-1530" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb73-1531"><a href="#cb73-1531" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb73-1532"><a href="#cb73-1532" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Evolution of Rent Burden in High-Growth, Millennial-Friendly CBSAs"</span>,</span>
<span id="cb73-1533"><a href="#cb73-1533" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Rent Burden Index (0–100)"</span>, <span class="at">color =</span> <span class="st">"CBSA"</span></span>
<span id="cb73-1534"><a href="#cb73-1534" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-1535"><a href="#cb73-1535" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb73-1536"><a href="#cb73-1536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb73-1537"><a href="#cb73-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-1538"><a href="#cb73-1538" aria-hidden="true" tabindex="-1"></a>Our targeting combines three signals: (1) affordability gains (falling Rent Burden Index), (2) strong Housing Growth (permits per 1,000 residents and relative to 5-year population growth), and (3) Millennial Attraction (25–34 share relative to national average). Metros in the upper-left quadrant of Plot 1 (↓ rent burden, ↑ housing growth, ↑ population) with deeper color (↑ MAI) represent the strongest YIMBY successes.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>